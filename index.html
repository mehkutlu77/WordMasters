<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>EngWordMasters ‚Äî ƒ∞ngilizce Kelime √ñƒüren</title>
<meta name="description" content="Akƒ±llƒ± flashcard, quiz ve e≈üle≈ütirme oyunlarƒ±yla ƒ∞ngilizce kelime haznenizi geli≈ütirin. A1'den C2'ye 11.000+ kelime.">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#4ade80">

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">

<!-- iOS PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="EngWordMasters">
<link rel="apple-touch-icon" href="icons/icon-192x192.png">

<!-- Fonts & Charts -->
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=Playfair+Display:wght@700&family=Nunito:wght@400;600;700;800&family=Russo+One&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="sinavlar.js" onerror="console.warn('sinavlar.js bulunamadƒ±')"></script>

<style>
/* ‚ïê‚ïê‚ïê LinguiVance Marka Renk Sistemi ‚ïê‚ïê‚ïê */
:root {
    /* Seviye paleti ‚Äî LinguiVance ile birebir aynƒ± */
    --sprout-main:   #4ade80; --sprout-dark:   #16a34a; --sprout-soft:   #f0fdf4;
    --sapling-main:  #34d399; --sapling-dark:  #059669; --sapling-soft:  #ecfdf5;
    --tree-main:     #fbbf24; --tree-dark:     #d97706; --tree-soft:     #fffbeb;
    --forest-main:   #fb923c; --forest-dark:   #ea580c; --forest-soft:   #fff7ed;
    --mountain-main: #f87171; --mountain-dark: #dc2626; --mountain-soft: #fef2f2;
    --galaxy-main:   #a78bfa; --galaxy-dark:   #7c3aed; --galaxy-soft:   #f5f3ff;
    /* Aktif seviye (varsayƒ±lan Sprout) */
    --lvl-main: var(--sprout-main);
    --lvl-dark: var(--sprout-dark);
    --lvl-soft: var(--sprout-soft);
    /* Genel */
    --bg:        #f8fafc;
    --surface:   #ffffff;
    --border:    #e2e8f0;
    --text:      #1e293b;
    --muted:     #64748b;
    --shadow-sm: 0 1px 3px rgba(0,0,0,.08);
    --shadow-md: 0 4px 16px rgba(0,0,0,.10);
    --shadow-lg: 0 10px 30px rgba(0,0,0,.12);
    --r:         18px;
    /* Eski uyumluluk */
    --primary: #3B82F6; --primary-light: #EFF6FF;
    --success: #22C55E; --danger: #EF4444; --warning: #F59E0B;
    --text-main: #1F2937; --text-light: #6B7280;
    --bg-app: var(--bg); --card-shadow: var(--shadow-sm);
}
body[data-level="Sprout"]   { --lvl-main:var(--sprout-main);   --lvl-dark:var(--sprout-dark);   --lvl-soft:var(--sprout-soft); }
body[data-level="Sapling"]  { --lvl-main:var(--sapling-main);  --lvl-dark:var(--sapling-dark);  --lvl-soft:var(--sapling-soft); }
body[data-level="Tree"]     { --lvl-main:var(--tree-main);     --lvl-dark:var(--tree-dark);     --lvl-soft:var(--tree-soft); }
body[data-level="Forest"]   { --lvl-main:var(--forest-main);   --lvl-dark:var(--forest-dark);   --lvl-soft:var(--forest-soft); }
body[data-level="Mountain"] { --lvl-main:var(--mountain-main); --lvl-dark:var(--mountain-dark); --lvl-soft:var(--mountain-soft); }
body[data-level="Galaxy"]   { --lvl-main:var(--galaxy-main);   --lvl-dark:var(--galaxy-dark);   --lvl-soft:var(--galaxy-soft); }

body {
    font-family: 'DM Sans', 'Nunito', sans-serif;
    margin: 0; padding: 0;
    background-color: var(--bg);
    color: var(--text);
    display: flex; justify-content: center;
    min-height: 100vh;
}

.app-container {
    width: 100%; max-width: 430px;
    background: var(--surface);
    min-height: 100vh;
    position: relative;
    box-shadow: 0 0 40px rgba(0,0,0,.08);
    display: flex; flex-direction: column;
}

/* ‚ïê‚ïê‚ïê HEADER ‚Äî LinguiVance top-bar stili ‚ïê‚ïê‚ïê */
.top-bar {
    display: flex; align-items: center; justify-content: space-between;
    padding: 14px 18px 8px;
    background: var(--surface);
    position: sticky; top: 0; z-index: 100;
    border-bottom: 1px solid var(--border);
}
.logo-area { display: flex; align-items: center; gap: 10px; }
.logo-main { font-family: 'Playfair Display', serif; font-size: 1.15rem; font-weight: 700; color: var(--lvl-dark); letter-spacing: -.3px; }
.logo-sub  { font-size: .65rem; font-weight: 700; color: var(--muted); letter-spacing: 1.5px; text-transform: uppercase; }
.lang-toggle-pill {
    display: flex; background: var(--lvl-soft); border: 1.5px solid var(--lvl-main);
    border-radius: 50px; overflow: hidden; cursor: pointer;
}
.lang-toggle-pill span { padding: 5px 11px; font-size: .72rem; font-weight: 700; color: var(--muted); transition: .2s; }
.lang-toggle-pill span.active { background: var(--lvl-main); color: #fff; border-radius: 50px; }

/* HEADER (alt ekranlar i√ßin) */
.header {
    padding: 13px 18px;
    display: flex; align-items: center; justify-content: space-between;
    background: var(--surface); position: sticky; top: 0; z-index: 100;
    border-bottom: 1px solid var(--border);
}

.lang-btn {
    background: #E0F2FE; 
    border: 2px solid #7DD3FC;
    color: #0284C7; 
    font-weight: 800; 
    font-size: 0.75rem;
    width: 80px; height: 45px; 
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px; 
    cursor: pointer; 
    transition: 0.2s;
}
.lang-btn:active { transform: scale(0.95); }

/* WORD ART */
.word-art-title {
    font-family: 'Russo One', sans-serif;
    font-size: 2rem; text-align: center;
    background: linear-gradient(45deg, #2196F3, #00BCD4);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    text-shadow: 3px 3px 0px rgba(0,0,0,0.1); margin: 10px 0 20px;
}

.mini-word-art {
    font-family: 'Russo One', sans-serif; font-size: 1.4rem;
    background: linear-gradient(45deg, #1565C0, #42A5F5);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    text-shadow: 2px 2px 0px rgba(0,0,0,0.1); text-transform: uppercase;
}

/* BUTONLAR */
.btn-back {
    background: #EFF6FF; border: 2px solid #BFDBFE; color: #2563EB;
    width: 45px; height: 45px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; box-shadow: 0 3px 0 #BFDBFE; transition: transform 0.1s;
    font-size: 1.2rem; margin: 0; padding: 0;
}
.btn-back:active { transform: translateY(3px); box-shadow: none; }
.icon-back { width: 24px; height: 24px; fill: currentColor; stroke: currentColor; stroke-width: 2; }

.btn-settings {
    background: #F3F4F6; border: 2px solid #E5E7EB; color: #4B5563;
    width: 80px; height: 45px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 1.5rem; transition: 0.1s;
}
.btn-settings:active { transform: scale(0.95); background: #E5E7EB; }

button {
    border: none; border-radius: 15px; padding: 16px;
    font-weight: 700; cursor: pointer; transition: 0.1s; width: 100%; margin: 8px 0;
    text-transform: uppercase; font-family: "Poppins", sans-serif;
    color: white; box-shadow: 0 5px 0 rgba(0,0,0,0.15); font-size: 1rem;
}
button:active { transform: translateY(4px); box-shadow: none; }

.btn-green { background: #4CAF50; box-shadow: 0 5px 0 #388E3C; }
.btn-red { background: #F44336; box-shadow: 0 5px 0 #D32F2F; }
.btn-grey { background: #78909C; box-shadow: 0 5px 0 #546E7A; }
.btn-purple { background: #9C27B0; box-shadow: 0 5px 0 #7B1FA2; }
.btn-orange { background: #FF9800; box-shadow: 0 5px 0 #F57C00; }
.btn-blue { background: #2196F3; box-shadow: 0 5px 0 #1976D2; }
.btn-cyan { background: #00BCD4; box-shadow: 0 5px 0 #0097A7; }

/* DOSYA Y√úKLEME BUTONU */
.btn-file-upload {
    background: white; border: 2px dashed #3B82F6; color: #3B82F6;
    border-radius: 12px; padding: 15px; text-align: center;
    cursor: pointer; width: 100%; margin-bottom: 15px; display: block;
    font-weight: 700; transition: 0.2s;
}
.btn-file-upload:hover { background: #EFF6FF; }

.content { flex: 1; padding: 20px; overflow-y: auto; padding-bottom: 80px; }

/* ‚ïê‚ïê‚ïê KARTLAR (ana sayfa kategori kartlarƒ±) ‚ïê‚ïê‚ïê */
.card-menu {
    background: var(--surface); border-radius: 18px; padding: 18px 20px; margin-bottom: 12px;
    border: 1.5px solid var(--border); box-shadow: var(--shadow-sm);
    cursor: pointer; transition: .15s; display: flex; align-items: center; gap: 16px;
}
.card-menu:active { transform: scale(0.98); }
.card-menu:hover  { border-color: var(--lvl-main); background: var(--lvl-soft); }
.menu-icon { font-size: 1.6rem; width: 48px; height: 48px; background: var(--lvl-soft); border-radius: 14px; display: flex; align-items: center; justify-content: center; border: 1.5px solid var(--lvl-main); flex-shrink: 0; }
.menu-text h3 { margin: 0; font-size: 1rem; font-weight: 700; color: var(--text); }
.menu-text p  { margin: 2px 0 0; font-size: .8rem; color: var(--muted); }
.home-stats { display: flex; justify-content: space-around; background: var(--surface); border-radius: 18px; padding: 16px; margin-bottom: 16px; border: 1.5px solid var(--border); box-shadow: var(--shadow-sm); text-align: center; }
.home-stat-val { font-size: 1.4rem; font-weight: 800; color: var(--text); }
.home-stat-lbl { font-size: .6rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; margin-top: 2px; }
.home-section-lbl { font-size: .68rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 10px; display: block; }

/* ‚ïê‚ïê‚ïê HERO STREAK KARTI ‚ïê‚ïê‚ïê */
.streak-box {
    background: var(--lvl-soft); border: 1.5px solid var(--lvl-main); border-radius: 20px;
    padding: 18px 20px; text-align: center; margin-bottom: 16px; box-shadow: var(--shadow-sm);
}
.streak-count { font-size: 1.5rem; font-weight: 800; color: var(--lvl-dark); margin: 6px 0 12px; }

/* WEEK TRACKER G√ñRSELƒ∞ */
.week-tracker { display: flex; justify-content: space-between; margin-top: 12px; padding-top: 10px; border-top: 1px solid var(--lvl-main); opacity: .8; }
.day-item { display: flex; flex-direction: column; align-items: center; gap: 4px; }
.day-circle { width: 24px; height: 24px; border: 2px solid var(--lvl-main); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: .7rem; color: transparent; background: var(--surface); font-weight: 800; }
.day-circle.active { background: var(--lvl-main); border-color: var(--lvl-dark); color: #fff; }
.day-label { font-size: .58rem; font-weight: 700; color: var(--muted); }

/* ‚ïê‚ïê‚ïê SEVƒ∞YE BUTONLARI ‚Äî LinguiVance stili ‚ïê‚ïê‚ïê */
.grid-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.level-btn {
    height: 100px; border: 2.5px solid transparent; border-radius: 18px;
    cursor: pointer; font-weight: 700; color: white; font-family: 'DM Sans', sans-serif;
    font-size: .88rem; display: flex; flex-direction: column; align-items: center;
    justify-content: center; gap: 4px; box-shadow: var(--shadow-sm); transition: .2s;
    line-height: 1.3; padding: 10px 4px;
}
.level-btn .lvl-icon { font-size: 2rem; }
.level-btn .lvl-name { font-weight: 800; font-size: .92rem; }
.level-btn .lvl-cefr { font-size: .62rem; opacity: .85; letter-spacing: .5px; }
.level-btn:active { transform: translateY(4px); box-shadow: none; }
.level-btn:hover  { transform: translateY(-2px); box-shadow: var(--shadow-md); }

/* ‚ïê‚ïê‚ïê TAB BAR ‚Äî Alt Navigasyon ‚ïê‚ïê‚ïê */
.tab-bar {
    position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
    width: 100%; max-width: 430px;
    background: rgba(255,255,255,.96); backdrop-filter: blur(20px);
    border-top: 1px solid var(--border); display: flex; z-index: 1000;
    box-shadow: 0 -4px 20px rgba(0,0,0,.08);
    padding-bottom: env(safe-area-inset-bottom, 0px);
}
.tab-item {
    flex: 1; display: flex; flex-direction: column; align-items: center;
    padding: 10px 4px 12px; cursor: pointer; border: none; background: none;
    font-family: 'DM Sans', sans-serif; transition: .2s; position: relative;
}
.tab-item .tab-icon  { font-size: 1.35rem; margin-bottom: 2px; transition: .2s; }
.tab-item .tab-label { font-size: .58rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; transition: .2s; }
.tab-item.active .tab-label { color: var(--lvl-dark); }
.tab-item.active .tab-icon  { transform: translateY(-3px); }
.tab-item::after {
    content: ''; position: absolute; top: 0; left: 20%; right: 20%;
    height: 3px; background: var(--lvl-main); border-radius: 0 0 4px 4px;
    opacity: 0; transition: .2s;
}
.tab-item.active::after { opacity: 1; }
.has-tabbar { padding-bottom: 80px !important; }

/* ‚ïê‚ïê‚ïê PROFƒ∞L EKRANI ‚ïê‚ïê‚ïê */
.profile-avatar-wrap { text-align: center; padding: 24px 0 16px; }
.profile-avatar { width: 80px; height: 80px; border-radius: 50%; background: var(--lvl-soft); border: 3px solid var(--lvl-main); margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 2.6rem; cursor: pointer; }
.profile-name        { font-weight: 800; font-size: 1.1rem; color: var(--text); }
.profile-level-badge { display: inline-block; margin-top: 6px; background: var(--lvl-soft); color: var(--lvl-dark); border: 1.5px solid var(--lvl-main); border-radius: 20px; padding: 3px 14px; font-size: .75rem; font-weight: 700; }
.profile-stats-row   { display: flex; justify-content: space-around; background: var(--bg); border-radius: 16px; padding: 14px; margin: 0 16px 20px; border: 1.5px solid var(--border); }
.profile-stat-box    { text-align: center; }
.profile-stat-val    { font-size: 1.3rem; font-weight: 800; color: var(--text); }
.profile-stat-lbl    { font-size: .62rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; }
.profile-menu        { background: var(--surface); border: 1.5px solid var(--border); border-radius: 18px; overflow: hidden; margin: 0 16px 14px; }
.profile-menu-item   { display: flex; align-items: center; gap: 12px; padding: 15px 18px; border-bottom: 1px solid var(--border); cursor: pointer; transition: .15s; font-size: .9rem; font-weight: 600; color: var(--text); background: none; width: 100%; border-left: none; border-right: none; border-top: none; font-family: 'DM Sans',sans-serif; }
.profile-menu-item:last-child { border-bottom: none; }
.profile-menu-item:hover { background: var(--lvl-soft); }
.profile-menu-item .mi-icon  { font-size: 1.2rem; }
.profile-menu-item .mi-arrow { margin-left: auto; color: var(--muted); font-size: 1.1rem; }
.profile-menu-item .mi-val   { margin-left: auto; font-size: .8rem; font-weight: 700; color: var(--muted); }
.profile-menu-item.danger    { color: #ef4444; }
.toggle-sw { width: 40px; height: 22px; background: #d1d5db; border-radius: 11px; margin-left: auto; position: relative; transition: .3s; flex-shrink: 0; }
.toggle-sw.on { background: var(--lvl-main); }
.toggle-sw::after { content:''; width: 18px; height: 18px; background: #fff; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: .3s; box-shadow: 0 1px 3px rgba(0,0,0,.2); }
.toggle-sw.on::after { left: 20px; }
.section-label { font-size: .68rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin: 4px 16px 8px; display: block; }
.profile-email       { font-size:.8rem; color:var(--muted); margin-top:2px; }
.profile-admin-badge { display:inline-block; margin-top:5px; background:linear-gradient(135deg,#f59e0b,#d97706); color:#fff; border-radius:20px; padding:3px 12px; font-size:.72rem; font-weight:800; letter-spacing:.5px; }
.ach-grid  { display:grid; grid-template-columns:repeat(5,1fr); gap:8px; margin:0 16px 14px; }
.ach-item  { display:flex; flex-direction:column; align-items:center; gap:4px; }
.ach-icon  { width:48px; height:48px; border-radius:14px; background:var(--bg); border:1.5px solid var(--border); display:flex; align-items:center; justify-content:center; font-size:1.35rem; filter:grayscale(1) opacity(.35); transition:.3s; }
.ach-icon.earned { filter:none; border-color:var(--lvl-main); background:var(--lvl-soft); box-shadow:0 2px 8px rgba(0,0,0,.12); }
.ach-lbl   { font-size:.5rem; font-weight:700; text-align:center; color:var(--muted); text-transform:uppercase; letter-spacing:.3px; line-height:1.3; }

/* E≈ûLE≈ûTƒ∞RME RENKLERƒ∞ */
.mc-1 { background: #42A5F5; } .mc-2 { background: #FFA726; } .mc-3 { background: #66BB6A; }
.mc-4 { background: #EC407A; } .mc-5 { background: #AB47BC; } .mc-6 { background: #26C6DA; }

.match-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.match-card {
    border-radius: 12px; padding: 15px 5px; text-align: center; font-weight: 700; color: white;
    cursor: pointer; font-size: 0.95rem; min-height: 80px; display: flex; align-items: center; justify-content: center;
    box-shadow: 0 4px 0 rgba(0,0,0,0.2); border: 2px solid white; word-break: break-word; line-height: 1.2;
}
.match-card:active { transform: translateY(4px); box-shadow: none; }
.match-card.matched { visibility: hidden; }
.match-card.selected { border-color: #333; transform: scale(0.95); }

/* ‚ïê‚ïê‚ïê FLASHCARD ‚Äî LinguiVance stili ‚ïê‚ïê‚ïê */
.card-box  { width: 100%; height: 420px; perspective: 1200px; cursor: pointer; margin: 12px 0 12px; overflow: hidden; }
.card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform .55s cubic-bezier(.4,0,.2,1); transform-style: preserve-3d; }
.card-inner.flipped { transform: rotateY(180deg); }
.card-face {
    position: absolute; width: 100%; height: 100%;
    backface-visibility: hidden; -webkit-backface-visibility: hidden;
    border-radius: 22px; box-shadow: var(--shadow-md);
    border: 2px solid var(--lvl-main); background: var(--surface); overflow: hidden;
    box-sizing: border-box;
}
.card-front { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; box-sizing: border-box; }
.card-back  { transform: rotateY(180deg); text-align: left; display: flex; flex-direction: column; }
.card-word  { font-family: 'Playfair Display', serif; font-size: 2.6rem; font-weight: 700; color: var(--lvl-dark); line-height: 1.1; margin-bottom: 8px; text-align: center; }
.card-hint  { font-size: .8rem; color: var(--muted); margin-top: 8px; }
.card-back-header { background: var(--lvl-main); padding: 12px 16px 10px; color: white; flex-shrink: 0; }
.card-back-header-row { display: flex; justify-content: space-between; align-items: center; }
.card-back-lang { font-size: .68rem; font-weight: 700; letter-spacing: .5px; opacity: .9; }
.btn-translate { background: rgba(255,255,255,.22); border: 1.5px solid rgba(255,255,255,.5); color: #fff; padding: 5px 12px; border-radius: 20px; font-size: .72rem; font-weight: 700; cursor: pointer; font-family: 'DM Sans', sans-serif; }
.card-tr-reveal { margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,.3); }
.card-translation { font-family: 'Playfair Display', serif; font-size: 1.4rem; font-weight: 700; line-height: 1.2; color: #fff; }
.card-type-tr { font-size: .72rem; opacity: .85; margin-top: 2px; color: #fff; }
.card-back-body { padding: 10px 16px 12px; flex: 1; overflow-y: auto; }
.card-section { display: flex; align-items: flex-start; gap: 10px; padding: 9px 0; border-bottom: 1px solid var(--border); }
.card-section:last-child { border-bottom: none; padding-bottom: 0; }
.card-section-icon { font-size: .95rem; flex-shrink: 0; margin-top: 2px; width: 20px; text-align: center; }
.card-section-label { font-size: .6rem; font-weight: 700; text-transform: uppercase; letter-spacing: .5px; color: var(--muted); margin-bottom: 2px; }
.card-section-val { font-size: .84rem; color: var(--text); font-weight: 600; line-height: 1.4; }
.card-pronounce-btn { background: var(--lvl-soft); border: 1.5px solid var(--lvl-main); color: var(--lvl-dark); padding: 5px 14px; border-radius: 16px; font-size: .82rem; font-weight: 700; cursor: pointer; font-family: 'DM Sans', sans-serif; }
.fc-btn-row { display: flex; gap: 10px; }
.btn-know  { flex: 1; padding: 16px; border-radius: 14px; font-size: .95rem; font-weight: 700; border: none; cursor: pointer; font-family: 'DM Sans', sans-serif; transition: .15s; background: var(--lvl-main); color: #fff; box-shadow: 0 4px 0 var(--lvl-dark); }
.btn-know:active  { transform: translateY(4px); box-shadow: none; }
.btn-again { flex: 1; padding: 16px; border-radius: 14px; font-size: .95rem; font-weight: 700; border: 1.5px solid var(--border); cursor: pointer; font-family: 'DM Sans', sans-serif; transition: .15s; background: var(--surface); color: var(--text); box-shadow: 0 4px 0 var(--border); }
.btn-again:active { transform: translateY(4px); box-shadow: none; }

/* ‚ïê‚ïê‚ïê QUIZ ‚ïê‚ïê‚ïê */
.quiz-question {
    background: var(--lvl-main); color: white; padding: 28px 20px; border-radius: 18px;
    text-align: center; font-size: 1.4rem; font-weight: 800;
    font-family: 'Playfair Display', serif;
    box-shadow: 0 6px 0 var(--lvl-dark); margin-bottom: 20px;
}
.quiz-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.quiz-opt {
    background: var(--surface); border: 1.5px solid var(--border); border-radius: 14px;
    padding: 18px 8px; text-align: center; font-weight: 700; cursor: pointer;
    box-shadow: 0 4px 0 var(--border); transition: 0.1s; color: var(--text); font-size: .9rem;
}
.quiz-opt:active { transform: translateY(4px); box-shadow: none; }
.quiz-opt.correct { background: #22c55e; color: white; border-color: #22c55e; box-shadow: 0 4px 0 #15803d; }
.quiz-opt.wrong   { background: #ef4444; color: white; border-color: #ef4444; box-shadow: 0 4px 0 #b91c1c; }

/* INPUTLAR */
.input-field { width: 100%; padding: 15px; border: 2px solid #E5E7EB; border-radius: 12px; margin-bottom: 12px; box-sizing: border-box; font-family: inherit; }
.add-option-btn { padding: 15px; border: 2px solid #E5E7EB; border-radius: 12px; background: white; font-weight: 700; color: #666; cursor: pointer; flex: 1; text-align: center; }
.add-option-btn.active { border-color: #3B82F6; color: #3B82F6; background: #EFF6FF; }

/* EKRANLAR */
.screen { display: none; height: 100%; flex-direction: column; }
.screen.active { display: flex; }
.stats-summary { display: flex; justify-content: space-around; background: white; padding: 15px; border-radius: 12px; margin-top: 20px; border: 1px solid #E5E7EB; }
.stat-val { display: block; font-weight: 800; font-size: 1.2rem; }

/* SONU√á */
.result-box {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: 4px solid white; border-radius: 20px; padding: 40px 20px;
    text-align: center; margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(118, 75, 162, 0.4);
    transform: scale(1); animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.result-score { font-family: 'Russo One', sans-serif; font-size: 3rem; color: white; text-shadow: 4px 4px 0px rgba(0,0,0,0.2); margin: 0; }
.result-label { color: rgba(255,255,255,0.9); font-size: 1.2rem; font-weight: 700; margin-top: 5px; text-transform: uppercase; letter-spacing: 2px; }
@keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
/* ‚ïê‚ïê‚ïê AUTH EKRANI ‚ïê‚ïê‚ïê */
#authScreen {
    display: none; position: fixed; inset: 0; z-index: 99999;
    background: linear-gradient(160deg, var(--sprout-soft) 0%, #ffffff 60%, #f0f9ff 100%);
    align-items: center; justify-content: center; padding: 24px; overflow-y: auto;
}
.auth-card { width:100%; max-width:400px; background:white; border-radius:28px; box-shadow:0 20px 60px rgba(0,0,0,.12); padding:32px 28px 24px; margin:auto; }
.auth-logo { text-align:center; margin-bottom:20px; }
.auth-logo-emoji { font-size:2.5rem; }
.auth-logo-title { font-family:'Playfair Display',serif; font-size:1.5rem; font-weight:700; color:var(--sprout-dark); margin-top:8px; }
.auth-logo-sub { font-size:.78rem; color:var(--muted); margin-top:4px; }
.auth-tabs { display:flex; border-bottom:2px solid var(--border); margin-bottom:18px; }
.auth-tab-btn { flex:1; background:none; border:none; box-shadow:none; border-radius:0; padding:10px; font-size:.88rem; font-weight:700; color:var(--muted); cursor:pointer; transition:.2s; margin:0; text-transform:none; }
.auth-tab-btn.active { color:var(--sprout-dark); border-bottom:2.5px solid var(--sprout-main); margin-bottom:-2px; }
.auth-form { display:none; }
.auth-form.active { display:block; }
.auth-field { margin-bottom:13px; }
.auth-field label { display:block; font-size:.78rem; font-weight:700; color:var(--text); margin-bottom:5px; }
.auth-field label span { font-weight:400; color:var(--muted); font-size:.73rem; }
.auth-field input { width:100%; height:46px; border:2px solid var(--border); border-radius:13px; padding:0 15px; font-size:.92rem; font-family:'DM Sans',sans-serif; box-sizing:border-box; color:var(--text); background:var(--bg); transition:.2s; }
.auth-field input:focus { outline:none; border-color:var(--sprout-main); background:white; }
.auth-err { color:#ef4444; font-size:.78rem; font-weight:600; margin-bottom:8px; min-height:16px; }
.auth-submit { width:100%; height:50px; background:linear-gradient(135deg,var(--sprout-main),var(--sprout-dark)); color:white; border:none; border-radius:15px; font-weight:700; font-size:.95rem; cursor:pointer; margin:8px 0 0; box-shadow:0 4px 15px rgba(74,222,128,.35); transition:.2s; text-transform:none; }
.auth-submit:hover { transform:translateY(-1px); }
.auth-footer { text-align:center; margin-top:14px; font-size:.7rem; color:var(--muted); }

/* ‚ïê‚ïê‚ïê ONBOARDING ‚ïê‚ïê‚ïê */
#onboarding { position:fixed; inset:0; z-index:9000; background:white; display:none; flex-direction:column; align-items:center; justify-content:center; padding:40px 28px; overflow-y:auto; }
#onboarding.active { display:flex; }
.ob-step { display:none; width:100%; max-width:400px; flex-direction:column; align-items:center; text-align:center; }
.ob-step.active { display:flex; }
.ob-emoji { font-size:4.5rem; margin-bottom:16px; }
.ob-title { font-family:'Playfair Display',serif; font-size:1.6rem; font-weight:700; color:var(--text); margin-bottom:8px; }
.ob-sub { font-size:.88rem; color:var(--muted); margin-bottom:20px; line-height:1.5; }
.ob-input { width:100%; height:46px; border:2px solid var(--border); border-radius:13px; padding:0 15px; font-size:.95rem; font-family:'DM Sans',sans-serif; box-sizing:border-box; }
.ob-input:focus { outline:none; border-color:var(--sprout-main); }
.ob-avatars { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin:12px 0; }
.ob-avatar-btn { width:48px; height:48px; border-radius:50%; border:2.5px solid var(--border); background:var(--bg); font-size:1.6rem; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:.2s; box-shadow:none; margin:0; padding:0; }
.ob-avatar-btn.selected { border-color:var(--sprout-main); background:var(--sprout-soft); transform:scale(1.1); }
.ob-levels { display:grid; grid-template-columns:1fr 1fr; gap:9px; width:100%; margin:14px 0; }
.ob-level-card { border:2px solid var(--border); border-radius:14px; padding:12px 8px; cursor:pointer; transition:.2s; background:white; text-align:center; }
.ob-level-card.selected { border-color:var(--lvl-main); background:var(--lvl-soft); transform:scale(1.03); }
.ob-level-card .ob-lc-icon { font-size:1.6rem; }
.ob-level-card .ob-lc-name { font-weight:800; font-size:.85rem; color:var(--text); }
.ob-level-card .ob-lc-cefr { font-size:.68rem; color:var(--muted); }
.ob-goals { display:grid; grid-template-columns:1fr 1fr; gap:9px; width:100%; margin:14px 0; }
.ob-btn-primary { width:100%; height:50px; background:linear-gradient(135deg,var(--sprout-main),var(--sprout-dark)); color:white; border:none; border-radius:15px; font-weight:700; font-size:.95rem; cursor:pointer; margin-top:14px; box-shadow:0 4px 15px rgba(74,222,128,.35); text-transform:none; }
.ob-btn-secondary { background:none; border:2px solid var(--border); color:var(--muted); border-radius:13px; padding:11px; font-size:.82rem; cursor:pointer; margin-top:8px; width:100%; box-shadow:none; text-transform:none; }
.pt-progress { font-size:.78rem; color:var(--muted); font-weight:700; margin-bottom:14px; }
.pt-question { font-size:1rem; font-weight:700; color:var(--text); background:var(--bg); border-radius:14px; padding:18px; margin-bottom:18px; line-height:1.5; width:100%; box-sizing:border-box; }
.pt-options { display:grid; grid-template-columns:1fr 1fr; gap:9px; width:100%; }
.pt-opt-btn { padding:13px 8px; border:2px solid var(--border); border-radius:13px; background:white; color:var(--text); font-family:'DM Sans',sans-serif; font-size:.85rem; cursor:pointer; box-shadow:none; margin:0; text-transform:none; font-weight:600; transition:.2s; }
.pt-result { display:none; text-align:center; padding:16px 0; width:100%; }

/* ‚ïê‚ïê‚ïê ADMƒ∞N Gƒ∞Rƒ∞≈û OVERLAY ‚ïê‚ïê‚ïê */
#adminLoginOverlay { display:none; position:fixed; inset:0; z-index:99998; background:rgba(0,0,0,.55); backdrop-filter:blur(6px); align-items:center; justify-content:center; padding:24px; }
#adminLoginOverlay.show { display:flex; }
.admin-login-card { background:white; border-radius:24px; padding:32px 26px; width:100%; max-width:350px; box-shadow:0 20px 60px rgba(0,0,0,.2); }

/* ‚ïê‚ïê‚ïê ADMƒ∞N PANELƒ∞ ‚ïê‚ïê‚ïê */
#adminPanel { display:none; position:fixed; inset:0; z-index:99997; background:var(--bg); flex-direction:column; overflow:hidden; }
#adminPanel.show { display:flex; }
.admin-header { padding:12px 16px; background:white; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:12px; flex-shrink:0; }
.admin-tabs { display:flex; gap:5px; padding:10px 16px; background:white; border-bottom:1px solid var(--border); flex-shrink:0; }
.admin-tab-btn { flex:1; height:34px; background:none; border:2px solid var(--border); border-radius:10px; cursor:pointer; font-family:'DM Sans',sans-serif; font-size:.72rem; font-weight:700; color:var(--muted); transition:.2s; margin:0; box-shadow:none; text-transform:none; padding:0 3px; }
.admin-tab-btn.active { background:var(--lvl-soft); border-color:var(--lvl-main); color:var(--lvl-dark); }
.admin-content { flex:1; overflow-y:auto; padding:14px 16px 80px; }
.admin-section-title { font-size:.68rem; font-weight:800; text-transform:uppercase; letter-spacing:1px; color:var(--muted); margin:14px 0 7px; display:block; }
.admin-card { background:white; border-radius:14px; border:1.5px solid var(--border); padding:12px 14px; margin-bottom:9px; }
.admin-file-btn { display:flex; align-items:center; gap:10px; width:100%; background:var(--bg); border:2px dashed var(--border); border-radius:12px; padding:13px 15px; cursor:pointer; font-family:'DM Sans',sans-serif; font-size:.83rem; font-weight:700; color:var(--text); transition:.2s; margin-bottom:7px; box-shadow:none; text-transform:none; justify-content:flex-start; }
.admin-file-btn:hover { border-color:var(--lvl-main); background:var(--lvl-soft); color:var(--lvl-dark); }
.admin-stat-row { display:flex; justify-content:space-between; font-size:.83rem; padding:6px 0; border-bottom:1px solid var(--border); }
.admin-stat-row:last-child { border-bottom:none; }
.admin-user-row { display:flex; align-items:center; gap:10px; padding:9px 0; border-bottom:1px solid var(--border); font-size:.83rem; }
.admin-user-row:last-child { border-bottom:none; }
.admin-user-badge { background:var(--lvl-soft); color:var(--lvl-dark); border-radius:8px; padding:2px 8px; font-size:.68rem; font-weight:700; }

/* Confetti animasyonu */
@keyframes confettiFall { to { top:105vh; transform:rotate(360deg); opacity:0; } }

/* SAYA√á YAZI STƒ∞Lƒ∞ */
#quizCounter, #fcCounter {
    font-family: 'Russo One', sans-serif;
    color: #3B82F6;
    font-size: 1.2rem;
    letter-spacing: 1px;
    background: #EFF6FF;
    padding: 5px 15px;
    border-radius: 20px;
    display: inline-block;
    margin-bottom: 10px;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
}

/* ‚ïê‚ïê‚ïê DARK MODE ‚ïê‚ïê‚ïê */
body.dark-mode {
    --bg: #0f172a; --surface: #1e293b; --border: #334155;
    --text: #f1f5f9; --muted: #94a3b8;
    --shadow-sm: 0 1px 3px rgba(0,0,0,.3);
    --shadow-md: 0 4px 16px rgba(0,0,0,.4);
    --shadow-lg: 0 10px 30px rgba(0,0,0,.5);
    background-color: var(--bg);
    color: var(--text);
}
body.dark-mode .app-container       { background: var(--surface); }
body.dark-mode .tab-bar             { background: rgba(30,41,59,.96); border-color: #334155; }
body.dark-mode .top-bar             { background: var(--surface); border-color: var(--border); }
body.dark-mode .header              { background: var(--surface); border-color: var(--border); }
body.dark-mode .screen              { background: var(--bg); }
body.dark-mode .content             { background: var(--bg); }
body.dark-mode .card-menu           { background: var(--surface); border-color: var(--border); }
body.dark-mode .card-menu:hover     { background: var(--bg); border-color: var(--lvl-main); }
body.dark-mode .home-stats          { background: var(--surface); border-color: var(--border); }
body.dark-mode .card-face           { background: var(--surface); }
body.dark-mode .card-back-body      { background: var(--surface); }
body.dark-mode .btn-again           { background: var(--surface); color: var(--text); border-color: var(--border); box-shadow: 0 4px 0 #111827; }
body.dark-mode .quiz-opt            { background: var(--surface); border-color: var(--border); color: var(--text); box-shadow: 0 4px 0 #111827; }
body.dark-mode .profile-menu        { background: var(--bg); border-color: var(--border); }
body.dark-mode .profile-menu-item   { color: var(--text); }
body.dark-mode .profile-stats-row   { background: var(--bg); border-color: var(--border); }
body.dark-mode .ach-icon            { background: var(--bg); border-color: var(--border); }
body.dark-mode input, body.dark-mode select, body.dark-mode textarea { background: var(--bg); color: var(--text); border-color: var(--border); }
body.dark-mode .auth-card           { background: var(--surface); }
body.dark-mode .auth-field          { background: var(--bg); color: var(--text); border-color: var(--border); }
body.dark-mode .ob-card             { background: var(--surface); }
body.dark-mode .ob-input            { background: var(--bg); color: var(--text); border-color: var(--border); }
body.dark-mode .ob-level-card       { background: var(--surface); border-color: var(--border); color: var(--text); }
body.dark-mode .ob-goal-option      { background: var(--surface); border-color: var(--border); color: var(--text); }
body.dark-mode .admin-panel         { background: var(--surface); }
body.dark-mode .admin-tabs          { background: var(--bg); border-color: var(--border); }
body.dark-mode .admin-tab           { color: var(--muted); }
body.dark-mode .admin-tab.active    { background: var(--surface); color: var(--text); }
body.dark-mode .admin-pane          { background: var(--bg); }
body.dark-mode .admin-stat-card     { background: var(--surface); border-color: var(--border); }
body.dark-mode .admin-file-drop     { background: var(--bg); border-color: var(--border); }
body.dark-mode .admin-user-item     { background: var(--surface); border-color: var(--border); }
body.dark-mode .day-circle          { background: var(--bg); }
body.dark-mode .result-box          { /* gradient stays */ }
body.dark-mode .lang-toggle-pill    { background: var(--bg); }
body.dark-mode .streak-box          { background: var(--surface); }
body.dark-mode .notify-toast        { background: var(--surface); color: var(--text); border-color: var(--border); }
body.dark-mode .modal-overlay       { background: rgba(0,0,0,.75); }
</style>
</head>
<body>

<div class="app-container">

    <div class="screen active" id="homeScreen">
        <!-- LinguiVance top-bar -->
        <div class="top-bar">
            <div class="logo-area">
                <div style="width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--lvl-main),var(--lvl-dark));display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0;">üìñ</div>
                <div>
                    <div class="logo-main">LinguiVance</div>
                    <div class="logo-sub">Word Master</div>
                </div>
            </div>
            <div class="lang-toggle-pill" onclick="toggleLanguage()">
                <span id="lt-tr" class="active">TR</span>
                <span id="lt-en">EN</span>
            </div>
        </div>

        <div class="content has-tabbar" style="padding-top:12px;">
            <!-- Ba≈ülƒ±k kaldƒ±rƒ±ldƒ±, top-bar zaten var -->
            <div class="streak-box">
                <span style="font-size:2rem; display:block;">üéØüî•</span>
                <div class="streak-count" id="streakDisplay">1 G√ºnl√ºk Seri!</div>
                <div class="week-tracker" id="weekTracker">
                    <div class="day-item"><div class="day-circle" id="day-1">‚úì</div><span class="day-label">P</span></div>
                    <div class="day-item"><div class="day-circle" id="day-2">‚úì</div><span class="day-label">S</span></div>
                    <div class="day-item"><div class="day-circle" id="day-3">‚úì</div><span class="day-label">√á</span></div>
                    <div class="day-item"><div class="day-circle" id="day-4">‚úì</div><span class="day-label">P</span></div>
                    <div class="day-item"><div class="day-circle" id="day-5">‚úì</div><span class="day-label">C</span></div>
                    <div class="day-item"><div class="day-circle" id="day-6">‚úì</div><span class="day-label">C</span></div>
                    <div class="day-item"><div class="day-circle" id="day-0">‚úì</div><span class="day-label">P</span></div>
                </div>
            </div>
            <div class="home-stats">
                <div>
                    <div class="home-stat-val" id="mainTotal">0</div>
                    <div class="home-stat-lbl">TOPLAM</div>
                </div>
                <div>
                    <div class="home-stat-val" id="mainLearned" style="color:var(--lvl-dark);">0</div>
                    <div class="home-stat-lbl">√ñƒûRENƒ∞LEN</div>
                </div>
                <div>
                    <div class="home-stat-val" id="mainUnknown" style="color:#ef4444;">0</div>
                    <div class="home-stat-lbl">KALAN</div>
                </div>
            </div>
            <span class="home-section-lbl" data-lang="work_areas">√áALI≈ûMA ALANLARI</span>
            <div class="card-menu" onclick="selectCategory('KELƒ∞MELER')">
                <span class="menu-icon">üìò</span>
                <div class="menu-text"><h3 data-lang="words">Kelimeler</h3><p data-lang="words_desc">Kelime hazineni geli≈ütir</p></div>
            </div>
            <div class="card-menu" onclick="selectCategory('KALIPLAR')">
                <span class="menu-icon">üó£Ô∏è</span>
                <div class="menu-text"><h3 data-lang="phrases">Kalƒ±plar</h3><p data-lang="phrases_desc">G√ºnl√ºk konu≈üma yapƒ±larƒ±</p></div>
            </div>
            <div class="card-menu" onclick="selectCategory('DEYƒ∞MLER')">
                <span class="menu-icon">üî•</span>
                <div class="menu-text"><h3 data-lang="idioms">Deyimler</h3><p data-lang="idioms_desc">ƒ∞leri seviye ifadeler</p></div>
            </div>
        </div>
    </div>

    <div class="screen" id="settingsScreen">
        <div class="header">
            <button class="btn-back" onclick="show('homeScreen')">
                <svg class="icon-back" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <span class="mini-word-art" data-lang="settings">AYARLAR</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content">
            <div class="card-menu" onclick="show('addScreen')">
                <span class="menu-icon">üì•</span>
                <div class="menu-text"><h3 data-lang="add_data">Veri Ekle</h3><p data-lang="add_desc">Toplu veri giri≈üi</p></div>
            </div>
            
            <div class="card-menu" onclick="exportBackup()" style="border-color:var(--success);">
                <span class="menu-icon">üì§</span>
                <div class="menu-text"><h3 style="color:var(--success);">Yedek Al</h3><p>Verileri JSON olarak indir</p></div>
            </div>
            <div class="card-menu" onclick="document.getElementById('backupInput').click()" style="border-color:var(--primary);">
                <span class="menu-icon">üíæ</span>
                <div class="menu-text"><h3 style="color:var(--primary);">Yedeƒüi Y√ºkle</h3><p>JSON dosyasƒ±ndan geri y√ºkle</p></div>
                <input type="file" id="backupInput" accept=".json" style="display:none" onchange="importBackup(this)">
            </div>
            <div class="card-menu" onclick="document.getElementById('dataPackInput').click()" style="border-color:#8B5CF6;">
                <span class="menu-icon">üìÇ</span>
                <div class="menu-text"><h3 style="color:#8B5CF6;">Veri Paketi Y√ºkle</h3><p>kelimeler / kalƒ±plar / deyimler (.js veya .json)</p></div>
                <input type="file" id="dataPackInput" accept=".json,.js" style="display:none" onchange="importDataFile(this)">
            </div>

            <div class="card-menu" onclick="resetAllData()" style="border-color:#EF4444;">
                <span class="menu-icon">‚ö†Ô∏è</span>
                <div class="menu-text"><h3 style="color:#EF4444;" data-lang="reset">Sƒ±fƒ±rla</h3><p data-lang="reset_desc">T√ºm ilerlemeyi sil</p></div>
            </div>
        </div>
    </div>

    <div class="screen" id="addScreen">
        <div class="header">
            <button class="btn-back" onclick="show('settingsScreen')">
            <svg class="icon-back" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <span class="mini-word-art" data-lang="add_data">Veri Ekle</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content">
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button id="btnSingle" class="add-option-btn active" onclick="setAddMode('single')" data-lang="add_single">Tekli Ekle</button>
                <button id="btnBulk" class="add-option-btn" onclick="setAddMode('bulk')" data-lang="add_bulk">Toplu Ekle</button>
            </div>

            <div id="singleMode">
                <select id="addCat" class="input-field">
                    <option value="KELƒ∞MELER" data-lang="words">Kelimeler</option>
                    <option value="KALIPLAR" data-lang="phrases">Kalƒ±plar</option>
                    <option value="DEYƒ∞MLER" data-lang="idioms">Deyimler</option>
                </select>
                <select id="addLvl" class="input-field"><option>A1</option><option>A2</option><option>B1</option><option>B2</option><option>C1</option><option>C2</option></select>
                <input id="addEng" class="input-field" placeholder="ƒ∞ngilizce">
                <input id="addTr" class="input-field" placeholder="T√ºrk√ße">
                <button class="btn-green" onclick="addSingle()" data-lang="save">KAYDET</button>
            </div>
            
            <div id="bulkMode" style="display:none;">
                <p style="color:#666; font-size:0.85rem; line-height:1.2; margin-bottom:10px;">
                    Format: Se√ßilen kategoriye g√∂re uygun formatƒ± kullanƒ±n.
                </p>
                <select id="bulkCat" class="input-field">
                    <option value="KELƒ∞MELER" data-lang="words">Kelimeler</option>
                    <option value="KALIPLAR" data-lang="phrases">Kalƒ±plar</option>
                    <option value="DEYƒ∞MLER" data-lang="idioms">Deyimler</option>
                </select>
                
                <input type="file" id="fileInput" accept=".txt" style="display:none" onchange="loadFile()">
                <button class="btn-file-upload" onclick="document.getElementById('fileInput').click()" data-lang="btn_upload">üìÅ TXT Dosyasƒ± Y√ºkle</button>

                <textarea id="bulkInput" class="input-field" style="height:250px; font-size:0.85rem;" placeholder='KELƒ∞MELER ƒ∞√áƒ∞N 6 SATIRLI BLOK FORMATI...&#10;DEYƒ∞M VE KALIP ƒ∞√áƒ∞N SEVƒ∞YE BAZLI FORMAT...'></textarea>
                <button class="btn-green" onclick="addBulk()" data-lang="bulk_save">TOPLU KAYDET</button>
            </div>
        </div>
    </div>

    <div class="screen" id="levelScreen">
        <div class="header">
            <button class="btn-back" onclick="show('homeScreen')">
                <svg class="icon-back" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <span class="mini-word-art" id="catTitle">KATEGORƒ∞</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content">
            <div id="levelsGrid" class="grid-menu"></div>
        </div>
    </div>

    <div class="screen" id="dashboardScreen">
        <div class="header">
            <button class="btn-back" onclick="show('levelScreen')">
                <svg class="icon-back" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <span class="mini-word-art" id="dashTitle">Seviye</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content">
<div id="levelProgressBox" style="background: white; padding: 15px; border-radius: 16px; border: 2px solid #F1F5F9; margin-bottom: 20px;">
    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
        <span id="levelProgressText" style="font-weight: 800; color: #1E293B; font-size: 0.8rem;">Seviye ƒ∞lerlemesi</span>
        <span id="levelPercent" style="font-weight: 800; color: #3B82F6; font-size: 0.8rem;">%0</span>
    </div>
    <div style="width: 100%; height: 10px; background: #F1F5F9; border-radius: 10px; overflow: hidden; margin-bottom: 8px;">
        <div id="levelProgressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #3B82F6, #22C55E); transition: width 0.4s;"></div>
    </div>
    <div style="display: flex; justify-content: space-between; font-size: 0.7rem; font-weight: 700;">
        <span style="color: #22C55E;">√ñƒürenilen: <span id="lvlLearned">0</span></span>
        <span style="color: #EF4444;">Kalan: <span id="lvlUnknown">0</span></span>
    </div>
</div>
            <h3 class="mini-word-art" style="font-size:1rem; color:#666; margin-top:0;" data-lang="games">Oyunlar</h3>
            <div class="card-menu" onclick="initGame('quiz')">
                <span class="menu-icon">üìù</span>
                <div class="menu-text"><h3 data-lang="quiz_game">Test (Quiz)</h3><p data-lang="quiz_desc">10 Soru</p></div>
            </div>
            <div class="card-menu" onclick="initGame('match')">
                <span class="menu-icon">üß©</span>
                <div class="menu-text"><h3 data-lang="match_game">E≈üle≈ütirme</h3><p data-lang="match_desc">5 √áift</p></div>
            </div>
            <div class="card-menu" onclick="initGame('flash')">
                <span class="menu-icon">üÉè</span>
                <div class="menu-text"><h3 data-lang="flash_game">Kartlar</h3><p data-lang="flash_desc">10 Kart</p></div>
            </div>

            <h3 class="mini-word-art" style="font-size:1rem; color:#666; margin-top:20px;" data-lang="progress">Geli≈üim</h3>
            <div class="card-menu" onclick="show('srsScreen')">
                <span class="menu-icon">üß†</span>
                <div class="menu-text"><h3 data-lang="smart_review">Akƒ±llƒ± Tekrar</h3><p data-lang="srs_desc">SRS ve Bilinmeyenler</p></div>
            </div>
            <div class="card-menu" onclick="showChartScreen()">
                <span class="menu-icon">üìä</span>
                <div class="menu-text"><h3 data-lang="stats">ƒ∞statistikler</h3><p data-lang="stats_desc">Geli≈üim raporu</p></div>
            </div>
        </div>
    </div>

    <div class="screen" id="quizScreen">
        <div class="header">
            <button class="btn-back" onclick="show('dashboardScreen')">‚úï</button>
            <span class="mini-word-art" data-lang="quiz_game">Test</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content" style="display:flex; flex-direction:column; justify-content:center;">
    <div style="text-align:center;">
        <span id="quizCounter">1 / 10</span>
    </div>
    <div class="quiz-question" id="qText">WORD</div>
    <div class="quiz-grid" id="qOptions"></div>
</div>
    </div>

    <div class="screen" id="matchScreen">
        <div class="header">
            <button class="btn-back" onclick="show('dashboardScreen')">‚úï</button>
            <span class="mini-word-art" data-lang="match_game">E≈üle≈ütirme</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content">
            <div class="match-grid" id="matchGrid"></div>
        </div>
    </div>

    <div class="screen" id="flashScreen">
        <div class="header">
            <button class="btn-back" onclick="show('dashboardScreen')">‚úï</button>
            <span class="mini-word-art" data-lang="flash_game">Kartlar</span>
            <span id="fcCounter" style="font-size:.8rem;font-weight:700;color:var(--muted);">1 / 10</span>
        </div>
        <div class="content" style="display:flex; flex-direction:column; padding-top:8px; padding-bottom:16px; overflow:hidden;">
            <div class="card-box" onclick="flipCard()">
                <div class="card-inner" id="fcCard">
                    <div class="card-face card-front" id="fcFront">
                        <!-- renderFlash() ile doldurulur -->
                    </div>
                    <div class="card-face card-back" id="fcBackContent">
                        <!-- updateFCBackFace() ile doldurulur -->
                    </div>
                </div>
            </div>
            <div class="fc-btn-row">
                <button class="btn-know"  id="btnKnow"  onclick="nextCard(true)">‚úÖ <span data-lang="know">Biliyorum</span></button>
                <button class="btn-again" id="btnAgain" onclick="nextCard(false)">üîÑ <span data-lang="dont_know">Tekrar</span></button>
            </div>
        </div>
    </div>

    <div class="screen" id="resultScreen">
        <div class="content" style="display:flex; flex-direction:column; justify-content:center; align-items:center;">
            <div class="result-box">
                <div class="result-score" id="resultScore">%100</div>
                <div class="result-label" data-lang="success_rate">BA≈ûARI ORANI</div>
            </div>
            <p id="resultMsg" style="color:#666; font-size:1.1rem; margin-bottom:30px; text-align:center; font-weight:700;"></p>
            <button class="btn-green" onclick="show('dashboardScreen')" data-lang="continue">DEVAM ET</button>
        </div>
    </div>

    <div class="screen" id="srsScreen">
        <div class="header">
            <button class="btn-back" onclick="show('dashboardScreen')">
                <svg class="icon-back" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <span class="mini-word-art" data-lang="smart_review">Akƒ±llƒ± Tekrar</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content">
            <div class="card-menu" onclick="startUnknownGame()">
                <span class="menu-icon">üÜï</span>
                <div class="menu-text"><h3 data-lang="study_unknown">Bilinmeyenleri √áalƒ±≈ü</h3><p data-lang="study_unknown_desc">Hen√ºz √∂ƒürenilmeyenler</p></div>
            </div>
            <div class="card-menu" onclick="startSRSGame()">
                <span class="menu-icon">üìÖ</span>
                <div class="menu-text"><h3 data-lang="daily_review">G√ºnl√ºk Tekrar (SRS)</h3><p data-lang="daily_review_desc">Unutmak √ºzere olduklarƒ±n</p></div>
            </div>
        </div>
    </div>

    <div class="screen" id="chartScreen">
        <div class="top-bar">
            <div class="logo-area">
                <div style="width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--lvl-main),var(--lvl-dark));display:flex;align-items:center;justify-content:center;font-size:1.3rem;">üìä</div>
                <div>
                    <div class="logo-main">ƒ∞statistikler</div>
                    <div class="logo-sub">Geli≈üim Raporu</div>
                </div>
            </div>
        </div>
        <div class="content has-tabbar">
            <h3 class="mini-word-art" style="font-size:0.85rem; color:#666; margin-bottom:10px;">√ñƒürenme S√ºreci (Kategori Bazlƒ±)</h3>
            <canvas id="srsChart"></canvas>
            <h3 class="mini-word-art" style="font-size:0.85rem; margin-top:25px; color:#666; margin-bottom:10px;">Toplam Tekrar Sayƒ±larƒ±</h3>
            <canvas id="repeatChart"></canvas>
            <div class="stats-summary">
                <div class="stat-item"><span class="stat-val" id="statTotal">0</span><span class="stat-lbl" data-lang="total">Toplam</span></div>
                <div class="stat-item"><span class="stat-val" style="color:#22C55E;" id="statLearned">0</span><span class="stat-lbl" data-lang="learned">√ñƒürenilen</span></div>
                <div class="stat-item"><span class="stat-val" style="color:#EF4444;" id="statUnknown">0</span><span class="stat-lbl" data-lang="unknown">Bilinmeyen</span></div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         PROFƒ∞L EKRANI
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="screen" id="profileScreen">
        <div class="top-bar">
            <div class="logo-area">
                <div style="width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--lvl-main),var(--lvl-dark));display:flex;align-items:center;justify-content:center;font-size:1.3rem;">üë§</div>
                <div>
                    <div class="logo-main">Profil</div>
                    <div class="logo-sub">Ayarlar & ƒ∞lerleme</div>
                </div>
            </div>
        </div>
        <div class="content has-tabbar" style="padding-top:0;">

            <!-- Avatar + isim + email + rozetler -->
            <div class="profile-avatar-wrap">
                <div class="profile-avatar" id="pAvatar" onclick="changeAvatar()">
                    <span id="pAvatarEmoji">üß†</span>
                </div>
                <div class="profile-name" id="pUserName">Word Master</div>
                <div class="profile-email" id="pUserEmail"></div>
                <div class="profile-level-badge" id="pLevelBadge">üå± Sprout ‚Äî A1</div>
                <div class="profile-admin-badge" id="pAdminBadge" style="display:none">üëë ADMƒ∞N</div>
            </div>

            <!-- Stats: KELƒ∞ME | METƒ∞N | STREAK | QUƒ∞Z -->
            <div class="profile-stats-row">
                <div class="profile-stat-box">
                    <div class="profile-stat-val" id="pStatTotal">0</div>
                    <div class="profile-stat-lbl">KELƒ∞ME</div>
                </div>
                <div class="profile-stat-box">
                    <div class="profile-stat-val" id="pStatLearned" style="color:var(--lvl-dark);">0</div>
                    <div class="profile-stat-lbl">METƒ∞N</div>
                </div>
                <div class="profile-stat-box">
                    <div class="profile-stat-val" id="pStatStreak" style="color:var(--tree-dark);">0</div>
                    <div class="profile-stat-lbl">STREAK</div>
                </div>
                <div class="profile-stat-box">
                    <div class="profile-stat-val" id="pStatPct" style="color:var(--galaxy-dark);">‚Äî</div>
                    <div class="profile-stat-lbl">QUƒ∞Z</div>
                </div>
            </div>

            <!-- BA≈ûARILAR -->
            <span class="section-label">BA≈ûARILAR</span>
            <div class="ach-grid" id="achGrid"></div>

            <!-- AYARLAR -->
            <span class="section-label">AYARLAR</span>
            <div class="profile-menu">
                <button class="profile-menu-item" onclick="openAdmin()">
                    <span class="mi-icon">üìÅ</span><span>Veri Y√∂netimi</span><span class="mi-arrow">‚Ä∫</span>
                </button>
                <button class="profile-menu-item" onclick="alert('Bildirim ayarlarƒ± yakƒ±nda!')">
                    <span class="mi-icon">üîî</span><span>Bildirim Ayarlarƒ±</span><span class="mi-arrow">‚Ä∫</span>
                </button>
                <button class="profile-menu-item" onclick="toggleDarkMode()">
                    <span class="mi-icon" id="pDarkIcon">üåô</span>
                    <span id="pDarkLabel">Karanlƒ±k Mod</span>
                    <div class="toggle-sw" id="pDarkToggle"></div>
                </button>
                <button class="profile-menu-item" onclick="toggleLanguage(); renderProfile();">
                    <span class="mi-icon">üåê</span>
                    <span>Aray√ºz Dili</span>
                    <span class="mi-val" id="pLangVal">EN</span>
                </button>
                <button class="profile-menu-item" onclick="openGoalPicker()">
                    <span class="mi-icon">üéØ</span>
                    <span>G√ºnl√ºk Hedef</span>
                    <span class="mi-val" id="pGoalVal">10 kelime</span>
                </button>
            </div>

            <!-- Bilgi -->
            <div class="profile-menu">
                <button class="profile-menu-item" onclick="alert('LinguiVance Word Master\nSenseLab ¬© 2026\nv18.2')">
                    <span class="mi-icon">‚ÑπÔ∏è</span><span>Hakkƒ±nda</span><span class="mi-arrow">‚Ä∫</span>
                </button>
                <button class="profile-menu-item" onclick="alert('Gizlilik politikasƒ± i√ßin senselab.com.tr adresini ziyaret edin.')">
                    <span class="mi-icon">üîí</span><span>Gizlilik Politikasƒ±</span><span class="mi-arrow">‚Ä∫</span>
                </button>
                <button class="profile-menu-item" onclick="alert('Kullanƒ±m ko≈üullarƒ± i√ßin senselab.com.tr adresini ziyaret edin.')">
                    <span class="mi-icon">üìã</span><span>Kullanƒ±m Ko≈üullarƒ±</span><span class="mi-arrow">‚Ä∫</span>
                </button>
            </div>

            <!-- Hesap -->
            <div class="profile-menu" style="margin-bottom:24px;">
                <button class="profile-menu-item" onclick="authLogout()">
                    <span class="mi-icon">üö™</span><span>√áƒ±kƒ±≈ü Yap</span><span class="mi-arrow">‚Ä∫</span>
                </button>
                <button class="profile-menu-item danger" onclick="resetAllData()">
                    <span class="mi-icon">üóëÔ∏è</span><span>T√ºm Verileri Sƒ±fƒ±rla</span><span class="mi-arrow">‚Ä∫</span>
                </button>
            </div>

            <div style="text-align:center;font-size:.72rem;color:var(--muted);margin-top:4px;padding-bottom:4px;">LinguiVance Word Master ‚Äî SenseLab ¬© 2026</div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê ALT NAVƒ∞GASYON BAR ‚ïê‚ïê‚ïê -->
    <nav class="tab-bar" id="tabBar">
        <button class="tab-item active" id="tab-home" onclick="tabGo('home')">
            <span class="tab-icon">üè†</span>
            <span class="tab-label">Ana Sayfa</span>
        </button>
        <button class="tab-item" id="tab-words" onclick="tabGo('words')">
            <span class="tab-icon">üìö</span>
            <span class="tab-label">Kelimeler</span>
        </button>
        <button class="tab-item" id="tab-stats" onclick="tabGo('stats')">
            <span class="tab-icon">üìä</span>
            <span class="tab-label">ƒ∞statistikler</span>
        </button>
        <button class="tab-item" id="tab-profile" onclick="tabGo('profile')">
            <span class="tab-icon">üë§</span>
            <span class="tab-label">Profil</span>
        </button>
    </nav>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     Gƒ∞Rƒ∞≈û EKRANI (AUTH)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="authScreen" role="dialog" aria-modal="true">
  <div class="auth-card">
    <div class="auth-logo">
      <div class="auth-logo-emoji">üìñ</div>
      <div class="auth-logo-title">LinguiVance</div>
      <div class="auth-logo-sub">Word Master ‚Äî Kelime Oyunu</div>
    </div>
    <div class="auth-tabs" role="tablist">
      <button class="auth-tab-btn active" id="authTabLogin" onclick="authSwitchTab('login')">Giri≈ü Yap</button>
      <button class="auth-tab-btn" id="authTabReg" onclick="authSwitchTab('reg')">Kayƒ±t Ol</button>
    </div>
    <div class="auth-form active" id="authFormLogin">
      <div class="auth-field">
        <label for="authLoginEmail">E-posta / Kullanƒ±cƒ± Adƒ±</label>
        <input type="text" id="authLoginEmail" placeholder="ornek@mail.com" autocomplete="username email">
      </div>
      <div class="auth-field">
        <label for="authLoginPw">≈ûifre</label>
        <input type="password" id="authLoginPw" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" onkeydown="if(event.key==='Enter')authLogin()">
      </div>
      <div class="auth-err" id="authErrLogin"></div>
      <button class="auth-submit" onclick="authLogin()">Giri≈ü Yap ‚Üí</button>
      <div style="text-align:center;margin-top:8px;">
        <button onclick="authSwitchTab('reg')" style="background:none;border:none;color:var(--muted);font-size:.8rem;cursor:pointer;box-shadow:none;width:auto;padding:4px 8px;margin:0;text-transform:none;">Hesabƒ±n yok mu? Kayƒ±t ol</button>
      </div>
    </div>
    <div class="auth-form" id="authFormReg">
      <div class="auth-field">
        <label for="authRegName">Ad Soyad</label>
        <input type="text" id="authRegName" placeholder="Adƒ±nƒ±z..." maxlength="40" autocomplete="name">
      </div>
      <div class="auth-field">
        <label for="authRegEmail">E-posta</label>
        <input type="email" id="authRegEmail" placeholder="ornek@mail.com" autocomplete="email">
      </div>
      <div class="auth-field">
        <label for="authRegPw">≈ûifre <span>(en az 6 karakter)</span></label>
        <input type="password" id="authRegPw" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password">
      </div>
      <div class="auth-field">
        <label for="authRegPw2">≈ûifre Tekrar</label>
        <input type="password" id="authRegPw2" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password" onkeydown="if(event.key==='Enter')authRegister()">
      </div>
      <div class="auth-err" id="authErrReg"></div>
      <button class="auth-submit" onclick="authRegister()">Kayƒ±t Ol ‚Üí</button>
    </div>
    <div class="auth-footer">LinguiVance Word Master ‚Äî SenseLab ¬© 2026</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ONBOARDING ‚Äî ƒ∞LK KURULUM (5 ADIM)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="onboarding">
  <!-- Adƒ±m 1: Ho≈ü Geldin -->
  <div class="ob-step active" id="ob1">
    <div class="ob-emoji">üìñ</div>
    <div class="ob-title">Word Master'a Ho≈ü Geldin!</div>
    <div class="ob-sub">Kelimeler, kalƒ±plar ve deyimleri oyunla≈ütƒ±rƒ±lmƒ±≈ü y√∂ntemle √∂ƒüren. Ba≈ülamak i√ßin birka√ß ayar yapalƒ±m.</div>
    <button class="ob-btn-primary" onclick="obNext(2)">Ba≈ülayalƒ±m ‚Üí</button>
  </div>
  <!-- Adƒ±m 2: ƒ∞sim + Avatar -->
  <div class="ob-step" id="ob2">
    <div class="ob-emoji">üòä</div>
    <div class="ob-title">Seni Tanƒ±yalƒ±m</div>
    <div class="ob-sub">ƒ∞smini yaz ve bir avatar se√ß.</div>
    <input class="ob-input" id="obNameInput" placeholder="Adƒ±n..." maxlength="30" style="margin-bottom:14px;">
    <div class="ob-avatars" id="obAvatarGrid"></div>
    <div style="font-size:2.2rem;margin:8px 0;" id="obAvatarPreview">üòä</div>
    <button class="ob-btn-primary" onclick="obSaveName()">Devam ‚Üí</button>
  </div>
  <!-- Adƒ±m 3: Seviye Se√ß -->
  <div class="ob-step" id="ob3">
    <div class="ob-emoji">üéØ</div>
    <div class="ob-title">Seviyeni Se√ß</div>
    <div class="ob-sub">Mevcut ƒ∞ngilizce seviyene en uygun olanƒ± se√ß.</div>
    <div class="ob-levels" id="obLevelGrid"></div>
    <button class="ob-btn-primary" id="obLvlNext" onclick="obFinishLevel()" disabled style="opacity:.5;">Devam ‚Üí</button>
  </div>
  <!-- Adƒ±m 4: G√ºnl√ºk Hedef -->
  <div class="ob-step" id="ob4">
    <div class="ob-emoji">üèÜ</div>
    <div class="ob-title">G√ºnl√ºk Hedef</div>
    <div class="ob-sub">G√ºnde ka√ß √∂ƒüe √ßalƒ±≈ümak istiyorsun?</div>
    <div class="ob-goals">
      <div class="ob-level-card" onclick="selectGoal(this,10)"><div class="ob-lc-icon">‚ö°</div><div class="ob-lc-name">10</div><div class="ob-lc-cefr">Kolay ba≈ülangƒ±√ß</div></div>
      <div class="ob-level-card" onclick="selectGoal(this,30)"><div class="ob-lc-icon">üî•</div><div class="ob-lc-name">30</div><div class="ob-lc-cefr">D√ºzenli √ßalƒ±≈üma</div></div>
      <div class="ob-level-card" onclick="selectGoal(this,50)"><div class="ob-lc-icon">üí™</div><div class="ob-lc-name">50</div><div class="ob-lc-cefr">Yoƒüun tempo</div></div>
      <div class="ob-level-card" onclick="selectGoal(this,100)"><div class="ob-lc-icon">üöÄ</div><div class="ob-lc-name">100</div><div class="ob-lc-cefr">Maksimum √∂ƒürenme</div></div>
    </div>
    <button class="ob-btn-primary" id="obGoalNext" onclick="obFinishGoal()" disabled style="opacity:.5;">Devam ‚Üí</button>
  </div>
  <!-- Adƒ±m 5: Seviye Belirleme Sƒ±navƒ± -->
  <div class="ob-step" id="ob5">
    <div class="ob-emoji">üìù</div>
    <div class="ob-title">Seviye Belirleme</div>
    <div class="ob-sub">Kƒ±sa bir sƒ±nav ile ger√ßek seviyeni belirleyelim (isteƒüe baƒülƒ±).</div>
    <div id="ptStartArea" style="width:100%;">
      <button class="ob-btn-primary" onclick="startPlacementTest()">Sƒ±navƒ± Ba≈ülat ‚Üí</button>
      <button class="ob-btn-secondary" onclick="skipPlacementTest()">Atla, Seviyemi Biliyorum</button>
    </div>
    <div id="ptTestArea" style="width:100%;display:none;">
      <div class="pt-progress" id="ptProgress"></div>
      <div id="ptQuestion" class="pt-question"></div>
      <div id="ptOptions" class="pt-options"></div>
      <div class="pt-result" id="ptResult">
        <div style="font-size:3rem;" id="ptResultEmoji">üéì</div>
        <div style="font-size:1.1rem;font-weight:800;margin:10px 0;" id="ptResultLevel">Seviye Tespit Edildi</div>
        <div style="font-size:.82rem;color:var(--muted);" id="ptResultSub"></div>
        <button class="ob-btn-primary" style="margin-top:14px;" onclick="obComplete()">Harika! Ba≈ülayalƒ±m üéâ</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ADMƒ∞N Gƒ∞Rƒ∞≈û OVERLAY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="adminLoginOverlay" onclick="if(event.target===this)closeAdminLogin()">
  <div class="admin-login-card">
    <div style="text-align:center;margin-bottom:18px;">
      <div style="font-size:2.8rem;">üõ°Ô∏è</div>
      <div style="font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:700;color:var(--text);margin-top:6px;">Admin Giri≈üi</div>
      <div style="font-size:.78rem;color:var(--muted);">Word Master Y√∂netici Paneli</div>
    </div>
    <input type="password" id="adminPwInput" placeholder="Admin ≈üifresi..." style="width:100%;height:46px;border:2px solid var(--border);border-radius:13px;padding:0 15px;font-size:.9rem;font-family:'DM Sans',sans-serif;box-sizing:border-box;background:var(--bg);" onkeydown="if(event.key==='Enter')adminLogin()">
    <div id="adminPwError" style="display:none;color:#ef4444;font-size:.78rem;font-weight:600;margin:6px 0;">‚ùå ≈ûifre hatalƒ±</div>
    <button onclick="adminLogin()" style="width:100%;height:46px;background:linear-gradient(135deg,var(--lvl-main),var(--lvl-dark));color:white;border:none;border-radius:13px;font-weight:700;cursor:pointer;margin-top:8px;font-size:.9rem;box-shadow:none;text-transform:none;">Giri≈ü Yap</button>
    <button onclick="closeAdminLogin()" style="width:100%;height:42px;background:none;border:2px solid var(--border);border-radius:13px;font-weight:600;cursor:pointer;color:var(--muted);margin-top:6px;box-shadow:none;text-transform:none;">ƒ∞ptal</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ADMƒ∞N PANELƒ∞
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="adminPanel">
  <div class="admin-header">
    <button onclick="closeAdminPanel()" style="background:var(--bg);border:2px solid var(--border);border-radius:50%;width:38px;height:38px;font-size:1.1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;box-shadow:none;margin:0;padding:0;">‚Üê</button>
    <div>
      <div style="font-family:'Playfair Display',serif;font-weight:700;font-size:1.05rem;color:var(--text);">Admin Paneli</div>
      <div style="font-size:.68rem;color:var(--muted);">Word Master Y√∂netici</div>
    </div>
  </div>
  <div class="admin-tabs">
    <button class="admin-tab-btn active" id="atab-users" onclick="adminSwitchTab('users')">üë• Kullanƒ±cƒ±lar</button>
    <button class="admin-tab-btn" id="atab-data" onclick="adminSwitchTab('data')">üì¶ Veriler</button>
    <button class="admin-tab-btn" id="atab-edit" onclick="adminSwitchTab('edit')">‚úèÔ∏è D√ºzenle</button>
    <button class="admin-tab-btn" id="atab-settings" onclick="adminSwitchTab('settings')">‚öôÔ∏è Ayarlar</button>
  </div>
  <div class="admin-content">
    <!-- KULLANICILAR -->
    <div id="adminTabUsers" class="admin-tab-pane">
      <span class="admin-section-title">Kayƒ±tlƒ± Kullanƒ±cƒ±lar</span>
      <div class="admin-card" id="adminUsersList"><div style="color:var(--muted);font-size:.83rem;text-align:center;padding:10px;">Y√ºkleniyor...</div></div>
    </div>
    <!-- VERƒ∞LER -->
    <div id="adminTabData" class="admin-tab-pane" style="display:none;">
      <span class="admin-section-title">Veri ƒ∞statistikleri</span>
      <div class="admin-card" id="adminDataInfo"><div style="color:var(--muted);font-size:.83rem;text-align:center;padding:10px;">Y√ºkleniyor...</div></div>
      <span class="admin-section-title">Dosya Y√ºkle</span>
      <button class="admin-file-btn" onclick="document.getElementById('adminWordFile').click()">üìò kelimeler.js / .json y√ºkle<input type="file" id="adminWordFile" style="display:none" accept=".json,.js,.txt" onchange="adminHandleFile(this,'kelimeler')"></button>
      <button class="admin-file-btn" onclick="document.getElementById('adminKalipFile').click()">üó£Ô∏è kaliplar.js / .json y√ºkle<input type="file" id="adminKalipFile" style="display:none" accept=".json,.js,.txt" onchange="adminHandleFile(this,'kaliplar')"></button>
      <button class="admin-file-btn" onclick="document.getElementById('adminDeyimFile').click()">üî• deyimler.js / .json y√ºkle<input type="file" id="adminDeyimFile" style="display:none" accept=".json,.js,.txt" onchange="adminHandleFile(this,'deyimler')"></button>
      <button class="admin-file-btn" onclick="document.getElementById('adminSinavFile').click()">üìù sinavlar.js / .json y√ºkle<input type="file" id="adminSinavFile" style="display:none" accept=".json,.js,.txt" onchange="adminHandleFile(this,'sinav')"></button>
      <span class="admin-section-title">Dƒ±≈üa Aktar</span>
      <button class="admin-file-btn" onclick="adminExportAll()" style="border-color:var(--lvl-main);color:var(--lvl-dark);">üì§ T√ºm Veriyi Dƒ±≈üa Aktar</button>
      <button class="admin-file-btn" onclick="document.getElementById('adminImportFile').click()" style="border-color:#8B5CF6;color:#7C3AED;">üì• Yedekten Geri Y√ºkle<input type="file" id="adminImportFile" style="display:none" accept=".json" onchange="adminImportBackup(this)"></button>
    </div>
    <!-- D√úZENLE -->
    <div id="adminTabEdit" class="admin-tab-pane" style="display:none;">
      <span class="admin-section-title">Kategori ƒ∞statistikleri</span>
      <div class="admin-card" id="adminEditStats"><div style="color:var(--muted);font-size:.83rem;text-align:center;padding:10px;">Y√ºkleniyor...</div></div>
      <span class="admin-section-title">Sƒ±nav Durumu</span>
      <div class="admin-card" id="adminSinavInfo"><div style="color:var(--muted);font-size:.83rem;text-align:center;padding:10px;">Y√ºkleniyor...</div></div>
    </div>
    <!-- AYARLAR -->
    <div id="adminTabSettings" class="admin-tab-pane" style="display:none;">
      <span class="admin-section-title">Admin ≈ûifresi</span>
      <div class="admin-card">
        <div style="font-size:.83rem;color:var(--muted);margin-bottom:9px;">Mevcut ≈üifre: <strong id="adminCurPwShow">***</strong></div>
        <input type="password" id="adminNewPw" placeholder="Yeni ≈üifre..." style="width:100%;height:42px;border:2px solid var(--border);border-radius:11px;padding:0 13px;font-size:.88rem;font-family:'DM Sans',sans-serif;box-sizing:border-box;margin-bottom:7px;background:var(--bg);">
        <button onclick="adminChangePassword()" style="width:100%;height:42px;background:var(--lvl-dark);color:white;border:none;border-radius:11px;font-weight:700;cursor:pointer;font-size:.82rem;text-transform:none;box-shadow:none;">≈ûifreyi G√ºncelle</button>
      </div>
      <span class="admin-section-title">Sistem</span>
      <div class="admin-card">
        <button onclick="adminResetSystem()" style="width:100%;height:42px;background:#ef4444;color:white;border:none;border-radius:11px;font-weight:700;cursor:pointer;font-size:.82rem;text-transform:none;box-shadow:none;margin:0;">‚ö†Ô∏è T√ºm Sistemi Sƒ±fƒ±rla</button>
      </div>
      <span class="admin-section-title">Hesap</span>
      <div class="admin-card">
        <button onclick="authLogout()" style="width:100%;height:42px;background:var(--border);color:var(--text);border:none;border-radius:11px;font-weight:700;cursor:pointer;font-size:.82rem;text-transform:none;box-shadow:none;margin:0;">üö™ Oturumu Kapat</button>
      </div>
    </div>
  </div>
</div>

<script>
/* === Sƒ∞STEM & VERƒ∞ === */
const LEVELS = ["A1", "A2", "B1", "B2", "C1", "C2"];
let DATA = {}, SRS_DATA = {};
let activeCat = "", activeLvl = "";
let gamePool = [], currentIndex = 0, currentWord = null;
let matchSelected = null, chartInstance = null, repeatChartInstance = null;
const ONE_DAY = 24 * 60 * 60 * 1000;
const SRS_INTERVALS = [ONE_DAY, 3*ONE_DAY, 7*ONE_DAY, 15*ONE_DAY, 30*ONE_DAY];
let sessionCorrect = 0, sessionTotal = 0;
let currentLang = localStorage.getItem("WM_LANG") || "tr";

const LANG = {
    tr: { words: "Kelimeler", words_desc: "Kelime hazineni geli≈ütir", phrases: "Kalƒ±plar", phrases_desc: "G√ºnl√ºk konu≈üma yapƒ±larƒ±", idioms: "Deyimler", idioms_desc: "ƒ∞leri seviye ifadeler", msg_perfect: "M√ºkemmel! üéâ", msg_good: "G√ºzel! üí™", msg_bad: "√áalƒ±≈ümalƒ±sƒ±n! üìö", streak: "G√ºnl√ºk Seri!", alert_min: "En az {n} √∂ƒüe gerekli.", alert_added: "Eklendi!", alert_bulk_added: "{n} √∂ƒüe eklendi!", alert_no_unknown: "Bilinmeyen kalmadƒ±!", alert_no_srs: "Tekrarƒ± gelen yok.", btn_upload: "üìÅ TXT Dosyasƒ± Y√ºkle", file_loaded: "Dosya Y√ºklendi!", success_rate: "BA≈ûARI ORANI", continue: "DEVAM ET", study_unknown: "Bilinmeyenleri √áalƒ±≈ü", daily_review: "G√ºnl√ºk Tekrar (SRS)", total: "Toplam", learned: "√ñƒürenilen", unknown: "Bilinmeyen" },
    en: { words: "Words", words_desc: "Build vocabulary", phrases: "Phrases", phrases_desc: "Daily patterns", idioms: "Idioms", idioms_desc: "Advanced expressions", msg_perfect: "Perfect! üéâ", msg_good: "Great! üí™", msg_bad: "Keep practicing! üìö", streak: "Day Streak!", alert_min: "Min {n} items required.", alert_added: "Added!", alert_bulk_added: "{n} items added!", alert_no_unknown: "No unknown items!", alert_no_srs: "No reviews due.", btn_upload: "üìÅ Upload TXT", file_loaded: "File Loaded!", success_rate: "SUCCESS RATE", continue: "CONTINUE", study_unknown: "Study Unknowns", daily_review: "Daily Review", total: "Total", learned: "Learned", unknown: "Unknown" }
};

window.onload = async () => {
    initDB();
    await loadExternalData();   // async fetch ‚Äî kelimeler + kaliplar + deyimler
    loadPlacementFromGlobal();  // sinavlar.js (script tag ile y√ºklenmi≈ü)
    checkStreak();
    applyLanguage();
    if (localStorage.getItem('WM_DARK') === '1') document.body.classList.add('dark-mode');
    profileEmojiIdx = parseInt(localStorage.getItem('WM_AVATAR') || '0');

    const session = getAuthSession();
    if (!session) {
        document.getElementById('authScreen').style.display = 'flex';
        document.getElementById('tabBar').style.display = 'none';
    } else {
        applyAuthToUI();
        checkOnboarding();
    }
};

function initDB() {
    let stored = localStorage.getItem("WM_DB_V16");
    DATA = stored ? JSON.parse(stored) : { "KELƒ∞MELER":{}, "KALIPLAR":{}, "DEYƒ∞MLER":{} };
    for(let cat in DATA) { LEVELS.forEach(l => { if(!DATA[cat][l]) DATA[cat][l] = []; }); }
    SRS_DATA = JSON.parse(localStorage.getItem("WM_SRS_V16") || "{}");
}

/* ‚îÄ‚îÄ ASYNC FETCH TABANLI VERƒ∞ Y√úKLEYƒ∞Cƒ∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Her dosya izole Function scope'ta √ßalƒ±≈ütƒ±rƒ±lƒ±r ‚Üí const √ßakƒ±≈ümasƒ± yok.
   kelimeler.js ‚Üí WORD_DATA   ‚Üí KELƒ∞MELER
   kaliplar.js  ‚Üí KALIP_DATA  ‚Üí KALIPLAR  (kalƒ±plar.js de denenir)
   deyimler.js  ‚Üí WORD_DATA   ‚Üí DEYƒ∞MLER  (izole scope'ta √ßakƒ±≈üma yok)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
async function fetchJsFile(filename, varName) {
    try {
        const r = await fetch(filename);
        if (!r.ok) return null;
        const text = await r.text();
        const fn = new Function(text + `; return (typeof ${varName}!=="undefined")?${varName}:null;`);
        return fn();
    } catch(e) { return null; }
}

async function loadExternalData() {
    let changed = false;
    // KELƒ∞MELER ‚Äî kelimeler.js (WORD_DATA)
    const words = await fetchJsFile('kelimeler.js', 'WORD_DATA');
    if (Array.isArray(words) && words.length > 0) changed |= mergeRawArray('KELƒ∞MELER', words);
    // KALIPLAR ‚Äî kaliplar.js veya kalƒ±plar.js (KALIP_DATA veya WORD_DATA)
    let kalips = await fetchJsFile('kaliplar.js', 'KALIP_DATA')
             || await fetchJsFile('kaliplar.js', 'WORD_DATA')
             || await fetchJsFile('kal%C4%B1plar.js', 'KALIP_DATA')
             || await fetchJsFile('kal%C4%B1plar.js', 'WORD_DATA');
    if (Array.isArray(kalips) && kalips.length > 0) changed |= mergeRawArray('KALIPLAR', kalips);
    // DEYƒ∞MLER ‚Äî deyimler.js (WORD_DATA ‚Äî izole scope'ta √ßakƒ±≈üma yok)
    const deyims = await fetchJsFile('deyimler.js', 'WORD_DATA');
    if (Array.isArray(deyims) && deyims.length > 0) changed |= mergeRawArray('DEYƒ∞MLER', deyims);
    if (changed) saveDB();
    updateMainStats();
}

/* Gelen ham diziyi DATA[cat] i√ßine birle≈ütir.
   Desteklenen formatlar:
   1) Normal  ‚Üí { "ƒ∞ngilizceKelime": "run", "T√ºrk√ßeAnlam": "ko≈ümak", ... }
   2) Sƒ±kƒ±≈ütƒ±rƒ±lmƒ±≈ü ‚Üí { "Seviye : Deyim Eng : Deyim Tr": "B1\t:\thit the nail : isabet" }
*/
function mergeRawArray(cat, rawArray) {
    let added = false;
    rawArray.forEach(item => {
        let parsed = parseItem(item);
        if (!parsed) return;
        let { lvl, engVal, trVal, typeEn, typeTr, def, defTr, ex, exTr, ex2, ex2Tr, grammar } = parsed;
        let exists = DATA[cat][lvl].some(w => w.eng === engVal);
        if (exists) return;
        DATA[cat][lvl].push({ eng: engVal, tr: trVal, typeEn, typeTr, def, defTr, ex, exTr, ex2, ex2Tr, grammar, lvl, src: "external" });
        added = true;
    });
    return added;
}

/* Bir ham nesneyi normalize ederek ayrƒ±≈ütƒ±rƒ±r */
function parseItem(item) {
    // FORMAT 2: Sƒ±kƒ±≈ütƒ±rƒ±lmƒ±≈ü ‚Äî tek bir birle≈üik key-value √ßifti
    // √ñrnek: { "Seviye : Deyim Eng : Deyim Tr": "B1\t:\thit the nail on the head : tam isabet" }
    const keys = Object.keys(item);
    if (keys.length === 1 && keys[0].includes(" : ")) {
        const val = item[keys[0]] || "";
        // Ayƒ±rƒ±cƒ±: tab + " : " veya sadece " : "
        const parts = val.split(/\t\s*:\s*|\s*:\s*/);
        if (parts.length < 2) return null;
        const lvl = (parts[0] || "A1").toUpperCase().trim();
        if (!LEVELS.includes(lvl)) return null;
        // 2 par√ßa: sadece ƒ∞ngilizce (T√ºrk√ßesi yok) ‚Äî 3+ par√ßa: son par√ßa T√ºrk√ße
        const tr  = parts.length >= 3 ? parts[parts.length - 1].trim() : "";
        const eng = parts.length >= 3
            ? parts.slice(1, parts.length - 1).join(":").trim()
            : parts[1].trim();
        if (!eng) return null;
        return { lvl, engVal: eng, trVal: tr, typeEn:"", typeTr:"", def:"", defTr:"", ex:"", exTr:"", ex2:"", ex2Tr:"", grammar:"" };
    }

    // FORMAT 1: Normal geni≈ületilmi≈ü format
    const lvl = (item["Kelimenin Seviyesi"] || item["Seviye"] || "A1").toUpperCase().trim();
    if (!LEVELS.includes(lvl)) return null;
    const engVal = (item["ƒ∞ngilizceKelime"] || item["ƒ∞ngilizce"] || item["eng"] || "").trim();
    if (!engVal) return null;
    return {
        lvl,
        engVal,
        trVal:   (item["T√ºrk√ßeAnlam"]          || item["T√ºrk√ße"]   || item["tr"]     || "").trim(),
        typeEn:  (item["ƒ∞ngilizceT√ºr"]           || item["typeEn"]   || "").trim(),
        typeTr:  (item["T√ºrk√ßeT√ºr"]              || item["typeTr"]   || "").trim(),
        def:     (item["ƒ∞ngilizceTanƒ±m"]         || item["Tanƒ±m"]    || item["def"]    || "").trim(),
        defTr:   (item["T√ºrk√ßeTanƒ±m"]            || item["Tanƒ±mTR"]  || item["defTr"]  || "").trim(),
        ex:      (item["√ñrnekC√ºmle1_ƒ∞ngilizce"]  || item["√ñrnek"]    || item["ex"]     || "").trim(),
        exTr:    (item["√ñrnekC√ºmle1_T√ºrk√ße"]     || item["√ñrnekTR"]  || item["exTr"]   || "").trim(),
        ex2:     (item["√ñrnekC√ºmle2_ƒ∞ngilizce"]  || item["ex2"]      || "").trim(),
        ex2Tr:   (item["√ñrnekC√ºmle2_T√ºrk√ße"]     || item["ex2Tr"]    || "").trim(),
        grammar: (item["Dilbilgisi"]             || item["grammar"]  || "").trim()
    };
}

function saveDB() {
    localStorage.setItem("WM_DB_V16", JSON.stringify(DATA));
    localStorage.setItem("WM_SRS_V16", JSON.stringify(SRS_DATA));
    localStorage.setItem("INIT", "1");
}

function checkStreak() {
    let last = localStorage.getItem("LAST_VISIT"), streak = parseInt(localStorage.getItem("STREAK")||0);
    let todayDate = new Date();
    if(last !== todayDate.toDateString()) {
        let yest = new Date(); yest.setDate(yest.getDate()-1);
        streak = (last === yest.toDateString()) ? streak + 1 : 1;
        localStorage.setItem("LAST_VISIT", todayDate.toDateString());
        localStorage.setItem("STREAK", streak);
    }
    document.getElementById("streakDisplay").innerText = streak + " " + LANG[currentLang].streak;
    let dayCircle = document.getElementById("day-" + todayDate.getDay());
    if(dayCircle) dayCircle.classList.add("active");
}

/* G√∂sterildiƒüinde tab-bar gizlenecek ekranlar */
const NO_TAB_SCREENS = new Set(['quizScreen','matchScreen','flashScreen','resultScreen',
    'levelScreen','dashboardScreen','srsScreen','settingsScreen','addScreen']);

function show(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    const tabBar = document.getElementById('tabBar');
    if (tabBar) tabBar.style.display = NO_TAB_SCREENS.has(id) ? 'none' : 'flex';
}

/* ‚îÄ‚îÄ‚îÄ TAB NAVƒ∞GASYON ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function tabGo(tab) {
    document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
    const btn = document.getElementById('tab-' + tab);
    if (btn) btn.classList.add('active');
    if      (tab === 'home')    show('homeScreen');
    else if (tab === 'words')   show('homeScreen');   // kategori se√ßimi homeScreen'de
    else if (tab === 'stats')   { showChartScreen(); }
    else if (tab === 'profile') { renderProfile(); show('profileScreen'); }
}

/* ‚îÄ‚îÄ‚îÄ PROFƒ∞L RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const EMOJI_POOL = ['üß†','üìñ','üéØ','üöÄ','üåü','üí™','ü¶ä','üê¨','ü¶Å','üåà','üéì','‚ö°'];
let profileEmojiIdx = 0;

function changeAvatar() {
    profileEmojiIdx = (profileEmojiIdx + 1) % EMOJI_POOL.length;
    const el = document.getElementById('pAvatarEmoji');
    if (el) el.textContent = EMOJI_POOL[profileEmojiIdx];
    localStorage.setItem('WM_AVATAR', profileEmojiIdx);
}

const PROFILE_ACHIEVEMENTS = [
    { id:'first_word', icon:'‚≠ê', label:'ƒ∞LK\nKELƒ∞ME',    check:(l,s,q)=>l>=1 },
    { id:'words_10',   icon:'üåø', label:'10\nKELƒ∞ME',     check:(l,s,q)=>l>=10 },
    { id:'words_50',   icon:'üéØ', label:'50\nKELƒ∞ME',     check:(l,s,q)=>l>=50 },
    { id:'words_100',  icon:'üèÖ', label:'100\nKELƒ∞ME',    check:(l,s,q)=>l>=100 },
    { id:'first_quiz', icon:'üèÜ', label:'ƒ∞LK\nQUƒ∞Z',      check:(l,s,q)=>q>0 },
    { id:'perfect',    icon:'üî•', label:'M√úKEMMEL',        check:(l,s,q)=>q>=100 },
    { id:'streak_3',   icon:'üíé', label:'3 G√úN\nSERƒ∞Sƒ∞',  check:(l,s,q)=>s>=3 },
    { id:'streak_7',   icon:'üìñ', label:'7 G√úN\nSERƒ∞Sƒ∞',  check:(l,s,q)=>s>=7 },
    { id:'streak_30',  icon:'üëë', label:'1 AY\nSERƒ∞Sƒ∞',   check:(l,s,q)=>s>=30 },
    { id:'words_1000', icon:'üåà', label:'1000\nKELƒ∞ME',   check:(l,s,q)=>l>=1000 },
];

function renderProfile() {
    // Avatar
    profileEmojiIdx = parseInt(localStorage.getItem('WM_AVATAR') || '0');
    const avEl = document.getElementById('pAvatarEmoji');
    if (avEl) avEl.textContent = EMOJI_POOL[profileEmojiIdx];

    // Kullanƒ±cƒ± bilgileri
    const session = getAuthSession();
    const users = getAuthUsers();
    const user = session ? users.find(u => u.id === session) : null;
    const setEl = (id, val) => { const e = document.getElementById(id); if (e) e.textContent = val; };
    setEl('pUserName', user ? user.name : 'Word Master');
    const emailEl = document.getElementById('pUserEmail');
    if (emailEl) emailEl.textContent = user ? (user.email || '') : '';
    const adminBadgeEl = document.getElementById('pAdminBadge');
    if (adminBadgeEl) adminBadgeEl.style.display = (user && user.isAdmin) ? 'inline-block' : 'none';

    // Seviye rozeti (kullanƒ±cƒ±nƒ±n se√ßtiƒüi seviyeye g√∂re)
    const LEVEL_INFO = [
        { icon:'üå±', cefr:'A1', label:'Sprout ‚Äî A1',   body:'Sprout' },
        { icon:'üåø', cefr:'A2', label:'Sapling ‚Äî A2',  body:'Sapling' },
        { icon:'üå≥', cefr:'B1', label:'Tree ‚Äî B1',     body:'Tree' },
        { icon:'üå≤', cefr:'B2', label:'Forest ‚Äî B2',   body:'Forest' },
        { icon:'üèîÔ∏è', cefr:'C1', label:'Mountain ‚Äî C1', body:'Mountain' },
        { icon:'üöÄ', cefr:'C2', label:'Galaxy ‚Äî C2',   body:'Galaxy' },
    ];
    const userLevel = (user && user.level) ? user.level : 'A1';
    const lvlInfo = LEVEL_INFO.find(l => l.cefr === userLevel) || LEVEL_INFO[0];
    const badgeEl = document.getElementById('pLevelBadge');
    if (badgeEl) badgeEl.textContent = lvlInfo.icon + ' ' + lvlInfo.label;
    document.body.setAttribute('data-level', lvlInfo.body);

    // ƒ∞statistikler: KELƒ∞ME (kelimeler), METƒ∞N (kalƒ±p+deyim), STREAK, QUƒ∞Z
    let kelime = 0, metin = 0, total = 0;
    for (let c in DATA) {
        const isMetin = (c === 'KALIPLAR' || c === 'DEYƒ∞MLER');
        for (let l in DATA[c]) {
            DATA[c][l].forEach(w => {
                total++;
                const lrnd = SRS_DATA[w.eng] && SRS_DATA[w.eng].stage > 0;
                if (isMetin) { if (lrnd) metin++; } else { if (lrnd) kelime++; }
            });
        }
    }
    const streak  = parseInt(localStorage.getItem('STREAK') || '0');
    const pct     = total > 0 ? Math.round(((kelime + metin) / total) * 100) : 0;
    const quizPct = parseInt(localStorage.getItem('WM_QUIZ_PCT') || String(pct));

    setEl('pStatTotal',   kelime);
    setEl('pStatLearned', metin);
    setEl('pStatStreak',  streak);
    setEl('pStatPct',     total > 0 ? '%' + quizPct : '‚Äî');

    // G√ºnl√ºk hedef
    const goal = (user && user.dailyGoal) || parseInt(localStorage.getItem('WM_DAILY_GOAL') || '10');
    setEl('pGoalVal', goal + ' kelime');

    // Dil deƒüeri
    const langEl = document.getElementById('pLangVal');
    if (langEl) langEl.textContent = currentLang === 'tr' ? 'TR' : 'EN';

    // Dark mode toggle
    const isDark = document.body.classList.contains('dark-mode');
    const toggleEl = document.getElementById('pDarkToggle');
    if (toggleEl) toggleEl.classList.toggle('on', isDark);

    // Ba≈üarƒ±lar
    const achGrid = document.getElementById('achGrid');
    if (achGrid) {
        achGrid.innerHTML = PROFILE_ACHIEVEMENTS.map(a => {
            const earned = a.check(kelime, streak, quizPct);
            return `<div class="ach-item">
                <div class="ach-icon${earned ? ' earned' : ''}">${a.icon}</div>
                <div class="ach-lbl">${a.label.replace(/\n/g,'<br>')}</div>
            </div>`;
        }).join('');
    }
}

function openGoalPicker() {
    const goals = [10, 30, 50, 100];
    const current = parseInt(localStorage.getItem('WM_DAILY_GOAL') || '10');
    const chosen = prompt('G√ºnl√ºk hedef se√ßin (10 / 30 / 50 / 100):', current);
    if (chosen === null) return;
    const val = parseInt(chosen);
    if (!goals.includes(val)) { notify('‚ùå Ge√ßersiz deƒüer. 10, 30, 50 veya 100 girin.'); return; }
    localStorage.setItem('WM_DAILY_GOAL', val);
    const session = getAuthSession();
    if (session) {
        const users = getAuthUsers();
        const idx = users.findIndex(u => u.id === session);
        if (idx >= 0) { users[idx].dailyGoal = val; localStorage.setItem(WM_AUTH_USERS_KEY, JSON.stringify(users)); }
    }
    renderProfile();
    notify('‚úÖ G√ºnl√ºk hedef: ' + val + ' kelime');
}

/* ‚îÄ‚îÄ‚îÄ DARK MODE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    localStorage.setItem('WM_DARK', isDark ? '1' : '0');
    const toggleEl = document.getElementById('pDarkToggle');
    if (toggleEl) toggleEl.classList.toggle('on', isDark);
}

/* LinguiVance seviye paleti ‚Äî birebir aynƒ± */
const LVL_META = [
    { cefr:'A1', name:'Sprout',   icon:'üå±', color:'#4ade80', dark:'#16a34a', body:'Sprout' },
    { cefr:'A2', name:'Sapling',  icon:'üåø', color:'#34d399', dark:'#059669', body:'Sapling' },
    { cefr:'B1', name:'Tree',     icon:'üå≥', color:'#fbbf24', dark:'#d97706', body:'Tree' },
    { cefr:'B2', name:'Forest',   icon:'üå≤', color:'#fb923c', dark:'#ea580c', body:'Forest' },
    { cefr:'C1', name:'Mountain', icon:'üèîÔ∏è', color:'#f87171', dark:'#dc2626', body:'Mountain' },
    { cefr:'C2', name:'Galaxy',   icon:'üöÄ', color:'#a78bfa', dark:'#7c3aed', body:'Galaxy' },
];

function selectCategory(cat) {
    activeCat = cat;
    let grid = document.getElementById("levelsGrid");
    grid.innerHTML = "";
    LVL_META.forEach(m => {
        let count = (DATA[cat] && DATA[cat][m.cefr]) ? DATA[cat][m.cefr].length : 0;
        grid.innerHTML += `
        <button class="level-btn" onclick="selectLevel('${m.cefr}','${m.body}')"
            style="background:linear-gradient(135deg,${m.color},${m.dark});">
            <span class="lvl-icon">${m.icon}</span>
            <span class="lvl-name">${m.name}</span>
            <span class="lvl-cefr">${m.cefr} ¬∑ ${count} √∂ƒüe</span>
        </button>`;
    });
    document.getElementById("catTitle").innerText = cat;
    show('levelScreen');
}

function selectLevel(l, bodyLevel) {
    activeLvl = l;
    // Aktif seviye rengini LinguiVance stiliyle uygula
    if (bodyLevel) document.body.setAttribute('data-level', bodyLevel);
    document.getElementById("dashTitle").innerText = l;
    show('dashboardScreen');
    updateLevelStats();
}

function initGame(mode) {
    let pool = DATA[activeCat][activeLvl];
    if(pool.length < 4) return alert(LANG[currentLang].alert_min.replace("{n}", 4));
    gamePool = [...pool].sort(() => 0.5 - Math.random()).slice(0, 10);
    currentIndex = 0; sessionCorrect = 0; sessionTotal = 0;
    if(mode === 'quiz') { show('quizScreen'); renderQuiz(); }
    else if(mode === 'match') { show('matchScreen'); renderMatch(); }
    else { show('flashScreen'); renderFlash(); }
}

let fcShowTurkish = false; // Dil durumunu takip etmek i√ßin global deƒüi≈üken

function renderFlash() {
    if (currentIndex >= gamePool.length) return finishGameWithResult();
    currentWord = gamePool[currentIndex];

    document.getElementById("fcCounter").innerText = (currentIndex + 1) + " / " + gamePool.length;
    document.getElementById("fcCard").classList.remove("flipped");

    // √ñN Y√úZ
    const fcFront = document.getElementById("fcFront");
    fcFront.style.alignItems = 'center';
    fcFront.style.justifyContent = 'center';
    fcFront.style.padding = '28px 24px';
    fcFront.innerHTML = `
        <div style="font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:1.8px;color:var(--muted);margin-bottom:10px;text-align:center;">
            English ‚Äî Turkish
        </div>
        <div style="font-family:'Playfair Display',serif;font-size:2.5rem;font-weight:700;color:var(--lvl-main);line-height:1.1;text-align:center;margin-bottom:5px;">
            ${currentWord.eng || ''}
        </div>
        ${currentWord.typeEn ? `<div style="font-size:.8rem;color:var(--muted);font-style:italic;text-align:center;margin-bottom:14px;">${currentWord.typeEn}</div>` : '<div style="margin-bottom:14px;"></div>'}
        <div id="fcMeaningArea" style="text-align:center;min-height:34px;margin-bottom:12px;display:flex;align-items:center;justify-content:center;">
        </div>
        <button id="btnShowMeaning"
            onclick="event.stopPropagation(); showCardMeaning()"
            style="width:auto;padding:5px 16px;background:transparent;border:1.5px solid var(--lvl-main);color:var(--lvl-main);border-radius:20px;font-size:.72rem;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;display:inline-flex;align-items:center;justify-content:center;gap:5px;margin:0 0 10px 0;white-space:nowrap;">
            <span style="width:6px;height:6px;background:var(--lvl-main);border-radius:50%;flex-shrink:0;"></span>
            Anlamƒ± g√∂r
        </button>
        <button onclick="event.stopPropagation(); TTS(currentWord.eng)"
            style="width:auto;padding:7px 20px;background:transparent;border:1.5px solid var(--border);color:var(--text);border-radius:20px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;display:inline-flex;align-items:center;gap:6px;margin:0 0 10px 0;">
            üîä Telaffuz
        </button>
        <div class="card-hint" style="margin-top:2px;">Detay i√ßin kartƒ± √ßevir üëÜ</div>
    `;

    updateFCBackFace();
    TTS(currentWord.eng);
}

function updateFCBackFace() {
    const backFace = document.getElementById('fcBackContent');
    const w = currentWord;
    if (!backFace || !w) return;

    /* Her b√∂l√ºm i√ßin EN ve TR metni data-* i√ßinde sakla ‚Äî hi√ßbir element kaybolmaz */
    const sec = (icon, labelEn, valEn, labelTr, valTr, valStyle='') => {
        const ve = (valEn || '').trim(), vt = (valTr || '').trim();
        if (!ve && !vt) return '';
        const iconStyle = icon === '‚òÖ' ? 'color:var(--lvl-main);font-size:1rem;' : '';
        return `
        <div class="card-section">
            <div class="card-section-icon" style="${iconStyle}">${icon}</div>
            <div style="flex:1;min-width:0;">
                <div class="card-section-label fc-sw" data-en="${labelEn}" data-tr="${labelTr}">${labelEn}</div>
                <div class="card-section-val fc-sw" style="${valStyle}" data-en="${ve}" data-tr="${vt || ve}">${ve}</div>
            </div>
        </div>`;
    };

    backFace.innerHTML = `
        <div class="card-back-header" style="padding:14px 16px 12px;">
            <div style="font-family:'Playfair Display',serif;font-size:1.35rem;font-weight:700;color:white;margin-bottom:10px;line-height:1.2;">
                ${w.tr || '‚Äî'}
            </div>
            <button onclick="event.stopPropagation(); TTS(currentWord.eng)"
                style="background:rgba(255,255,255,.18);border:1.5px solid rgba(255,255,255,.55);color:white;padding:6px 14px;border-radius:20px;font-size:.82rem;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;">
                üîä ${w.eng}
            </button>
        </div>
        <div class="card-back-body" style="flex:1;overflow-y:auto;padding:4px 16px 8px;">
            ${sec('‚òÖ','TYPE', w.typeEn, 'T√úR', w.typeTr, 'color:var(--lvl-main);font-weight:700;font-size:.88rem;')}
            ${sec('üìñ','DEFINITION', w.def, 'TANIM', w.defTr, 'font-size:.82rem;line-height:1.4;')}
            ${w.ex  ? sec('üí¨','EXAMPLE 1', w.ex,  '√ñRNEK 1', w.exTr,  'font-size:.82rem;font-style:italic;line-height:1.4;color:var(--muted);') : ''}
            ${w.ex2 ? sec('üí¨','EXAMPLE 2', w.ex2, '√ñRNEK 2', w.ex2Tr, 'font-size:.82rem;font-style:italic;line-height:1.4;color:var(--muted);') : ''}
        </div>
        <div style="padding:10px 16px 12px;flex-shrink:0;">
            <button id="btnTranslate" data-lang="en"
                onclick="event.stopPropagation(); toggleCardTranslation()"
                style="width:100%;padding:13px;background:var(--lvl-main);color:white;border:none;border-radius:14px;font-size:.9rem;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;box-shadow:0 4px 0 var(--lvl-dark);">
                ‚áå T√ºrk√ße Moda Ge√ß
            </button>
        </div>
    `;
}

function showCardMeaning() {
    const area = document.getElementById('fcMeaningArea');
    const btn  = document.getElementById('btnShowMeaning');
    if (!area || !currentWord || !btn) return;

    const isShowing = btn.dataset.showing === '1';
    if (isShowing) {
        // Gizle ‚Üí eski hale d√∂n
        area.innerHTML = '';
        btn.dataset.showing = '0';
        btn.innerHTML = `<span style="width:6px;height:6px;background:var(--lvl-main);border-radius:50%;flex-shrink:0;"></span> Anlamƒ± g√∂r`;
    } else {
        // G√∂ster ‚Üí anlam belir
        area.innerHTML = `
            <div style="font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:700;color:var(--lvl-main);line-height:1.2;text-align:center;">
                ${currentWord.tr || '‚Äî'}
            </div>`;
        btn.dataset.showing = '1';
        btn.innerHTML = `<span style="width:6px;height:6px;background:var(--lvl-main);border-radius:50%;flex-shrink:0;"></span> Gizle`;
    }
}

function toggleCardTranslation() {
    const btn = document.getElementById('btnTranslate');
    if (!btn) return;
    const toTR = btn.dataset.lang !== 'tr';
    btn.dataset.lang = toTR ? 'tr' : 'en';
    btn.textContent  = toTR ? '‚áå ƒ∞ngilizce Moda Ge√ß' : '‚áå T√ºrk√ße Moda Ge√ß';

    /* T√ºm fc-sw elementlerinin metnini yerinde g√ºncelle ‚Äî layout kaymasƒ± yok */
    document.querySelectorAll('.fc-sw').forEach(el => {
        el.textContent = toTR ? (el.dataset.tr || el.dataset.en || '') : (el.dataset.en || '');
    });
}

function flipCard() { document.getElementById("fcCard").classList.toggle("flipped"); }

function nextCard(known) {
    // √áift tƒ±klamayƒ± √∂nle
    const btns = [document.getElementById('btnKnow'), document.getElementById('btnAgain')];
    btns.forEach(b => { if (b) b.disabled = true; });
    sessionTotal++;
    if (known) sessionCorrect++;
    try { updateSRS(currentWord, known); } catch(e) {}
    const card = document.getElementById("fcCard");
    const proceed = () => {
        currentIndex++;
        renderFlash();
        btns.forEach(b => { if (b) b.disabled = false; });
    };
    if (card && card.classList.contains("flipped")) {
        card.classList.remove("flipped");
        setTimeout(proceed, 580);
    } else {
        proceed();
    }
}

let _quizOpts = [];
function renderQuiz() {
    if(currentIndex >= gamePool.length) return finishGameWithResult();
    currentWord = gamePool[currentIndex];
    document.getElementById("quizCounter").innerText = (currentIndex + 1) + " / " + gamePool.length;
    document.getElementById("qText").innerText = currentWord.eng;
    TTS(currentWord.eng);
    let opts = [currentWord.tr], all = DATA[activeCat][activeLvl].map(w => w.tr);
    while(opts.length < 4) { let r = all[Math.floor(Math.random()*all.length)]; if(!opts.includes(r)) opts.push(r); }
    opts.sort(() => 0.5 - Math.random());
    _quizOpts = opts;
    // Cevabƒ± index ile ilet (single-quote sorunundan ka√ßƒ±nmak i√ßin)
    document.getElementById("qOptions").innerHTML = opts.map((opt, i) =>
        `<div class="quiz-opt" onclick="checkQuiz(this,${i})">${opt}</div>`
    ).join("");
}
function checkQuiz(btn, idx) {
    // ≈ûƒ±klarƒ± kilitleyerek √ßift tƒ±klamayƒ± √∂nle
    document.querySelectorAll('.quiz-opt').forEach(b => { b.onclick = null; b.style.pointerEvents = 'none'; });
    const ans = _quizOpts[idx];
    sessionTotal++;
    if(ans === currentWord.tr) {
        btn.classList.add("correct"); sessionCorrect++;
        try { updateSRS(currentWord, true); } catch(e) {}
        setTimeout(() => { currentIndex++; renderQuiz(); }, 800);
    } else {
        btn.classList.add("wrong");
        document.querySelectorAll('.quiz-opt').forEach(b => { if(b.textContent === currentWord.tr) b.classList.add("correct"); });
        try { updateSRS(currentWord, false); } catch(e) {}
        setTimeout(() => { currentIndex++; renderQuiz(); }, 1500);
    }
}

function renderMatch() {
    let items = []; let pool = gamePool.slice(0, 5);
    pool.forEach(w => { items.push({ id: w.eng, text: w.eng }); items.push({ id: w.eng, text: w.tr }); });
    items.sort(() => 0.5 - Math.random());
    let grid = document.getElementById("matchGrid"); grid.innerHTML = "";
    items.forEach((item, i) => {
        let div = document.createElement("div");
        div.className = "match-card mc-" + ((i % 6) + 1);
        div.innerText = item.text; div.dataset.id = item.id;
        div.onclick = () => handleMatch(div);
        grid.appendChild(div);
    });
}
function handleMatch(el) {
    if(el.classList.contains("matched") || el.classList.contains("selected")) return;
    el.classList.add("selected");
    if(!matchSelected) { matchSelected = el; } 
    else {
        sessionTotal++;
        if(matchSelected.dataset.id === el.dataset.id) {
            matchSelected.classList.remove("selected"); el.classList.remove("selected");
            matchSelected.classList.add("matched"); el.classList.add("matched");
            matchSelected = null; sessionCorrect++;
            if(document.querySelectorAll('.match-card:not(.matched)').length === 0) finishGameWithResult();
        } else {
            setTimeout(() => { matchSelected.classList.remove("selected"); el.classList.remove("selected"); matchSelected = null; }, 500);
        }
    }
}

function finishGameWithResult() {
    let perc = Math.round((sessionCorrect / sessionTotal) * 100) || 0;
    document.getElementById("resultScore").innerText = `%${perc}`;
    document.getElementById("resultMsg").innerText = perc >= 80 ? LANG[currentLang].msg_perfect : (perc >= 50 ? LANG[currentLang].msg_good : LANG[currentLang].msg_bad);
    show('resultScreen');
updateMainStats(); updateLevelStats();
}
// ... √∂nceki fonksiyonlar (show, selectLevel vs.) ...

/* BURAYA YAPI≈ûTIRABƒ∞Lƒ∞RSƒ∞N */
function addSingle() {
    const eng = document.getElementById("addEng").value.trim();
    const tr = document.getElementById("addTr").value.trim();
    const cat = document.getElementById("addCat").value;
    const lvl = document.getElementById("addLvl").value;

    if(!eng || !tr) return alert("L√ºtfen alanlarƒ± doldurun!");

    DATA[cat][lvl].push({
        eng: eng, tr: tr, lvl: lvl, 
        typeEn: "", typeTr: "", def: "", defTr: "", ex: "", exTr: "", ex2: "", ex2Tr: ""
    });
    
    saveDB();
    updateMainStats();
    alert(LANG[currentLang].alert_added);
    document.getElementById("addEng").value = "";
    document.getElementById("addTr").value = "";
}

/* === GELƒ∞≈ûMƒ∞≈û PARSER (KELƒ∞ME VS DEYƒ∞M/KALIP AYRIMI) === */
function addBulk() {
    const text = document.getElementById("bulkInput").value.trim();
    if (!text) return;
    const cat = document.getElementById("bulkCat").value;
    let count = 0;
updateMainStats();

    const lines = text.split("\n").map(l => l.trim()).filter(l => l);

    if (cat === "KELƒ∞MELER") {
        // Yeni 11 S√ºtunlu Format: 
        // Seviye | Kelime | T√ºrk√ße | T√ºr EN | T√ºr TR | Def EN | Def TR | √ñrnek1 EN | √ñrnek1 TR | √ñrnek2 EN | √ñrnek2 TR
        lines.forEach(line => {
            const p = line.split("|").map(i => i.trim());
            if (p.length >= 11) {
                const entryLvl = p[0].toUpperCase();
                if (LEVELS.includes(entryLvl)) {
                    DATA[cat][entryLvl].push({
                        eng: p[1],
                        tr: p[2],
                        typeEn: p[3],
                        typeTr: p[4],
                        def: p[5],
                        defTr: p[6],
                        ex: p[7],
                        exTr: p[8],
                        ex2: p[9],
                        ex2Tr: p[10],
                        lvl: entryLvl
                    });
                    count++;
                }
            }
        });
    } else {
        // Kalƒ±plar ve Deyimler i√ßin mevcut (Seviye satƒ±rƒ± + " : " formatƒ±) korunur
        let currentBulkLvl = "A1";
        lines.forEach(line => {
            if (LEVELS.includes(line.toUpperCase())) {
                currentBulkLvl = line.toUpperCase();
            } else if (line.includes(" : ")) {
                let parts = line.split(" : ");
                DATA[cat][currentBulkLvl].push({ 
                    eng: parts[0].trim(), 
                    tr: parts[1].trim(), 
                    ex: "", 
                    grammar: "", 
                    lvl: currentBulkLvl 
                });
                count++;
            }
        });
    }
    
    saveDB(); 
    alert(LANG[currentLang].alert_bulk_added.replace("{n}", count));
    document.getElementById("bulkInput").value = "";
}

function updateSRS(w, c) {
    if(!SRS_DATA[w.eng]) SRS_DATA[w.eng] = { stage: 0, repeats: 0 };
    if(c) {
        SRS_DATA[w.eng].stage = Math.min((SRS_DATA[w.eng].stage || 0) + 1, 5);
        SRS_DATA[w.eng].repeats = (SRS_DATA[w.eng].repeats || 0) + 1;
    } else { SRS_DATA[w.eng].stage = 0; } // Yanlƒ±≈üsa 0'lanƒ±r -> Bilinmeyenler havuzu
    saveDB();
}

function startUnknownGame() {
    let pool = []; for(let c in DATA) for(let l in DATA[c]) pool = pool.concat(DATA[c][l]);
    let target = pool.filter(w => !SRS_DATA[w.eng] || SRS_DATA[w.eng].stage === 0);
    if(target.length === 0) return alert(LANG[currentLang].alert_no_unknown);
    gamePool = target.sort(() => 0.5 - Math.random()).slice(0, 10); currentIndex = 0; sessionCorrect = 0; sessionTotal = 0; show('flashScreen'); renderFlash();
}
function startSRSGame() {
    let pool = []; for(let c in DATA) for(let l in DATA[c]) pool = pool.concat(DATA[c][l]);
    let target = pool.filter(w => SRS_DATA[w.eng] && SRS_DATA[w.eng].stage > 0);
    if(target.length === 0) return alert(LANG[currentLang].alert_no_srs);
    gamePool = target.sort(() => 0.5 - Math.random()).slice(0, 10); currentIndex = 0; sessionCorrect = 0; sessionTotal = 0; show('quizScreen'); renderQuiz();
}

/* === ƒ∞STATƒ∞STƒ∞KLERƒ∞ KATEGORƒ∞ BAZLI (3 RENKLƒ∞) G√ñSTEREN G√úNCEL FONKSƒ∞YON === */
function showChartScreen() {
    show('chartScreen');
    
    // Her kategori i√ßin ayrƒ± veri havuzlarƒ±
    let catStats = {
        "KELƒ∞MELER": { s: [0,0,0,0,0,0], r: [0,0,0,0,0] },
        "KALIPLAR": { s: [0,0,0,0,0,0], r: [0,0,0,0,0] },
        "DEYƒ∞MLER": { s: [0,0,0,0,0,0], r: [0,0,0,0,0] }
    };
    
    let totalAll = 0, learnedAll = 0;

    // T√ºm veriyi kategorilerine g√∂re tara
    for (let cat in DATA) {
        for (let lvl in DATA[cat]) {
            DATA[cat][lvl].forEach(w => {
                totalAll++;
                let s = SRS_DATA[w.eng] ? (SRS_DATA[w.eng].stage || 0) : 0;
                let r = SRS_DATA[w.eng] ? (SRS_DATA[w.eng].repeats || 0) : 0;
                
                catStats[cat].s[s]++; // S√ºre√ß verisi
                
                // Tekrar daƒüƒ±lƒ±m verisi
                if(r >= 15) catStats[cat].r[4]++;
                else if(r >= 7) catStats[cat].r[3]++;
                else if(r >= 5) catStats[cat].r[2]++;
                else if(r >= 3) catStats[cat].r[1]++;
                else if(r >= 1) catStats[cat].r[0]++;

                if(s > 0) learnedAll++;
            });
        }
    }

    // √ñzet bilgileri g√ºncelle
    document.getElementById("statTotal").innerText = totalAll;
    document.getElementById("statLearned").innerText = learnedAll;
    document.getElementById("statUnknown").innerText = totalAll - learnedAll;

    // GRAFƒ∞K 1: S√ºre√ß Daƒüƒ±lƒ±mƒ± (Kelimeler: Mavi, Kalƒ±plar: Ye≈üil, Deyimler: Turuncu)
    if(chartInstance) chartInstance.destroy();
    chartInstance = new Chart(document.getElementById("srsChart"), {
        type: 'bar',
        data: {
            labels: ['Yeni', '1G', '3G', '7G', '15G', '30G'],
            datasets: [
                { label: 'Kelimeler', data: catStats["KELƒ∞MELER"].s, backgroundColor: '#3B82F6' },
                { label: 'Kalƒ±plar', data: catStats["KALIPLAR"].s, backgroundColor: '#22C55E' },
                { label: 'Deyimler', data: catStats["DEYƒ∞MLER"].s, backgroundColor: '#F59E0B' }
            ]
        },
        options: { scales: { x: { stacked: true }, y: { stacked: true } } }
    });

    // GRAFƒ∞K 2: Tekrar Daƒüƒ±lƒ±mƒ± (√áizgi Grafik - 3 Renk)
    if(repeatChartInstance) repeatChartInstance.destroy();
    repeatChartInstance = new Chart(document.getElementById("repeatChart"), {
        type: 'line',
        data: {
            labels: ['1 Rep', '3 Rep', '5 Rep', '7 Rep', '15+ Rep'],
            datasets: [
                { label: 'Kelimeler', data: catStats["KELƒ∞MELER"].r, borderColor: '#3B82F6', tension: 0.3, fill: false },
                { label: 'Kalƒ±plar', data: catStats["KALIPLAR"].r, borderColor: '#22C55E', tension: 0.3, fill: false },
                { label: 'Deyimler', data: catStats["DEYƒ∞MLER"].r, borderColor: '#F59E0B', tension: 0.3, fill: false }
            ]
        }
    });
}
function applyLanguage() { document.querySelectorAll("[data-lang]").forEach(el => { let key = el.getAttribute("data-lang"); if(LANG[currentLang][key]) el.innerText = LANG[currentLang][key]; }); }
function toggleLanguage() { currentLang = currentLang === "tr" ? "en" : "tr"; localStorage.setItem("WM_LANG", currentLang); applyLanguage(); checkStreak(); }
function TTS(t) { let u = new SpeechSynthesisUtterance(t); u.lang='en-US'; window.speechSynthesis.speak(u); }
function resetAllData() { if(confirm(LANG[currentLang].alert_reset)) { localStorage.clear(); location.reload(); } }
function loadFile() { const input = document.getElementById('fileInput'); if(input.files && input.files[0]) { const reader = new FileReader(); reader.onload = e => { document.getElementById('bulkInput').value = e.target.result; alert(LANG[currentLang].file_loaded); }; reader.readAsText(input.files[0]); } }
function setAddMode(mode) { isBulk = (mode === 'bulk'); document.getElementById("btnSingle").className = isBulk ? "add-option-btn" : "add-option-btn active"; document.getElementById("btnBulk").className = isBulk ? "add-option-btn active" : "add-option-btn"; document.getElementById("singleMode").style.display = isBulk ? "none" : "block"; document.getElementById("bulkMode").style.display = isBulk ? "block" : "none"; }
function updateMainStats() {
    let total = 0, learned = 0;
    for (let c in DATA) {
        for (let l in DATA[c]) {
            DATA[c][l].forEach(w => {
                total++;
                if (SRS_DATA[w.eng] && SRS_DATA[w.eng].stage > 0) learned++;
            });
        }
    }
    if(document.getElementById("mainTotal")) {
        document.getElementById("mainTotal").innerText = total;
        document.getElementById("mainLearned").innerText = learned;
        document.getElementById("mainUnknown").innerText = total - learned;
    }
}

function updateLevelStats() {
    if(!activeCat || !activeLvl) return;
    let pool = DATA[activeCat][activeLvl];
    let total = pool.length;
    let learned = pool.filter(w => SRS_DATA[w.eng] && SRS_DATA[w.eng].stage > 0).length;
    let percent = total > 0 ? Math.round((learned / total) * 100) : 0;

    document.getElementById("levelProgressText").innerText = `${activeCat} - ${activeLvl}`;
    document.getElementById("levelPercent").innerText = `%${percent}`;
    document.getElementById("levelProgressBar").style.width = `${percent}%`;
    document.getElementById("lvlLearned").innerText = learned;
    document.getElementById("lvlUnknown").innerText = total - learned;
}

/* === VERƒ∞ PAKETƒ∞ Y√úKLEME (kelimeler/kalƒ±plar/deyimler .json) ===
   Desteklenen formatlar:
   1) D√ºz dizi  ‚Üí [{"Kelimenin Seviyesi":"B1", "ƒ∞ngilizceKelime":"run", ...}, ...]
   2) Nesne     ‚Üí {"KELƒ∞MELER": {...d√ºzey bazlƒ±...}, "KALIPLAR": {...}, ...}
   3) Tam yedek ‚Üí {"DATA": {...}, "SRS_DATA": {...}}   ‚Üê importBackup'a y√∂nlendirilir
*/
function importDataFile(input) {
    if (!input.files || !input.files[0]) return;
    const fileName = input.files[0].name.toLowerCase();
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            let raw;
            const text = e.target.result;

            if (fileName.endsWith('.js')) {
                // .js dosyasƒ±nƒ± g√ºvenli bir Function scope i√ßinde √ßalƒ±≈ütƒ±r
                // (const √ßakƒ±≈ümasƒ± olmaz, tab karakterler de doƒüru i≈ülenir)
                try {
                    const fn = new Function(text + `
                        ;return (typeof DEYIM_DATA!=="undefined") ? DEYIM_DATA
                              : (typeof KALIP_DATA!=="undefined") ? KALIP_DATA
                              : (typeof WORD_DATA!=="undefined")  ? WORD_DATA
                              : null;
                    `);
                    raw = fn();
                } catch(e2) { raw = null; }
                if (!Array.isArray(raw)) { alert("JS dosyasƒ±nda ge√ßerli bir dizi bulunamadƒ±!\n" + fileName); return; }
            } else {
                raw = JSON.parse(text);
            }

            // Tam yedek formatƒ± ‚Üí mevcut importBackup'a y√∂nlendir
            if (raw && raw.DATA && raw.SRS_DATA) { importBackup(input); return; }

            let addedTotal = 0;

            // FORMAT 1: D√ºz dizi (kelimeler.json, kaliplar.json, deyimler.json)
            if (Array.isArray(raw)) {
                let cat = "KELƒ∞MELER";
                if (fileName.includes("kalip")) cat = "KALIPLAR";
                else if (fileName.includes("deyim")) cat = "DEYƒ∞MLER";
                addedTotal += mergeRawArray(cat, raw) ? raw.length : 0;
            }
            // FORMAT 2: Nesne { KELƒ∞MELER: [...], KALIPLAR: [...], DEYƒ∞MLER: [...] }
            else if (raw["KELƒ∞MELER"] || raw["KALIPLAR"] || raw["DEYƒ∞MLER"]) {
                ["KELƒ∞MELER","KALIPLAR","DEYƒ∞MLER"].forEach(cat => {
                    if (Array.isArray(raw[cat])) {
                        if (mergeRawArray(cat, raw[cat])) addedTotal += raw[cat].length;
                    } else if (raw[cat] && typeof raw[cat] === "object") {
                        // D√ºzey bazlƒ± nesne: { A1: [...], B1: [...] }
                        LEVELS.forEach(lvl => {
                            if (Array.isArray(raw[cat][lvl])) {
                                raw[cat][lvl].forEach(item => { item["Seviye"] = item["Seviye"] || lvl; });
                                if (mergeRawArray(cat, raw[cat][lvl])) addedTotal += raw[cat][lvl].length;
                            }
                        });

                    }
                });
            } else {
                alert("Tanƒ±nmayan veri formatƒ±!"); return;
            }

            saveDB();
            updateMainStats();
            alert("Veri paketi y√ºklendi! Uygulama yenileniyor...");
            location.reload();
        } catch(err) {
            alert("Dosya okunurken hata: " + err);
        }
    };
    reader.readAsText(input.files[0], "UTF-8");
    input.value = ""; // Aynƒ± dosyayƒ± tekrar se√ßmeye izin ver
}

/* === JSON YEDEKLEME FONKSƒ∞YONLARI === */
function exportBackup() {
    const backupData = {
        DATA: DATA,
        SRS_DATA: SRS_DATA,
        STREAK: localStorage.getItem("STREAK"),
        LAST_VISIT: localStorage.getItem("LAST_VISIT"),
        version: "v18.2"
    };
    const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `WordMaster_Backup_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function importBackup(input) {
    if (!input.files || !input.files[0]) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const imported = JSON.parse(e.target.result);
            if (imported.DATA && imported.SRS_DATA) {
                if (confirm("Bu i≈ülem mevcut t√ºm verilerinizin √ºzerine yazƒ±lacaktƒ±r. Devam etmek istiyor musunuz?")) {
                    DATA = imported.DATA;
                    SRS_DATA = imported.SRS_DATA;
                    if (imported.STREAK) localStorage.setItem("STREAK", imported.STREAK);
                    if (imported.LAST_VISIT) localStorage.setItem("LAST_VISIT", imported.LAST_VISIT);
                    saveDB();
                    alert("Yedek ba≈üarƒ±yla y√ºklendi! Uygulama yenileniyor...");
                    location.reload();
                }
            } else {
                alert("Ge√ßersiz yedek dosyasƒ±!");
            }
        } catch (err) {
            alert("Dosya okunurken bir hata olu≈ütu: " + err);
        }
    };
    reader.readAsText(input.files[0]);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AUTH ‚Äî Gƒ∞Rƒ∞≈û / KAYIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const WM_AUTH_USERS_KEY   = 'WM_AUTH_USERS';
const WM_AUTH_SESSION_KEY = 'WM_AUTH_SESSION';
const WM_ADMIN_PW_KEY     = 'WM_ADMIN_PW';

function getAuthUsers()   { return JSON.parse(localStorage.getItem(WM_AUTH_USERS_KEY) || '[]'); }
function getAuthSession() { return localStorage.getItem(WM_AUTH_SESSION_KEY); }
function getAdminPw()     { return localStorage.getItem(WM_ADMIN_PW_KEY) || 'admin123'; }
function saveAuthUsers(u) { localStorage.setItem(WM_AUTH_USERS_KEY, JSON.stringify(u)); }

async function hashPw(pw) {
    const enc = new TextEncoder();
    const buf = await crypto.subtle.digest('SHA-256', enc.encode(pw));
    return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
}

function authSwitchTab(tab) {
    document.querySelectorAll('.auth-tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
    document.getElementById('authTab' + (tab === 'login' ? 'Login' : 'Reg')).classList.add('active');
    document.getElementById('authForm' + (tab === 'login' ? 'Login' : 'Reg')).classList.add('active');
}

function authShowErr(id, msg) {
    const el = document.getElementById(id);
    if (el) { el.textContent = msg; setTimeout(() => { el.textContent = ''; }, 4000); }
}

async function authLogin() {
    const emailOrUser = (document.getElementById('authLoginEmail').value || '').trim().toLowerCase();
    const pw = document.getElementById('authLoginPw').value;
    if (!emailOrUser || !pw) { authShowErr('authErrLogin', 'E-posta ve ≈üifreyi girin.'); return; }
    const hashed = await hashPw(pw);
    const users = getAuthUsers();
    const matchUser = u => u.email === emailOrUser || (u.username && u.username.toLowerCase() === emailOrUser);
    const user = users.find(u => matchUser(u) && u.pw === hashed);
    if (!user) { authShowErr('authErrLogin', 'E-posta veya ≈üifre hatalƒ±.'); return; }
    localStorage.setItem(WM_AUTH_SESSION_KEY, user.id);
    document.getElementById('authScreen').style.display = 'none';
    applyAuthToUI();
    checkOnboarding();
}

async function authRegister() {
    const name  = (document.getElementById('authRegName').value || '').trim();
    const email = (document.getElementById('authRegEmail').value || '').trim().toLowerCase();
    const pw    = document.getElementById('authRegPw').value;
    const pw2   = document.getElementById('authRegPw2').value;
    if (!name || !email || !pw || !pw2) { authShowErr('authErrReg', 'T√ºm alanlarƒ± doldurun.'); return; }
    if (pw.length < 6)  { authShowErr('authErrReg', '≈ûifre en az 6 karakter olmalƒ±.'); return; }
    if (pw !== pw2)     { authShowErr('authErrReg', '≈ûifreler e≈üle≈ümiyor.'); return; }
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { authShowErr('authErrReg', 'Ge√ßerli bir e-posta girin.'); return; }
    const users = getAuthUsers();
    if (users.find(u => u.email === email)) { authShowErr('authErrReg', 'Bu e-posta zaten kayƒ±tlƒ±.'); return; }
    const newUser = { id:'u_'+Date.now(), name, email, pw: await hashPw(pw), isAdmin:false, createdAt:new Date().toISOString() };
    users.push(newUser);
    saveAuthUsers(users);
    localStorage.setItem(WM_AUTH_SESSION_KEY, newUser.id);
    document.getElementById('authScreen').style.display = 'none';
    applyAuthToUI();
    checkOnboarding();
}

function applyAuthToUI() {
    const session = getAuthSession();
    const users = getAuthUsers();
    const user = users.find(u => u.id === session);
    if (user) {
        const nameEl = document.getElementById('pUserName');
        if (nameEl) nameEl.textContent = user.name || 'Word Master';
        const emailEl = document.getElementById('pUserEmail');
        if (emailEl) emailEl.textContent = user.email || '';
        const adminBadgeEl = document.getElementById('pAdminBadge');
        if (adminBadgeEl) adminBadgeEl.style.display = user.isAdmin ? 'inline-block' : 'none';
        // Seviye renk temasƒ±
        const lvlBodyMap = {'A1':'Sprout','A2':'Sapling','B1':'Tree','B2':'Forest','C1':'Mountain','C2':'Galaxy'};
        if (user.level) document.body.setAttribute('data-level', lvlBodyMap[user.level] || 'Sprout');
        // Avatar g√ºncelle
        if (user.avatar) {
            const idx = EMOJI_POOL.indexOf(user.avatar);
            if (idx !== -1) { profileEmojiIdx = idx; localStorage.setItem('WM_AVATAR', idx); }
            const avEl = document.getElementById('pAvatarEmoji');
            if (avEl) avEl.textContent = user.avatar;
        }
    }
}

function authLogout() {
    if (!confirm('√áƒ±kƒ±≈ü yapmak istediƒüinize emin misiniz?')) return;
    localStorage.removeItem(WM_AUTH_SESSION_KEY);
    closeAdminPanel();
    document.getElementById('authScreen').style.display = 'flex';
    document.getElementById('authLoginEmail').value = '';
    document.getElementById('authLoginPw').value = '';
    document.getElementById('tabBar').style.display = 'none';
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ONBOARDING ‚Äî ƒ∞LK KURULUM
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const OB_AVATARS = ['üòä','üßë‚Äçüíª','üë©‚Äçüéì','üßë‚ÄçüöÄ','ü¶Å','üêâ','üåü','üéØ','üìö','üéÆ','üß†','üöÄ'];
let obSelectedAvatar = 'üòä';
let obSelectedLevel  = null;
let obSelectedGoal   = null;

function checkOnboarding() {
    const session = getAuthSession();
    const users = getAuthUsers();
    const user = users.find(u => u.id === session);
    if (user && !user.onboardingDone) {
        initOnboarding();
        document.getElementById('onboarding').classList.add('active');
        document.getElementById('tabBar').style.display = 'none';
    } else {
        document.getElementById('tabBar').style.display = 'flex';
        show('homeScreen');
        tabGo('home');
        updateMainStats();
        applyAuthToUI();
    }
}

function initOnboarding() {
    const grid = document.getElementById('obAvatarGrid');
    if (grid) {
        grid.innerHTML = '';
        OB_AVATARS.forEach(em => {
            const btn = document.createElement('button');
            btn.className = 'ob-avatar-btn' + (em === obSelectedAvatar ? ' selected' : '');
            btn.textContent = em;
            btn.onclick = () => selectObAvatar(em, btn);
            grid.appendChild(btn);
        });
    }
    const lgrid = document.getElementById('obLevelGrid');
    if (lgrid) {
        lgrid.innerHTML = '';
        LVL_META.forEach(m => {
            const div = document.createElement('div');
            div.className = 'ob-level-card';
            div.dataset.lvl = m.cefr;
            div.innerHTML = `<div class="ob-lc-icon">${m.icon}</div><div class="ob-lc-name">${m.name}</div><div class="ob-lc-cefr">${m.cefr}</div>`;
            div.onclick = () => selectObLevel(div);
            lgrid.appendChild(div);
        });
    }
}

function selectObAvatar(em, btn) {
    obSelectedAvatar = em;
    document.querySelectorAll('.ob-avatar-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    const prev = document.getElementById('obAvatarPreview');
    if (prev) prev.textContent = em;
}

function obNext(step) {
    document.querySelectorAll('.ob-step').forEach(s => s.classList.remove('active'));
    const el = document.getElementById('ob' + step);
    if (el) el.classList.add('active');
}

function obSaveName() {
    const name = (document.getElementById('obNameInput').value || '').trim();
    if (!name) { alert('L√ºtfen adƒ±nƒ±zƒ± girin.'); return; }
    const session = getAuthSession();
    const users = getAuthUsers();
    const idx = users.findIndex(u => u.id === session);
    if (idx !== -1) { users[idx].name = name; users[idx].avatar = obSelectedAvatar; saveAuthUsers(users); }
    const avEl = document.getElementById('pAvatarEmoji');
    if (avEl) avEl.textContent = obSelectedAvatar;
    const emojiIdx = EMOJI_POOL.indexOf(obSelectedAvatar);
    if (emojiIdx !== -1) { profileEmojiIdx = emojiIdx; localStorage.setItem('WM_AVATAR', emojiIdx); }
    obNext(3);
}

function selectObLevel(el) {
    document.querySelectorAll('#obLevelGrid .ob-level-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    obSelectedLevel = el.dataset.lvl;
    const btn = document.getElementById('obLvlNext');
    if (btn) { btn.disabled = false; btn.style.opacity = '1'; }
}

function obFinishLevel() {
    if (!obSelectedLevel) return;
    const meta = LVL_META.find(m => m.cefr === obSelectedLevel);
    if (meta) document.body.setAttribute('data-level', meta.body);
    obNext(4);
    // Varsayƒ±lan hedef se√ß
    const firstCard = document.querySelector('#ob4 .ob-level-card');
    if (firstCard) { firstCard.classList.add('selected'); obSelectedGoal = 10; }
    const btn = document.getElementById('obGoalNext');
    if (btn) { btn.disabled = false; btn.style.opacity = '1'; }
}

function selectGoal(el, val) {
    document.querySelectorAll('#ob4 .ob-level-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    obSelectedGoal = val;
    const btn = document.getElementById('obGoalNext');
    if (btn) { btn.disabled = false; btn.style.opacity = '1'; }
}

function obFinishGoal() {
    if (!obSelectedGoal) return;
    obNext(5);
}

function obComplete() {
    const session = getAuthSession();
    const users = getAuthUsers();
    const idx = users.findIndex(u => u.id === session);
    if (idx !== -1) {
        users[idx].onboardingDone = true;
        users[idx].level = obSelectedLevel || 'A1';
        users[idx].goal  = obSelectedGoal || 10;
        saveAuthUsers(users);
    }
    localStorage.setItem('WM_DAILY_GOAL', obSelectedGoal || 10);
    document.getElementById('onboarding').classList.remove('active');
    document.getElementById('tabBar').style.display = 'flex';
    show('homeScreen');
    tabGo('home');
    updateMainStats();
    applyAuthToUI();
    launchConfetti();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SINAVLAR ‚Äî YERLE≈ûTƒ∞RME TESTƒ∞
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var PLACEMENT_Qs = [];
var ptIdx = 0, ptCorrect = 0;

function buildSinavQuestions(sinav) {
    return (sinav.sorular || []).map(s => {
        const opts = ['A','B','C','D'].map(k => s.secenekler[k]).filter(Boolean);
        const ans  = ['A','B','C','D'].indexOf(s.dogru_cevap);
        return { q: s.soru_metni, opts, ans };
    });
}

function loadPlacementFromGlobal() {
    if (typeof sinavlarVerisi === 'undefined' || !Array.isArray(sinavlarVerisi)) return;
    const found = sinavlarVerisi.find(s =>
        s.sinav_adi && (s.sinav_adi.toLowerCase().includes('belirleme') || s.sinav_adi.toLowerCase().includes('placement'))
    );
    if (found) PLACEMENT_Qs = buildSinavQuestions(found);
}

function startPlacementTest() {
    if (PLACEMENT_Qs.length === 0) {
        alert('‚ö†Ô∏è Sƒ±nav verisi bulunamadƒ± ‚Äî sinavlar.js dosyasƒ± gerekli.');
        skipPlacementTest();
        return;
    }
    ptIdx = 0; ptCorrect = 0;
    document.getElementById('ptStartArea').style.display = 'none';
    document.getElementById('ptTestArea').style.display = 'block';
    document.getElementById('ptResult').style.display = 'none';
    document.getElementById('ptProgress').style.display = 'block';
    document.getElementById('ptQuestion').style.display = 'block';
    document.getElementById('ptOptions').style.display = 'grid';
    renderPlacementQ();
}

function skipPlacementTest() { obComplete(); }

function renderPlacementQ() {
    if (ptIdx >= PLACEMENT_Qs.length) { finishPlacementTest(); return; }
    const q = PLACEMENT_Qs[ptIdx];
    const progEl = document.getElementById('ptProgress');
    if (progEl) progEl.textContent = `Soru ${ptIdx+1} / ${PLACEMENT_Qs.length}`;
    const qEl = document.getElementById('ptQuestion');
    if (qEl) qEl.textContent = q.q;
    const optCont = document.getElementById('ptOptions');
    optCont.innerHTML = '';
    q.opts.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.textContent = opt;
        btn.className = 'pt-opt-btn';
        btn.onclick = () => {
            [...optCont.children].forEach(b => b.style.pointerEvents = 'none');
            if (i === q.ans) {
                btn.style.background = '#dcfce7'; btn.style.borderColor = '#22c55e'; ptCorrect++;
            } else {
                btn.style.background = '#fef2f2'; btn.style.borderColor = '#ef4444';
                if (optCont.children[q.ans]) { optCont.children[q.ans].style.background = '#dcfce7'; optCont.children[q.ans].style.borderColor = '#22c55e'; }
            }
            setTimeout(() => { ptIdx++; renderPlacementQ(); }, 800);
        };
        optCont.appendChild(btn);
    });
}

function finishPlacementTest() {
    const total = PLACEMENT_Qs.length || 1;
    const pct = ptCorrect / total;
    let det;
    if      (pct < 0.30) det = LVL_META[0];
    else if (pct < 0.50) det = LVL_META[1];
    else if (pct < 0.65) det = LVL_META[2];
    else if (pct < 0.80) det = LVL_META[3];
    else if (pct < 0.92) det = LVL_META[4];
    else                  det = LVL_META[5];
    obSelectedLevel = det.cefr;
    document.body.setAttribute('data-level', det.body);
    document.getElementById('ptQuestion').style.display = 'none';
    document.getElementById('ptOptions').style.display = 'none';
    document.getElementById('ptProgress').style.display = 'none';
    const res = document.getElementById('ptResult');
    res.style.display = 'block';
    const eEl = document.getElementById('ptResultEmoji');  if (eEl) eEl.textContent = det.icon;
    const lEl = document.getElementById('ptResultLevel');  if (lEl) lEl.textContent = `${det.name} (${det.cefr}) Seviyesi Tespit Edildi`;
    const sEl = document.getElementById('ptResultSub');    if (sEl) sEl.textContent = `${ptCorrect}/${total} doƒüru (${(pct*100).toFixed(0)}%)`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ADMƒ∞N PANELƒ∞
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openAdmin() {
    const pwEl = document.getElementById('adminPwInput');
    if (pwEl) pwEl.value = '';
    const errEl = document.getElementById('adminPwError');
    if (errEl) errEl.style.display = 'none';
    document.getElementById('adminLoginOverlay').classList.add('show');
}

function closeAdminLogin() {
    document.getElementById('adminLoginOverlay').classList.remove('show');
}

function adminLogin() {
    const pw = document.getElementById('adminPwInput').value;
    if (pw === getAdminPw()) {
        // Admin bayraƒüƒ±nƒ± aktif kullanƒ±cƒ±ya ekle (profilde rozet g√∂ster)
        const session = getAuthSession();
        if (session) {
            const users = getAuthUsers();
            const idx = users.findIndex(u => u.id === session);
            if (idx >= 0 && !users[idx].isAdmin) {
                users[idx].isAdmin = true;
                localStorage.setItem(WM_AUTH_USERS_KEY, JSON.stringify(users));
            }
        }
        closeAdminLogin();
        openAdminPanel();
    } else {
        document.getElementById('adminPwError').style.display = 'block';
        document.getElementById('adminPwInput').value = '';
        document.getElementById('adminPwInput').focus();
    }
}

function openAdminPanel() {
    document.getElementById('adminPanel').classList.add('show');
    adminSwitchTab('users');
}

function closeAdminPanel() {
    document.getElementById('adminPanel').classList.remove('show');
}

function adminSwitchTab(tab) {
    document.querySelectorAll('.admin-tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.admin-tab-pane').forEach(p => p.style.display = 'none');
    const tabEl = document.getElementById('atab-' + tab);
    if (tabEl) tabEl.classList.add('active');
    const paneId = 'adminTab' + tab.charAt(0).toUpperCase() + tab.slice(1);
    const pane = document.getElementById(paneId);
    if (pane) pane.style.display = 'block';
    if (tab === 'users')    adminRenderUsers();
    if (tab === 'data')     adminRenderDataInfo();
    if (tab === 'edit')     adminRenderEditStats();
    if (tab === 'settings') adminRenderSettings();
}

function adminRenderUsers() {
    const users = getAuthUsers();
    const container = document.getElementById('adminUsersList');
    if (!container) return;
    if (users.length === 0) {
        container.innerHTML = '<div style="color:var(--muted);font-size:.83rem;text-align:center;padding:10px;">Hen√ºz kayƒ±tlƒ± kullanƒ±cƒ± yok.</div>';
        return;
    }
    container.innerHTML = users.map(u => `
        <div class="admin-user-row">
            <span style="font-size:1.4rem;">${u.avatar || 'üë§'}</span>
            <div style="flex:1;">
                <div style="font-weight:700;font-size:.85rem;">${u.name || 'ƒ∞simsiz'}</div>
                <div style="font-size:.72rem;color:var(--muted);">${u.email}</div>
            </div>
            <span class="admin-user-badge">${u.isAdmin ? 'Admin' : 'Kullanƒ±cƒ±'}</span>
        </div>
    `).join('');
}

function adminRenderDataInfo() {
    let total = 0;
    const catCounts = { 'KELƒ∞MELER':0, 'KALIPLAR':0, 'DEYƒ∞MLER':0 };
    for (let cat in DATA) for (let l in DATA[cat]) { const n = DATA[cat][l].length; catCounts[cat] = (catCounts[cat]||0)+n; total += n; }
    const sinCnt = (typeof sinavlarVerisi !== 'undefined' && Array.isArray(sinavlarVerisi)) ? sinavlarVerisi.length : 0;
    const ptCnt  = PLACEMENT_Qs.length;
    const container = document.getElementById('adminDataInfo');
    if (container) container.innerHTML = `
        <div class="admin-stat-row"><span>üìò Kelimeler</span><strong>${catCounts['KELƒ∞MELER']}</strong></div>
        <div class="admin-stat-row"><span>üó£Ô∏è Kalƒ±plar</span><strong>${catCounts['KALIPLAR']}</strong></div>
        <div class="admin-stat-row"><span>üî• Deyimler</span><strong>${catCounts['DEYƒ∞MLER']}</strong></div>
        <div class="admin-stat-row"><span>üìù Sƒ±navlar</span><strong>${sinCnt} adet</strong></div>
        <div class="admin-stat-row"><span>üß† Yerle≈ütirme Sorusu</span><strong>${ptCnt}</strong></div>
        <div class="admin-stat-row"><span>üî¢ Toplam √ñƒüe</span><strong>${total}</strong></div>
    `;
}

function adminRenderEditStats() {
    let total = 0, learned = 0;
    const catStats = {};
    for (let cat in DATA) {
        catStats[cat] = { total:0, learned:0 };
        for (let l in DATA[cat]) {
            DATA[cat][l].forEach(w => {
                catStats[cat].total++; total++;
                if (SRS_DATA[w.eng] && SRS_DATA[w.eng].stage > 0) { catStats[cat].learned++; learned++; }
            });
        }
    }
    const sinCnt = (typeof sinavlarVerisi !== 'undefined' && Array.isArray(sinavlarVerisi)) ? sinavlarVerisi.length : 0;
    const ptCnt  = PLACEMENT_Qs.length;
    const container = document.getElementById('adminEditStats');
    if (container) container.innerHTML = Object.keys(catStats).map(cat => `
        <div class="admin-stat-row"><span>${cat}</span><span>${catStats[cat].learned} / ${catStats[cat].total} √∂ƒürenildi</span></div>
    `).join('');
    const sinContainer = document.getElementById('adminSinavInfo');
    if (sinContainer) sinContainer.innerHTML = `
        <div class="admin-stat-row"><span>Toplam Sƒ±nav</span><strong>${sinCnt}</strong></div>
        <div class="admin-stat-row"><span>Yerle≈ütirme Sorusu</span><strong>${ptCnt}</strong></div>
        <div class="admin-stat-row"><span>Durum</span><strong style="color:${ptCnt>0?'var(--sprout-dark)':'#ef4444'}">${ptCnt>0?'‚úÖ Hazƒ±r':'‚ö†Ô∏è sinavlar.js eksik'}</strong></div>
    `;
}

function adminRenderSettings() {
    const pwEl = document.getElementById('adminCurPwShow');
    if (pwEl) pwEl.textContent = getAdminPw().substring(0,3) + '***';
}

function adminHandleFile(input, type) {
    if (!input.files || !input.files[0]) return;
    const fileName = input.files[0].name.toLowerCase();
    const reader = new FileReader();
    reader.onload = e => {
        try {
            const text = e.target.result.trim();
            if (type === 'sinav') {
                let parsed;
                try {
                    if (text.startsWith('[') || text.startsWith('{')) {
                        parsed = JSON.parse(text);
                    } else {
                        const fn = new Function(text + '; return (typeof sinavlarVerisi!=="undefined")?sinavlarVerisi:null;');
                        parsed = fn();
                    }
                } catch(e2) { parsed = null; }
                if (!Array.isArray(parsed)) { notify('‚ùå Sƒ±nav formatƒ± tanƒ±namadƒ±: ' + fileName); input.value=''; return; }
                window.sinavlarVerisi = parsed;
                loadPlacementFromGlobal();
                notify('‚úÖ ' + parsed.length + ' sƒ±nav y√ºklendi');
                adminRenderDataInfo(); adminRenderEditStats();
                input.value=''; return;
            }
            // Veri dosyasƒ± (kelimeler / kaliplar / deyimler)
            let raw;
            if (fileName.endsWith('.js')) {
                const varNames = type === 'kaliplar' ? ['KALIP_DATA','WORD_DATA'] :
                                 type === 'deyimler' ? ['WORD_DATA','DEYIM_DATA'] :
                                 ['WORD_DATA'];
                let found = null;
                for (const vn of varNames) {
                    try {
                        const fn = new Function(text + `; return (typeof ${vn}!=="undefined")?${vn}:null;`);
                        const res = fn();
                        if (Array.isArray(res) && res.length > 0) { found = res; break; }
                    } catch(_) {}
                }
                if (!found) { notify('‚ùå JS dosyasƒ±nda ge√ßerli dizi bulunamadƒ±'); input.value=''; return; }
                raw = found;
            } else {
                raw = JSON.parse(text);
            }
            const cat = type === 'kaliplar' ? 'KALIPLAR' : type === 'deyimler' ? 'DEYƒ∞MLER' : 'KELƒ∞MELER';
            if (Array.isArray(raw)) {
                mergeRawArray(cat, raw);
                saveDB();
                notify('‚úÖ ' + raw.length + ' √∂ƒüe y√ºklendi ‚Üí ' + cat);
                updateMainStats();
                adminRenderDataInfo(); adminRenderEditStats();
            } else { notify('‚ùå Dizi formatƒ± bekleniyor'); }
        } catch(err) { notify('‚ùå Dosya okunamadƒ±: ' + err.message); }
        input.value = '';
    };
    reader.readAsText(input.files[0], 'UTF-8');
}

function adminExportAll() {
    const now = new Date();
    const ts = now.toISOString().replace(/[:.]/g,'-').slice(0,19);
    const data = { exportDate:now.toISOString(), appVersion:'v18.2', DATA, SRS_DATA,
        STREAK:localStorage.getItem('STREAK'), LAST_VISIT:localStorage.getItem('LAST_VISIT'),
        users:getAuthUsers() };
    const blob = new Blob([JSON.stringify(data,null,2)], { type:'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `WordMaster_Admin_${ts}.json`;
    a.click();
    notify('üì• Admin yedeƒüi alƒ±ndƒ±');
}

function adminImportBackup(input) {
    if (!input.files || !input.files[0]) return;
    const reader = new FileReader();
    reader.onload = e => {
        try {
            const imp = JSON.parse(e.target.result);
            if (imp.DATA && imp.SRS_DATA) {
                if (confirm('Bu i≈ülem t√ºm mevcut verilerin √ºzerine yazacak. Devam edilsin mi?')) {
                    DATA = imp.DATA; SRS_DATA = imp.SRS_DATA;
                    if (imp.STREAK) localStorage.setItem('STREAK', imp.STREAK);
                    if (imp.LAST_VISIT) localStorage.setItem('LAST_VISIT', imp.LAST_VISIT);
                    saveDB(); notify('‚úÖ Yedek y√ºklendi'); location.reload();
                }
            } else { notify('‚ùå Ge√ßersiz yedek dosyasƒ±'); }
        } catch(err) { notify('‚ùå Dosya okunamadƒ±: ' + err.message); }
        input.value = '';
    };
    reader.readAsText(input.files[0]);
}

function adminChangePassword() {
    const newPw = (document.getElementById('adminNewPw').value || '').trim();
    if (newPw.length < 4) { notify('‚ùå ≈ûifre en az 4 karakter olmalƒ±'); return; }
    localStorage.setItem(WM_ADMIN_PW_KEY, newPw);
    document.getElementById('adminNewPw').value = '';
    notify('‚úÖ ≈ûifre g√ºncellendi');
    adminRenderSettings();
}

function adminResetSystem() {
    if (!confirm('‚ö†Ô∏è T√úM VERƒ∞LER Sƒ∞Lƒ∞NECEK! Bu i≈ülem geri alƒ±namaz. Devam edilsin mi?')) return;
    if (!confirm('Son onay: Ger√ßekten t√ºm sistemi sƒ±fƒ±rlamak istiyorsunuz?')) return;
    localStorage.clear(); location.reload();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   YARDIMCI FONKSƒ∞YONLAR
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function notify(msg) {
    let toast = document.getElementById('wm-toast');
    if (!toast) {
        toast = document.createElement('div');
        toast.id = 'wm-toast';
        toast.style.cssText = 'position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:rgba(30,41,59,.92);color:white;padding:10px 22px;border-radius:20px;font-size:.83rem;font-weight:700;z-index:999999;transition:.3s;white-space:nowrap;max-width:90vw;text-align:center;pointer-events:none;';
        document.body.appendChild(toast);
    }
    toast.textContent = msg;
    toast.style.opacity = '1';
    clearTimeout(toast._t);
    toast._t = setTimeout(() => { toast.style.opacity = '0'; }, 2800);
}

function launchConfetti() {
    const colors = ['#4ade80','#fbbf24','#f87171','#a78bfa','#34d399','#fb923c'];
    for (let i = 0; i < 35; i++) {
        const conf = document.createElement('div');
        conf.style.cssText = `position:fixed;top:-10px;left:${Math.random()*100}vw;width:8px;height:8px;background:${colors[Math.floor(Math.random()*colors.length)]};border-radius:${Math.random()>0.5?'50%':'2px'};z-index:9999999;animation:confettiFall ${1.5+Math.random()}s linear forwards;`;
        document.body.appendChild(conf);
        setTimeout(() => conf.remove(), 3000);
    }
}
</script>

<script>
// ‚îÄ‚îÄ Service Worker Kaydƒ± ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
            .then(reg => console.log('[SW] Kayƒ±t ba≈üarƒ±lƒ±:', reg.scope))
            .catch(err => console.warn('[SW] Kayƒ±t ba≈üarƒ±sƒ±z:', err));
    });
}
</script>
</body>
</html>