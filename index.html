<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>WORD MASTER - v18.2 Advanced Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Russo+One&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* 1. DOKUNULMAZ GENEL TASARIM */
:root {
    --primary: #3B82F6;
    --primary-light: #EFF6FF;
    --success: #22C55E;
    --danger: #EF4444;
    --warning: #F59E0B;
    --text-main: #1F2937;
    --text-light: #6B7280;
    --bg-app: #F3F4F6;
    --card-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

body {
    font-family: 'Nunito', sans-serif;
    margin: 0; padding: 0;
    background-color: var(--bg-app);
    color: var(--text-main);
    display: flex; justify-content: center;
    min-height: 100vh;
}

.app-container {
    width: 100%; max-width: 420px;
    background: #fff;
    min-height: 100vh;
    position: relative;
    box-shadow: 0 0 20px rgba(0,0,0,0.05);
    display: flex; flex-direction: column;
}

/* HEADER */
.header {
    padding: 15px 20px;
    display: flex; align-items: center; justify-content: space-between;
    background: #fff; position: sticky; top: 0; z-index: 100;
}

.lang-btn {
    background: #E0F2FE; 
    border: 2px solid #7DD3FC;
    color: #0284C7; 
    font-weight: 800; 
    font-size: 0.75rem;
    width: 80px; height: 45px; 
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px; 
    cursor: pointer; 
    transition: 0.2s;
}
.lang-btn:active { transform: scale(0.95); }

/* WORD ART */
.word-art-title {
    font-family: 'Russo One', sans-serif;
    font-size: 2rem; text-align: center;
    background: linear-gradient(45deg, #2196F3, #00BCD4);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    text-shadow: 3px 3px 0px rgba(0,0,0,0.1); margin: 10px 0 20px;
}

.mini-word-art {
    font-family: 'Russo One', sans-serif; font-size: 1.4rem;
    background: linear-gradient(45deg, #1565C0, #42A5F5);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    text-shadow: 2px 2px 0px rgba(0,0,0,0.1); text-transform: uppercase;
}

/* BUTONLAR */
.btn-back {
    background: #EFF6FF; border: 2px solid #BFDBFE; color: #2563EB;
    width: 45px; height: 45px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; box-shadow: 0 3px 0 #BFDBFE; transition: transform 0.1s;
    font-size: 1.2rem; margin: 0; padding: 0;
}
.btn-back:active { transform: translateY(3px); box-shadow: none; }
.icon-back { width: 24px; height: 24px; fill: currentColor; stroke: currentColor; stroke-width: 2; }

.btn-settings {
    background: #F3F4F6; border: 2px solid #E5E7EB; color: #4B5563;
    width: 80px; height: 45px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 1.5rem; transition: 0.1s;
}
.btn-settings:active { transform: scale(0.95); background: #E5E7EB; }

button {
    border: none; border-radius: 15px; padding: 16px;
    font-weight: 700; cursor: pointer; transition: 0.1s; width: 100%; margin: 8px 0;
    text-transform: uppercase; font-family: "Poppins", sans-serif;
    color: white; box-shadow: 0 5px 0 rgba(0,0,0,0.15); font-size: 1rem;
}
button:active { transform: translateY(4px); box-shadow: none; }

.btn-green { background: #4CAF50; box-shadow: 0 5px 0 #388E3C; }
.btn-red { background: #F44336; box-shadow: 0 5px 0 #D32F2F; }
.btn-grey { background: #78909C; box-shadow: 0 5px 0 #546E7A; }
.btn-purple { background: #9C27B0; box-shadow: 0 5px 0 #7B1FA2; }
.btn-orange { background: #FF9800; box-shadow: 0 5px 0 #F57C00; }
.btn-blue { background: #2196F3; box-shadow: 0 5px 0 #1976D2; }
.btn-cyan { background: #00BCD4; box-shadow: 0 5px 0 #0097A7; }

/* DOSYA Y√úKLEME BUTONU */
.btn-file-upload {
    background: white; border: 2px dashed #3B82F6; color: #3B82F6;
    border-radius: 12px; padding: 15px; text-align: center;
    cursor: pointer; width: 100%; margin-bottom: 15px; display: block;
    font-weight: 700; transition: 0.2s;
}
.btn-file-upload:hover { background: #EFF6FF; }

.content { flex: 1; padding: 20px; overflow-y: auto; padding-bottom: 80px; }

/* KARTLAR */
.card-menu {
    background: #fff; border-radius: 16px; padding: 20px; margin-bottom: 12px;
    border: 1px solid #E5E7EB; box-shadow: var(--card-shadow);
    cursor: pointer; transition: transform 0.1s; display: flex; align-items: center; gap: 15px;
}
.card-menu:active { transform: scale(0.98); border-color: var(--primary); }
.menu-icon { font-size: 1.8rem; }
.menu-text h3 { margin: 0; font-size: 1.1rem; color: var(--text-main); }
.menu-text p { margin: 2px 0 0; font-size: 0.85rem; color: #6B7280; }

.streak-box {
    background: white; border: 2px solid #F9A8D4; border-radius: 16px;
    padding: 15px; text-align: center; margin-bottom: 20px;
    box-shadow: 0 4px 0 #F9A8D4;
}
.streak-count { font-size: 1.8rem; font-weight: 800; color: #DB2777; }

/* WEEK TRACKER G√ñRSELƒ∞ */
.week-tracker { display: flex; justify-content: space-between; margin-top: 15px; padding-top: 10px; border-top: 1px dashed #F9A8D4; }
.day-item { display: flex; flex-direction: column; align-items: center; gap: 4px; }
.day-circle { width: 22px; height: 22px; border: 2px solid #E5E7EB; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; color: transparent; background: #fff; font-weight: 800; }
.day-circle.active { background: #22C55E; border-color: #22C55E; color: #fff; }
.day-label { font-size: 0.6rem; font-weight: 800; color: #9CA3AF; }

/* SEVƒ∞YE BUTONLARI */
.grid-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.level-btn {
    border: none; border-radius: 16px; padding: 20px 10px;
    font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 1.2rem;
    color: white; cursor: pointer; display: flex; flex-direction: column; align-items: center;
    box-shadow: 0 5px 0 rgba(0,0,0,0.2); text-transform: uppercase;
    text-shadow: 0 1px 2px rgba(0,0,0,0.2);
}
.level-btn small { font-size: 0.7rem; font-weight: 600; margin-top: 5px; opacity: 0.9; }
.level-btn:active { transform: translateY(5px); box-shadow: none; }

.lvl-blue { background: linear-gradient(135deg, #42A5F5, #1E88E5); }
.lvl-orange { background: linear-gradient(135deg, #FFA726, #F57C00); }
.lvl-green { background: linear-gradient(135deg, #66BB6A, #43A047); }
.lvl-pink { background: linear-gradient(135deg, #EC407A, #D81B60); }
.lvl-purple { background: linear-gradient(135deg, #AB47BC, #8E24AA); }
.lvl-cyan { background: linear-gradient(135deg, #26C6DA, #00ACC1); }
.lvl-red { background: linear-gradient(135deg, #EF5350, #E53935); }

/* E≈ûLE≈ûTƒ∞RME RENKLERƒ∞ */
.mc-1 { background: #42A5F5; } .mc-2 { background: #FFA726; } .mc-3 { background: #66BB6A; }
.mc-4 { background: #EC407A; } .mc-5 { background: #AB47BC; } .mc-6 { background: #26C6DA; }

.match-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.match-card {
    border-radius: 12px; padding: 15px 5px; text-align: center; font-weight: 700; color: white;
    cursor: pointer; font-size: 0.95rem; min-height: 80px; display: flex; align-items: center; justify-content: center;
    box-shadow: 0 4px 0 rgba(0,0,0,0.2); border: 2px solid white; word-break: break-word; line-height: 1.2;
}
.match-card:active { transform: translateY(4px); box-shadow: none; }
.match-card.matched { visibility: hidden; }
.match-card.selected { border-color: #333; transform: scale(0.95); }

/* FLASHCARD */
.flashcard-wrapper { perspective: 1000px; width: 100%; height: 400px; margin: 10px 0; }
.flashcard { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.6s; cursor: pointer; }
.flashcard.flipped { transform: rotateY(180deg); }

.fc-face {
    position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
    border-radius: 24px; background: #fff; 
    box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 2px solid #E5E7EB;
    padding: 25px; box-sizing: border-box; 
    display: flex; flex-direction: column;
}

.fc-front { justify-content: center; align-items: center; }
.fc-main-word { font-size: 2.6rem; font-weight: 800; color: #1F2937; text-align: center; line-height: 1.2; }

.fc-back { 
    transform: rotateY(180deg); 
    align-items: flex-start; 
    text-align: left;
    display: flex; 
    flex-direction: column; 
    justify-content: flex-start;
    overflow-y: auto;
}
.fc-header {
    width: 100%; display: flex; justify-content: space-between; align-items: center; 
    margin-bottom: 10px; border-bottom: 2px solid #F3F4F6; padding-bottom: 10px;
}
.fc-word-sm { font-size: 1.6rem; font-weight: 800; color: #1F2937; flex: 1; }
.fc-audio-btn {
    background: #EFF6FF; border: none; width: 40px; height: 40px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
    cursor: pointer; color: #3B82F6; flex-shrink: 0;
}
.fc-audio-btn:active { background: #DBEAFE; }

.fc-controls { display: flex; gap: 15px; margin-top: auto; padding-top: 10px; }
.control-btn {
    flex: 1; padding: 16px; border-radius: 16px; border: none; font-weight: 800;
    color: white; cursor: pointer; box-shadow: 0 4px 0 rgba(0,0,0,0.2);
    display: flex; align-items: center; justify-content: center; gap: 8px;
}
.control-btn:active { transform: translateY(4px); box-shadow: none; }
.btn-know { background: #22C55E; box-shadow: 0 4px 0 #15803D; }
.btn-forgot { background: #EF4444; box-shadow: 0 4px 0 #B91C1C; }

/* QUIZ */
.quiz-question {
    background: #3B82F6; color: white; padding: 30px 20px; border-radius: 16px;
    text-align: center; font-size: 1.5rem; font-weight: 800; box-shadow: 0 6px 0 #1D4ED8; margin-bottom: 20px;
}
.quiz-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.quiz-opt {
    background: white; border: 2px solid #E5E7EB; border-radius: 12px;
    padding: 20px 5px; text-align: center; font-weight: 700; cursor: pointer;
    box-shadow: 0 4px 0 #E5E7EB; transition: 0.1s; color: #1F2937;
}
.quiz-opt:active { transform: translateY(4px); box-shadow: none; }
.quiz-opt.correct { background: #22C55E; color: white; border-color: #22C55E; }
.quiz-opt.wrong { background: #EF4444; color: white; border-color: #EF4444; }

/* INPUTLAR */
.input-field { width: 100%; padding: 15px; border: 2px solid #E5E7EB; border-radius: 12px; margin-bottom: 12px; box-sizing: border-box; font-family: inherit; }
.add-option-btn { padding: 15px; border: 2px solid #E5E7EB; border-radius: 12px; background: white; font-weight: 700; color: #666; cursor: pointer; flex: 1; text-align: center; }
.add-option-btn.active { border-color: #3B82F6; color: #3B82F6; background: #EFF6FF; }

/* EKRANLAR */
.screen { display: none; height: 100%; flex-direction: column; }
.screen.active { display: flex; }
.stats-summary { display: flex; justify-content: space-around; background: white; padding: 15px; border-radius: 12px; margin-top: 20px; border: 1px solid #E5E7EB; }
.stat-val { display: block; font-weight: 800; font-size: 1.2rem; }

/* SONU√á */
.result-box {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: 4px solid white; border-radius: 20px; padding: 40px 20px;
    text-align: center; margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(118, 75, 162, 0.4);
    transform: scale(1); animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.result-score { font-family: 'Russo One', sans-serif; font-size: 3rem; color: white; text-shadow: 4px 4px 0px rgba(0,0,0,0.2); margin: 0; }
.result-label { color: rgba(255,255,255,0.9); font-size: 1.2rem; font-weight: 700; margin-top: 5px; text-transform: uppercase; letter-spacing: 2px; }
@keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
/* SAYA√á YAZI STƒ∞Lƒ∞ */
#quizCounter, #fcCounter {
    font-family: 'Russo One', sans-serif;
    color: #3B82F6;
    font-size: 1.2rem;
    letter-spacing: 1px;
    background: #EFF6FF;
    padding: 5px 15px;
    border-radius: 20px;
    display: inline-block;
    margin-bottom: 10px;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
}
</style>
</head>
<body>

<div class="app-container">

    <div class="screen active" id="homeScreen">
        <div class="header">
            <button class="lang-btn" onclick="toggleLanguage()">TR / EN</button>
            <button class="btn-settings" onclick="show('settingsScreen')">‚öôÔ∏è</button>
        </div>
        
        <div class="content">
            <h1 class="word-art-title">WORD MASTER</h1>
            <div class="streak-box">
                <span style="font-size:2rem; display:block;">üéØüî•</span>
                <div class="streak-count" id="streakDisplay">1 G√ºnl√ºk Seri!</div>
                <div class="week-tracker" id="weekTracker">
                    <div class="day-item"><div class="day-circle" id="day-1">‚úì</div><span class="day-label">P</span></div>
                    <div class="day-item"><div class="day-circle" id="day-2">‚úì</div><span class="day-label">S</span></div>
                    <div class="day-item"><div class="day-circle" id="day-3">‚úì</div><span class="day-label">√á</span></div>
                    <div class="day-item"><div class="day-circle" id="day-4">‚úì</div><span class="day-label">P</span></div>
                    <div class="day-item"><div class="day-circle" id="day-5">‚úì</div><span class="day-label">C</span></div>
                    <div class="day-item"><div class="day-circle" id="day-6">‚úì</div><span class="day-label">C</span></div>
                    <div class="day-item"><div class="day-circle" id="day-0">‚úì</div><span class="day-label">P</span></div>
                </div>
            </div>
<div class="stats-summary" style="display: flex; justify-content: space-around; background: white; padding: 15px; border-radius: 16px; margin-bottom: 20px; border: 2px solid #F1F5F9; text-align: center; box-shadow: 0 4px 0 #F1F5F9;">
    <div>
        <div id="mainTotal" style="font-size: 1.2rem; font-weight: 800; color: #1E293B;">0</div>
        <div style="font-size: 0.6rem; color: #64748B; text-transform: uppercase; font-weight: 700;">Toplam</div>
    </div>
    <div>
        <div id="mainLearned" style="font-size: 1.2rem; font-weight: 800; color: #22C55E;">0</div>
        <div style="font-size: 0.6rem; color: #64748B; text-transform: uppercase; font-weight: 700;">√ñƒürenilen</div>
    </div>
    <div>
        <div id="mainUnknown" style="font-size: 1.2rem; font-weight: 800; color: #EF4444;">0</div>
        <div style="font-size: 0.6rem; color: #64748B; text-transform: uppercase; font-weight: 700;">Kalan</div>
    </div>
</div>
            <h3 data-lang="work_areas" style="color:#6B7280; font-size:0.9rem; margin-bottom:10px;">√áALI≈ûMA ALANLARI</h3>
            <div class="card-menu" onclick="selectCategory('KELƒ∞MELER')">
                <span class="menu-icon">üìò</span>
                <div class="menu-text"><h3 data-lang="words">Kelimeler</h3><p data-lang="words_desc">Kelime hazineni geli≈ütir</p></div>
            </div>
            <div class="card-menu" onclick="selectCategory('KALIPLAR')">
                <span class="menu-icon">üó£Ô∏è</span>
                <div class="menu-text"><h3 data-lang="phrases">Kalƒ±plar</h3><p data-lang="phrases_desc">G√ºnl√ºk konu≈üma yapƒ±larƒ±</p></div>
            </div>
            <div class="card-menu" onclick="selectCategory('DEYƒ∞MLER')">
                <span class="menu-icon">üî•</span>
                <div class="menu-text"><h3 data-lang="idioms">Deyimler</h3><p data-lang="idioms_desc">ƒ∞leri seviye ifadeler</p></div>
            </div>
        </div>
    </div>

    <div class="screen" id="settingsScreen">
        <div class="header">
            <button class="btn-back" onclick="show('homeScreen')">
                <svg class="icon-back" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <span class="mini-word-art" data-lang="settings">AYARLAR</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content">
            <div class="card-menu" onclick="show('addScreen')">
                <span class="menu-icon">üì•</span>
                <div class="menu-text"><h3 data-lang="add_data">Veri Ekle</h3><p data-lang="add_desc">Toplu veri giri≈üi</p></div>
            </div>
            <div class="card-menu" onclick="resetAllData()" style="border-color:#EF4444;">
                <span class="menu-icon">‚ö†Ô∏è</span>
                <div class="menu-text"><h3 style="color:#EF4444;" data-lang="reset">Sƒ±fƒ±rla</h3><p data-lang="reset_desc">T√ºm ilerlemeyi sil</p></div>
            </div>
        </div>
    </div>

    <div class="screen" id="addScreen">
        <div class="header">
            <button class="btn-back" onclick="show('settingsScreen')">
            <svg class="icon-back" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <span class="mini-word-art" data-lang="add_data">Veri Ekle</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content">
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button id="btnSingle" class="add-option-btn active" onclick="setAddMode('single')" data-lang="add_single">Tekli Ekle</button>
                <button id="btnBulk" class="add-option-btn" onclick="setAddMode('bulk')" data-lang="add_bulk">Toplu Ekle</button>
            </div>

            <div id="singleMode">
                <select id="addCat" class="input-field">
                    <option value="KELƒ∞MELER" data-lang="words">Kelimeler</option>
                    <option value="KALIPLAR" data-lang="phrases">Kalƒ±plar</option>
                    <option value="DEYƒ∞MLER" data-lang="idioms">Deyimler</option>
                </select>
                <select id="addLvl" class="input-field"><option>A1</option><option>A2</option><option>B1</option><option>B2</option><option>C1</option><option>C2</option></select>
                <input id="addEng" class="input-field" placeholder="ƒ∞ngilizce">
                <input id="addTr" class="input-field" placeholder="T√ºrk√ße">
                <button class="btn-green" onclick="addSingle()" data-lang="save">KAYDET</button>
            </div>
            
            <div id="bulkMode" style="display:none;">
                <p style="color:#666; font-size:0.85rem; line-height:1.2; margin-bottom:10px;">
                    Format: Se√ßilen kategoriye g√∂re uygun formatƒ± kullanƒ±n.
                </p>
                <select id="bulkCat" class="input-field">
                    <option value="KELƒ∞MELER" data-lang="words">Kelimeler</option>
                    <option value="KALIPLAR" data-lang="phrases">Kalƒ±plar</option>
                    <option value="DEYƒ∞MLER" data-lang="idioms">Deyimler</option>
                </select>
                
                <input type="file" id="fileInput" accept=".txt" style="display:none" onchange="loadFile()">
                <button class="btn-file-upload" onclick="document.getElementById('fileInput').click()" data-lang="btn_upload">üìÅ TXT Dosyasƒ± Y√ºkle</button>

                <textarea id="bulkInput" class="input-field" style="height:250px; font-size:0.85rem;" placeholder='KELƒ∞MELER ƒ∞√áƒ∞N 6 SATIRLI BLOK FORMATI...&#10;DEYƒ∞M VE KALIP ƒ∞√áƒ∞N SEVƒ∞YE BAZLI FORMAT...'></textarea>
                <button class="btn-green" onclick="addBulk()" data-lang="bulk_save">TOPLU KAYDET</button>
            </div>
        </div>
    </div>

    <div class="screen" id="levelScreen">
        <div class="header">
            <button class="btn-back" onclick="show('homeScreen')">
                <svg class="icon-back" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <span class="mini-word-art" id="catTitle">KATEGORƒ∞</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content">
            <div id="levelsGrid" class="grid-menu"></div>
        </div>
    </div>

    <div class="screen" id="dashboardScreen">
        <div class="header">
            <button class="btn-back" onclick="show('levelScreen')">
                <svg class="icon-back" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <span class="mini-word-art" id="dashTitle">Seviye</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content">
<div id="levelProgressBox" style="background: white; padding: 15px; border-radius: 16px; border: 2px solid #F1F5F9; margin-bottom: 20px;">
    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
        <span id="levelProgressText" style="font-weight: 800; color: #1E293B; font-size: 0.8rem;">Seviye ƒ∞lerlemesi</span>
        <span id="levelPercent" style="font-weight: 800; color: #3B82F6; font-size: 0.8rem;">%0</span>
    </div>
    <div style="width: 100%; height: 10px; background: #F1F5F9; border-radius: 10px; overflow: hidden; margin-bottom: 8px;">
        <div id="levelProgressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #3B82F6, #22C55E); transition: width 0.4s;"></div>
    </div>
    <div style="display: flex; justify-content: space-between; font-size: 0.7rem; font-weight: 700;">
        <span style="color: #22C55E;">√ñƒürenilen: <span id="lvlLearned">0</span></span>
        <span style="color: #EF4444;">Kalan: <span id="lvlUnknown">0</span></span>
    </div>
</div>
            <h3 class="mini-word-art" style="font-size:1rem; color:#666; margin-top:0;" data-lang="games">Oyunlar</h3>
            <div class="card-menu" onclick="initGame('quiz')">
                <span class="menu-icon">üìù</span>
                <div class="menu-text"><h3 data-lang="quiz_game">Test (Quiz)</h3><p data-lang="quiz_desc">10 Soru</p></div>
            </div>
            <div class="card-menu" onclick="initGame('match')">
                <span class="menu-icon">üß©</span>
                <div class="menu-text"><h3 data-lang="match_game">E≈üle≈ütirme</h3><p data-lang="match_desc">5 √áift</p></div>
            </div>
            <div class="card-menu" onclick="initGame('flash')">
                <span class="menu-icon">üÉè</span>
                <div class="menu-text"><h3 data-lang="flash_game">Kartlar</h3><p data-lang="flash_desc">10 Kart</p></div>
            </div>

            <h3 class="mini-word-art" style="font-size:1rem; color:#666; margin-top:20px;" data-lang="progress">Geli≈üim</h3>
            <div class="card-menu" onclick="show('srsScreen')">
                <span class="menu-icon">üß†</span>
                <div class="menu-text"><h3 data-lang="smart_review">Akƒ±llƒ± Tekrar</h3><p data-lang="srs_desc">SRS ve Bilinmeyenler</p></div>
            </div>
            <div class="card-menu" onclick="showChartScreen()">
                <span class="menu-icon">üìä</span>
                <div class="menu-text"><h3 data-lang="stats">ƒ∞statistikler</h3><p data-lang="stats_desc">Geli≈üim raporu</p></div>
            </div>
        </div>
    </div>

    <div class="screen" id="quizScreen">
        <div class="header">
            <button class="btn-back" onclick="show('dashboardScreen')">‚úï</button>
            <span class="mini-word-art" data-lang="quiz_game">Test</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content" style="display:flex; flex-direction:column; justify-content:center;">
    <div style="text-align:center;">
        <span id="quizCounter">1 / 10</span>
    </div>
    <div class="quiz-question" id="qText">WORD</div>
    <div class="quiz-grid" id="qOptions"></div>
</div>
    </div>

    <div class="screen" id="matchScreen">
        <div class="header">
            <button class="btn-back" onclick="show('dashboardScreen')">‚úï</button>
            <span class="mini-word-art" data-lang="match_game">E≈üle≈ütirme</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content">
            <div class="match-grid" id="matchGrid"></div>
        </div>
    </div>

    <div class="screen" id="flashScreen">
        <div class="header">
            <button class="btn-back" onclick="show('dashboardScreen')">‚úï</button>
            <span class="mini-word-art" data-lang="flash_game">Kartlar</span>
            <div style="width:45px;"></div>
        </div>
       <div class="content" style="display:flex; flex-direction:column;">
    <div style="text-align:center;">
        <span id="fcCounter">1 / 10</span>
    </div>
            
            <div class="flashcard-wrapper">
                <div class="flashcard" id="fcCard" onclick="flipCard()">
                    <div class="fc-face fc-front">
                        <div class="fc-main-word" id="fcFrontText">Word</div>
                        <div style="margin-top:20px; color:#9CA3AF; font-size:0.9rem;" data-lang="tap_flip">üëÜ √áevirmek i√ßin dokun</div>
                    </div>
                    <div class="fc-face fc-back" id="fcBackContent">
                        </div>
                </div>
            </div>

            <div class="fc-controls" id="fcControls">
                <button class="control-btn btn-forgot" onclick="nextCard(false)">‚úï <span data-lang="dont_know">Bilmiyorum</span></button>
                <button class="control-btn btn-know" onclick="nextCard(true)">‚úì <span data-lang="know">Biliyorum</span></button>
            </div>
        </div>
    </div>

    <div class="screen" id="resultScreen">
        <div class="content" style="display:flex; flex-direction:column; justify-content:center; align-items:center;">
            <div class="result-box">
                <div class="result-score" id="resultScore">%100</div>
                <div class="result-label" data-lang="success_rate">BA≈ûARI ORANI</div>
            </div>
            <p id="resultMsg" style="color:#666; font-size:1.1rem; margin-bottom:30px; text-align:center; font-weight:700;"></p>
            <button class="btn-green" onclick="show('dashboardScreen')" data-lang="continue">DEVAM ET</button>
        </div>
    </div>

    <div class="screen" id="srsScreen">
        <div class="header">
            <button class="btn-back" onclick="show('dashboardScreen')">
                <svg class="icon-back" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <span class="mini-word-art" data-lang="smart_review">Akƒ±llƒ± Tekrar</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content">
            <div class="card-menu" onclick="startUnknownGame()">
                <span class="menu-icon">üÜï</span>
                <div class="menu-text"><h3 data-lang="study_unknown">Bilinmeyenleri √áalƒ±≈ü</h3><p data-lang="study_unknown_desc">Hen√ºz √∂ƒürenilmeyenler</p></div>
            </div>
            <div class="card-menu" onclick="startSRSGame()">
                <span class="menu-icon">üìÖ</span>
                <div class="menu-text"><h3 data-lang="daily_review">G√ºnl√ºk Tekrar (SRS)</h3><p data-lang="daily_review_desc">Unutmak √ºzere olduklarƒ±n</p></div>
            </div>
        </div>
    </div>

    <div class="screen" id="chartScreen">
        <div class="header">
            <button class="btn-back" onclick="show('dashboardScreen')">
                <svg class="icon-back" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <span class="mini-word-art" data-lang="stats">ƒ∞statistik</span>
            <div style="width:45px;"></div>
        </div>
        <div class="content">
            <h3 class="mini-word-art" style="font-size:0.85rem; color:#666; margin-bottom:10px;">√ñƒürenme S√ºreci (Kategori Bazlƒ±)</h3>
<canvas id="srsChart"></canvas>
<h3 class="mini-word-art" style="font-size:0.85rem; margin-top:25px; color:#666; margin-bottom:10px;">Toplam Tekrar Sayƒ±larƒ±</h3>
            <canvas id="repeatChart"></canvas>
            <div class="stats-summary">
                <div class="stat-item"><span class="stat-val" id="statTotal">0</span><span class="stat-lbl" data-lang="total">Toplam</span></div>
                <div class="stat-item"><span class="stat-val" style="color:#22C55E;" id="statLearned">0</span><span class="stat-lbl" data-lang="learned">√ñƒürenilen</span></div>
                <div class="stat-item"><span class="stat-val" style="color:#EF4444;" id="statUnknown">0</span><span class="stat-lbl" data-lang="unknown">Bilinmeyen</span></div>
            </div>
        </div>
    </div>

</div>

<script>
/* === Sƒ∞STEM & VERƒ∞ === */
const LEVELS = ["A1", "A2", "B1", "B2", "C1", "C2"];
let DATA = {}, SRS_DATA = {};
let activeCat = "", activeLvl = "";
let gamePool = [], currentIndex = 0, currentWord = null;
let matchSelected = null, chartInstance = null, repeatChartInstance = null;
const ONE_DAY = 24 * 60 * 60 * 1000;
const SRS_INTERVALS = [ONE_DAY, 3*ONE_DAY, 7*ONE_DAY, 15*ONE_DAY, 30*ONE_DAY];
let sessionCorrect = 0, sessionTotal = 0;
let currentLang = localStorage.getItem("WM_LANG") || "tr";

const LANG = {
    tr: { words: "Kelimeler", words_desc: "Kelime hazineni geli≈ütir", phrases: "Kalƒ±plar", phrases_desc: "G√ºnl√ºk konu≈üma yapƒ±larƒ±", idioms: "Deyimler", idioms_desc: "ƒ∞leri seviye ifadeler", msg_perfect: "M√ºkemmel! üéâ", msg_good: "G√ºzel! üí™", msg_bad: "√áalƒ±≈ümalƒ±sƒ±n! üìö", streak: "G√ºnl√ºk Seri!", alert_min: "En az {n} √∂ƒüe gerekli.", alert_added: "Eklendi!", alert_bulk_added: "{n} √∂ƒüe eklendi!", alert_no_unknown: "Bilinmeyen kalmadƒ±!", alert_no_srs: "Tekrarƒ± gelen yok.", btn_upload: "üìÅ TXT Dosyasƒ± Y√ºkle", file_loaded: "Dosya Y√ºklendi!", success_rate: "BA≈ûARI ORANI", continue: "DEVAM ET", study_unknown: "Bilinmeyenleri √áalƒ±≈ü", daily_review: "G√ºnl√ºk Tekrar (SRS)", total: "Toplam", learned: "√ñƒürenilen", unknown: "Bilinmeyen" },
    en: { words: "Words", words_desc: "Build vocabulary", phrases: "Phrases", phrases_desc: "Daily patterns", idioms: "Idioms", idioms_desc: "Advanced expressions", msg_perfect: "Perfect! üéâ", msg_good: "Great! üí™", msg_bad: "Keep practicing! üìö", streak: "Day Streak!", alert_min: "Min {n} items required.", alert_added: "Added!", alert_bulk_added: "{n} items added!", alert_no_unknown: "No unknown items!", alert_no_srs: "No reviews due.", btn_upload: "üìÅ Upload TXT", file_loaded: "File Loaded!", success_rate: "SUCCESS RATE", continue: "CONTINUE", study_unknown: "Study Unknowns", daily_review: "Daily Review", total: "Total", learned: "Learned", unknown: "Unknown" }
};

window.onload = () => {
    initDB();
    checkStreak();
    applyLanguage();
    if(localStorage.getItem("INIT") === "1") show('homeScreen');
};
updateMainStats();

function initDB() {
    let stored = localStorage.getItem("WM_DB_V16");
    DATA = stored ? JSON.parse(stored) : { "KELƒ∞MELER":{}, "KALIPLAR":{}, "DEYƒ∞MLER":{} };
    for(let cat in DATA) { LEVELS.forEach(l => { if(!DATA[cat][l]) DATA[cat][l] = []; }); }
    SRS_DATA = JSON.parse(localStorage.getItem("WM_SRS_V16") || "{}");
}

function saveDB() {
    localStorage.setItem("WM_DB_V16", JSON.stringify(DATA));
    localStorage.setItem("WM_SRS_V16", JSON.stringify(SRS_DATA));
    localStorage.setItem("INIT", "1");
}

function checkStreak() {
    let last = localStorage.getItem("LAST_VISIT"), streak = parseInt(localStorage.getItem("STREAK")||0);
    let todayDate = new Date();
    if(last !== todayDate.toDateString()) {
        let yest = new Date(); yest.setDate(yest.getDate()-1);
        streak = (last === yest.toDateString()) ? streak + 1 : 1;
        localStorage.setItem("LAST_VISIT", todayDate.toDateString());
        localStorage.setItem("STREAK", streak);
    }
    document.getElementById("streakDisplay").innerText = streak + " " + LANG[currentLang].streak;
    let dayCircle = document.getElementById("day-" + todayDate.getDay());
    if(dayCircle) dayCircle.classList.add("active");
}

function show(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

function selectCategory(cat) {
    activeCat = cat;
    let grid = document.getElementById("levelsGrid");
    grid.innerHTML = "";
    const lvlClasses = ["lvl-blue", "lvl-orange", "lvl-green", "lvl-pink", "lvl-purple", "lvl-cyan"];
    LEVELS.forEach((l, i) => {
        let count = DATA[cat][l].length;
        grid.innerHTML += `<button class="level-btn ${lvlClasses[i]}" onclick="selectLevel('${l}')">${l} <small>(${count})</small></button>`;
    });
    document.getElementById("catTitle").innerText = cat;
    show('levelScreen');
}

function selectLevel(l) { 
    activeLvl = l; 
    document.getElementById("dashTitle").innerText = l; 
    show('dashboardScreen'); 
    updateLevelStats(); // Bu satƒ±rƒ± ekle
}

function initGame(mode) {
    let pool = DATA[activeCat][activeLvl];
    if(pool.length < 4) return alert(LANG[currentLang].alert_min.replace("{n}", 4));
    gamePool = [...pool].sort(() => 0.5 - Math.random()).slice(0, 10);
    currentIndex = 0; sessionCorrect = 0; sessionTotal = 0;
    if(mode === 'quiz') { show('quizScreen'); renderQuiz(); }
    else if(mode === 'match') { show('matchScreen'); renderMatch(); }
    else { show('flashScreen'); renderFlash(); }
}

let fcShowTurkish = false; // Dil durumunu takip etmek i√ßin global deƒüi≈üken

function renderFlash() {
    if (currentIndex >= gamePool.length) return finishGameWithResult();
    currentWord = gamePool[currentIndex];
    fcShowTurkish = false; // Her yeni kartta ƒ∞ngilizce ile ba≈üla

    document.getElementById("fcCounter").innerText = (currentIndex + 1) + " / " + gamePool.length;
    document.getElementById("fcCard").classList.remove("flipped");
    
    // √ñN Y√úZ
    document.getElementById("fcFrontText").innerHTML = `
        <div style="font-size: 3rem; font-weight: 800; color: var(--primary);">${currentWord.eng}</div>
        <p style="text-align:center; color:#94A3B8; font-size:0.8rem; margin-top:10px;">Detaylar i√ßin karta tƒ±kla</p>
    `;

    updateFCBackFace();
    TTS(currentWord.eng);
}

function updateFCBackFace() {
    const backFace = document.getElementById('fcBackContent');
    const w = currentWord;
    let content = "";
    
    // Satƒ±rlarƒ±n ekrana sƒ±ƒümasƒ± i√ßin padding ve margin deƒüerleri d√º≈ü√ºr√ºld√º
    if (!fcShowTurkish) {
        content = `
            <div style="width:100%; display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                <strong style="font-size:1.4rem; color:#1F2937;">${w.eng}</strong>
                <button onclick="event.stopPropagation(); TTS('${w.eng}')" style="background:none; border:none; font-size:1.3rem; cursor:pointer; box-shadow:none; width:auto; padding:0;">üîä</button>
            </div>
            <div style="border-left:4px solid #6366F1; background:#F8FAFC; padding:8px 12px; border-radius:10px; margin-bottom:5px; font-weight:700; color:#4F46E5; font-size:0.85rem;">${w.typeEn || ''}</div>
            <div style="border-left:4px solid #3B82F6; background:#F8FAFC; padding:8px 12px; border-radius:10px; margin-bottom:5px; font-weight:700; font-size:0.9rem;">${w.def || ''}</div>
            <div style="border-left:4px solid #3B82F6; background:#F8FAFC; padding:8px 12px; border-radius:10px; margin-bottom:5px; font-weight:700; color:#4B5563; font-style:italic; font-size:0.85rem;">${w.ex || ''}</div>
            <div style="border-left:4px solid #3B82F6; background:#F8FAFC; padding:8px 12px; border-radius:10px; margin-bottom:5px; font-weight:700; color:#4B5563; font-style:italic; font-size:0.85rem;">${w.ex2 || ''}</div>
        `;
    } else {
        content = `
            <div style="width:100%; margin-bottom:5px;"><strong style="font-size:1.4rem; color:#1F2937;">${w.tr}</strong></div>
            <div style="border-left:4px solid #10B981; background:#F8FAFC; padding:8px 12px; border-radius:10px; margin-bottom:5px; font-weight:700; color:#059669; font-size:0.85rem;">${w.typeTr || ''}</div>
            <div style="border-left:4px solid #3B82F6; background:#F8FAFC; padding:8px 12px; border-radius:10px; margin-bottom:5px; font-weight:700; font-size:0.9rem;">${w.defTr || ''}</div>
            <div style="border-left:4px solid #3B82F6; background:#F8FAFC; padding:8px 12px; border-radius:10px; margin-bottom:5px; font-weight:700; color:#4B5563; font-style:italic; font-size:0.85rem;">${w.exTr || ''}</div>
            <div style="border-left:4px solid #3B82F6; background:#F8FAFC; padding:8px 12px; border-radius:10px; margin-bottom:5px; font-weight:700; color:#4B5563; font-style:italic; font-size:0.85rem;">${w.ex2Tr || ''}</div>
        `;
    }

    // "overflow-y: hidden" yaparak kaydƒ±rma √ßubuƒüunu tamamen engelliyoruz
    backFace.innerHTML = `
        <div style="flex:1; width:100%; overflow:hidden;">${content}</div>
        <button class="btn-translate" onclick="event.stopPropagation(); toggleFCTranslation()" style="background:#8B5CF6; color:white; border:none; border-radius:12px; padding:12px; font-weight:800; margin-top:5px; cursor:pointer; width:100%; box-shadow: 0 4px 0 #7C3AED; font-size:0.75rem;">
            TR/ENG
        </button>
    `;
}

function toggleFCTranslation() {
    fcShowTurkish = !fcShowTurkish;
    updateFCBackFace();
}

function flipCard() { document.getElementById("fcCard").classList.toggle("flipped"); }
function nextCard(known) { sessionTotal++; if(known) sessionCorrect++; updateSRS(currentWord, known); currentIndex++; renderFlash(); }

function renderQuiz() {
    if(currentIndex >= gamePool.length) return finishGameWithResult();
    currentWord = gamePool[currentIndex];
    document.getElementById("quizCounter").innerText = (currentIndex + 1) + " / " + gamePool.length;
    document.getElementById("qText").innerText = currentWord.eng;
    TTS(currentWord.eng);
    let opts = [currentWord.tr], all = DATA[activeCat][activeLvl].map(w => w.tr);
    while(opts.length < 4) { let r = all[Math.floor(Math.random()*all.length)]; if(!opts.includes(r)) opts.push(r); }
    opts.sort(() => 0.5 - Math.random());
    document.getElementById("qOptions").innerHTML = opts.map(opt => `<div class="quiz-opt" onclick="checkQuiz(this, '${opt}')">${opt}</div>`).join("");
}
function checkQuiz(btn, ans) {
    sessionTotal++;
    if(ans === currentWord.tr) {
        btn.classList.add("correct"); sessionCorrect++; updateSRS(currentWord, true);
        setTimeout(() => { currentIndex++; renderQuiz(); }, 800);
    } else {
        btn.classList.add("wrong");
        document.querySelectorAll('.quiz-opt').forEach(b => { if(b.innerText === currentWord.tr) b.classList.add("correct"); });
        updateSRS(currentWord, false);
        setTimeout(() => { currentIndex++; renderQuiz(); }, 1500);
    }
}

function renderMatch() {
    let items = []; let pool = gamePool.slice(0, 5);
    pool.forEach(w => { items.push({ id: w.eng, text: w.eng }); items.push({ id: w.eng, text: w.tr }); });
    items.sort(() => 0.5 - Math.random());
    let grid = document.getElementById("matchGrid"); grid.innerHTML = "";
    items.forEach((item, i) => {
        let div = document.createElement("div");
        div.className = "match-card mc-" + ((i % 6) + 1);
        div.innerText = item.text; div.dataset.id = item.id;
        div.onclick = () => handleMatch(div);
        grid.appendChild(div);
    });
}
function handleMatch(el) {
    if(el.classList.contains("matched") || el.classList.contains("selected")) return;
    el.classList.add("selected");
    if(!matchSelected) { matchSelected = el; } 
    else {
        sessionTotal++;
        if(matchSelected.dataset.id === el.dataset.id) {
            matchSelected.classList.remove("selected"); el.classList.remove("selected");
            matchSelected.classList.add("matched"); el.classList.add("matched");
            matchSelected = null; sessionCorrect++;
            if(document.querySelectorAll('.match-card:not(.matched)').length === 0) finishGameWithResult();
        } else {
            setTimeout(() => { matchSelected.classList.remove("selected"); el.classList.remove("selected"); matchSelected = null; }, 500);
        }
    }
}

function finishGameWithResult() {
    let perc = Math.round((sessionCorrect / sessionTotal) * 100) || 0;
    document.getElementById("resultScore").innerText = `%${perc}`;
    document.getElementById("resultMsg").innerText = perc >= 80 ? LANG[currentLang].msg_perfect : (perc >= 50 ? LANG[currentLang].msg_good : LANG[currentLang].msg_bad);
    show('resultScreen');
updateMainStats(); updateLevelStats();
}
// ... √∂nceki fonksiyonlar (show, selectLevel vs.) ...

/* BURAYA YAPI≈ûTIRABƒ∞Lƒ∞RSƒ∞N */
function addSingle() {
    const eng = document.getElementById("addEng").value.trim();
    const tr = document.getElementById("addTr").value.trim();
    const cat = document.getElementById("addCat").value;
    const lvl = document.getElementById("addLvl").value;

    if(!eng || !tr) return alert("L√ºtfen alanlarƒ± doldurun!");

    DATA[cat][lvl].push({
        eng: eng, tr: tr, lvl: lvl, 
        typeEn: "", typeTr: "", def: "", defTr: "", ex: "", exTr: "", ex2: "", ex2Tr: ""
    });
    
    saveDB();
    updateMainStats();
    alert(LANG[currentLang].alert_added);
    document.getElementById("addEng").value = "";
    document.getElementById("addTr").value = "";
}

/* === GELƒ∞≈ûMƒ∞≈û PARSER (KELƒ∞ME VS DEYƒ∞M/KALIP AYRIMI) === */
function addBulk() {
    const text = document.getElementById("bulkInput").value.trim();
    if (!text) return;
    const cat = document.getElementById("bulkCat").value;
    let count = 0;
updateMainStats();

    const lines = text.split("\n").map(l => l.trim()).filter(l => l);

    if (cat === "KELƒ∞MELER") {
        // Yeni 11 S√ºtunlu Format: 
        // Seviye | Kelime | T√ºrk√ße | T√ºr EN | T√ºr TR | Def EN | Def TR | √ñrnek1 EN | √ñrnek1 TR | √ñrnek2 EN | √ñrnek2 TR
        lines.forEach(line => {
            const p = line.split("|").map(i => i.trim());
            if (p.length >= 11) {
                const entryLvl = p[0].toUpperCase();
                if (LEVELS.includes(entryLvl)) {
                    DATA[cat][entryLvl].push({
                        eng: p[1],
                        tr: p[2],
                        typeEn: p[3],
                        typeTr: p[4],
                        def: p[5],
                        defTr: p[6],
                        ex: p[7],
                        exTr: p[8],
                        ex2: p[9],
                        ex2Tr: p[10],
                        lvl: entryLvl
                    });
                    count++;
                }
            }
        });
    } else {
        // Kalƒ±plar ve Deyimler i√ßin mevcut (Seviye satƒ±rƒ± + " : " formatƒ±) korunur
        let currentBulkLvl = "A1";
        lines.forEach(line => {
            if (LEVELS.includes(line.toUpperCase())) {
                currentBulkLvl = line.toUpperCase();
            } else if (line.includes(" : ")) {
                let parts = line.split(" : ");
                DATA[cat][currentBulkLvl].push({ 
                    eng: parts[0].trim(), 
                    tr: parts[1].trim(), 
                    ex: "", 
                    grammar: "", 
                    lvl: currentBulkLvl 
                });
                count++;
            }
        });
    }
    
    saveDB(); 
    alert(LANG[currentLang].alert_bulk_added.replace("{n}", count));
    document.getElementById("bulkInput").value = "";
}

function updateSRS(w, c) {
    if(!SRS_DATA[w.eng]) SRS_DATA[w.eng] = { stage: 0, repeats: 0 };
    if(c) {
        SRS_DATA[w.eng].stage = Math.min((SRS_DATA[w.eng].stage || 0) + 1, 5);
        SRS_DATA[w.eng].repeats = (SRS_DATA[w.eng].repeats || 0) + 1;
    } else { SRS_DATA[w.eng].stage = 0; } // Yanlƒ±≈üsa 0'lanƒ±r -> Bilinmeyenler havuzu
    saveDB();
}

function startUnknownGame() {
    let pool = []; for(let c in DATA) for(let l in DATA[c]) pool = pool.concat(DATA[c][l]);
    let target = pool.filter(w => !SRS_DATA[w.eng] || SRS_DATA[w.eng].stage === 0);
    if(target.length === 0) return alert(LANG[currentLang].alert_no_unknown);
    gamePool = target.sort(() => 0.5 - Math.random()).slice(0, 10); currentIndex = 0; sessionCorrect = 0; sessionTotal = 0; show('flashScreen'); renderFlash();
}
function startSRSGame() {
    let pool = []; for(let c in DATA) for(let l in DATA[c]) pool = pool.concat(DATA[c][l]);
    let target = pool.filter(w => SRS_DATA[w.eng] && SRS_DATA[w.eng].stage > 0);
    if(target.length === 0) return alert(LANG[currentLang].alert_no_srs);
    gamePool = target.sort(() => 0.5 - Math.random()).slice(0, 10); currentIndex = 0; sessionCorrect = 0; sessionTotal = 0; show('quizScreen'); renderQuiz();
}

/* === ƒ∞STATƒ∞STƒ∞KLERƒ∞ KATEGORƒ∞ BAZLI (3 RENKLƒ∞) G√ñSTEREN G√úNCEL FONKSƒ∞YON === */
function showChartScreen() {
    show('chartScreen');
    
    // Her kategori i√ßin ayrƒ± veri havuzlarƒ±
    let catStats = {
        "KELƒ∞MELER": { s: [0,0,0,0,0,0], r: [0,0,0,0,0] },
        "KALIPLAR": { s: [0,0,0,0,0,0], r: [0,0,0,0,0] },
        "DEYƒ∞MLER": { s: [0,0,0,0,0,0], r: [0,0,0,0,0] }
    };
    
    let totalAll = 0, learnedAll = 0;

    // T√ºm veriyi kategorilerine g√∂re tara
    for (let cat in DATA) {
        for (let lvl in DATA[cat]) {
            DATA[cat][lvl].forEach(w => {
                totalAll++;
                let s = SRS_DATA[w.eng] ? (SRS_DATA[w.eng].stage || 0) : 0;
                let r = SRS_DATA[w.eng] ? (SRS_DATA[w.eng].repeats || 0) : 0;
                
                catStats[cat].s[s]++; // S√ºre√ß verisi
                
                // Tekrar daƒüƒ±lƒ±m verisi
                if(r >= 15) catStats[cat].r[4]++;
                else if(r >= 7) catStats[cat].r[3]++;
                else if(r >= 5) catStats[cat].r[2]++;
                else if(r >= 3) catStats[cat].r[1]++;
                else if(r >= 1) catStats[cat].r[0]++;

                if(s > 0) learnedAll++;
            });
        }
    }

    // √ñzet bilgileri g√ºncelle
    document.getElementById("statTotal").innerText = totalAll;
    document.getElementById("statLearned").innerText = learnedAll;
    document.getElementById("statUnknown").innerText = totalAll - learnedAll;

    // GRAFƒ∞K 1: S√ºre√ß Daƒüƒ±lƒ±mƒ± (Kelimeler: Mavi, Kalƒ±plar: Ye≈üil, Deyimler: Turuncu)
    if(chartInstance) chartInstance.destroy();
    chartInstance = new Chart(document.getElementById("srsChart"), {
        type: 'bar',
        data: {
            labels: ['Yeni', '1G', '3G', '7G', '15G', '30G'],
            datasets: [
                { label: 'Kelimeler', data: catStats["KELƒ∞MELER"].s, backgroundColor: '#3B82F6' },
                { label: 'Kalƒ±plar', data: catStats["KALIPLAR"].s, backgroundColor: '#22C55E' },
                { label: 'Deyimler', data: catStats["DEYƒ∞MLER"].s, backgroundColor: '#F59E0B' }
            ]
        },
        options: { scales: { x: { stacked: true }, y: { stacked: true } } }
    });

    // GRAFƒ∞K 2: Tekrar Daƒüƒ±lƒ±mƒ± (√áizgi Grafik - 3 Renk)
    if(repeatChartInstance) repeatChartInstance.destroy();
    repeatChartInstance = new Chart(document.getElementById("repeatChart"), {
        type: 'line',
        data: {
            labels: ['1 Rep', '3 Rep', '5 Rep', '7 Rep', '15+ Rep'],
            datasets: [
                { label: 'Kelimeler', data: catStats["KELƒ∞MELER"].r, borderColor: '#3B82F6', tension: 0.3, fill: false },
                { label: 'Kalƒ±plar', data: catStats["KALIPLAR"].r, borderColor: '#22C55E', tension: 0.3, fill: false },
                { label: 'Deyimler', data: catStats["DEYƒ∞MLER"].r, borderColor: '#F59E0B', tension: 0.3, fill: false }
            ]
        }
    });
}
function applyLanguage() { document.querySelectorAll("[data-lang]").forEach(el => { let key = el.getAttribute("data-lang"); if(LANG[currentLang][key]) el.innerText = LANG[currentLang][key]; }); }
function toggleLanguage() { currentLang = currentLang === "tr" ? "en" : "tr"; localStorage.setItem("WM_LANG", currentLang); applyLanguage(); checkStreak(); }
function TTS(t) { let u = new SpeechSynthesisUtterance(t); u.lang='en-US'; window.speechSynthesis.speak(u); }
function resetAllData() { if(confirm(LANG[currentLang].alert_reset)) { localStorage.clear(); location.reload(); } }
function loadFile() { const input = document.getElementById('fileInput'); if(input.files && input.files[0]) { const reader = new FileReader(); reader.onload = e => { document.getElementById('bulkInput').value = e.target.result; alert(LANG[currentLang].file_loaded); }; reader.readAsText(input.files[0]); } }
function setAddMode(mode) { isBulk = (mode === 'bulk'); document.getElementById("btnSingle").className = isBulk ? "add-option-btn" : "add-option-btn active"; document.getElementById("btnBulk").className = isBulk ? "add-option-btn active" : "add-option-btn"; document.getElementById("singleMode").style.display = isBulk ? "none" : "block"; document.getElementById("bulkMode").style.display = isBulk ? "block" : "none"; }
function updateMainStats() {
    let total = 0, learned = 0;
    for (let c in DATA) {
        for (let l in DATA[c]) {
            DATA[c][l].forEach(w => {
                total++;
                if (SRS_DATA[w.eng] && SRS_DATA[w.eng].stage > 0) learned++;
            });
        }
    }
    if(document.getElementById("mainTotal")) {
        document.getElementById("mainTotal").innerText = total;
        document.getElementById("mainLearned").innerText = learned;
        document.getElementById("mainUnknown").innerText = total - learned;
    }
}

function updateLevelStats() {
    if(!activeCat || !activeLvl) return;
    let pool = DATA[activeCat][activeLvl];
    let total = pool.length;
    let learned = pool.filter(w => SRS_DATA[w.eng] && SRS_DATA[w.eng].stage > 0).length;
    let percent = total > 0 ? Math.round((learned / total) * 100) : 0;

    document.getElementById("levelProgressText").innerText = `${activeCat} - ${activeLvl}`;
    document.getElementById("levelPercent").innerText = `%${percent}`;
    document.getElementById("levelProgressBar").style.width = `${percent}%`;
    document.getElementById("lvlLearned").innerText = learned;
    document.getElementById("lvlUnknown").innerText = total - learned;
}
</script>
</body>
</html>